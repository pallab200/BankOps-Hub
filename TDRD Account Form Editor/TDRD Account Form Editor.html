<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#6366f1" />
  <meta name="description" content="TD/RD Account Form Editor with overlay positioning and preset management" />
  <title>TD/RD Account Form Editor</title>
  <link href="assets/poppins.css" rel="stylesheet">
  <link rel="stylesheet" href="assets/font-awesome.min.css">
  <style>
/* Modern Unified Design System */
:root {
  --primary: #6366f1;
  --primary-dark: #4f46e5;
  --primary-light: #818cf8;
  --primary-gradient: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #a855f7 100%);
  --accent: #ec4899;
  --accent-light: #f472b6;
  --accent-gradient: linear-gradient(135deg, #ec4899 0%, #f472b6 100%);
  --success: #10b981;
  --success-light: #34d399;
  --success-gradient: linear-gradient(135deg, #10b981 0%, #059669 100%);
  --warning: #f59e0b;
  --warning-light: #fbbf24;
  --warning-gradient: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
  --danger: #ef4444;
  --danger-light: #f87171;
  --danger-gradient: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
  --info: #0ea5e9;
  --info-light: #38bdf8;
  --info-gradient: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
  --bg-primary: #f8fafc;
  --bg-secondary: #f1f5f9;
  --bg-gradient: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 50%, #f1f5f9 100%);
  --text-primary: #0f172a;
  --text-secondary: #475569;
  --text-muted: #94a3b8;
  --border-color: #e2e8f0;
  --border-light: #f1f5f9;
  --card-bg: rgba(255, 255, 255, 0.98);
  --card-hover-bg: rgba(255, 255, 255, 1);
  --glass-bg: rgba(255, 255, 255, 0.85);
  --glass-border: rgba(255, 255, 255, 0.5);
  --shadow-xs: 0 1px 2px rgba(15, 23, 42, 0.04);
  --shadow-sm: 0 2px 8px rgba(15, 23, 42, 0.06);
  --shadow-md: 0 8px 30px rgba(15, 23, 42, 0.1);
  --shadow-lg: 0 20px 50px rgba(15, 23, 42, 0.15);
  --shadow-xl: 0 25px 60px rgba(15, 23, 42, 0.2);
  --shadow-glow: 0 0 40px rgba(99, 102, 241, 0.2);
  --shadow-glow-accent: 0 0 40px rgba(236, 72, 153, 0.15);
  --radius-xs: 6px;
  --radius-sm: 8px;
  --radius-md: 12px;
  --radius-lg: 16px;
  --radius-xl: 24px;
  --radius-2xl: 32px;
  --transition-fast: 0.15s ease;
  --transition-normal: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  --transition-slow: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  --transition-bounce: 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}

* { box-sizing: border-box; margin: 0; padding: 0; }

html { scroll-behavior: smooth; }

body {
  font-family: 'Poppins', 'Segoe UI', Roboto, Arial, sans-serif;
  background: var(--bg-gradient);
  background-attachment: fixed;
  color: var(--text-primary);
  min-height: 100vh;
  overflow-x: hidden;
  position: relative;
}

body::before,
body::after {
  content: '';
  position: fixed;
  border-radius: 50%;
  pointer-events: none;
  z-index: -1;
  opacity: 0.4;
  filter: blur(80px);
}

body::before {
  width: 600px;
  height: 600px;
  background: linear-gradient(135deg, rgba(99, 102, 241, 0.15), rgba(139, 92, 246, 0.1));
  top: -200px;
  right: -100px;
  animation: floatBg 20s ease-in-out infinite;
}

body::after {
  width: 500px;
  height: 500px;
  background: linear-gradient(135deg, rgba(236, 72, 153, 0.1), rgba(168, 85, 247, 0.08));
  bottom: -150px;
  left: -100px;
  animation: floatBg 25s ease-in-out infinite reverse;
}

@keyframes floatBg {
  0%, 100% { transform: translate(0, 0) scale(1); }
  25% { transform: translate(30px, -30px) scale(1.05); }
  50% { transform: translate(-20px, 20px) scale(0.95); }
  75% { transform: translate(20px, 30px) scale(1.02); }
}

@keyframes fadeInUp {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes fadeInDown {
  from { opacity: 0; transform: translateY(-20px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes float {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-5px); }
}

@keyframes shimmer {
  0% { background-position: -200% 0; }
  100% { background-position: 200% 0; }
}

@keyframes glow {
  0%, 100% { box-shadow: 0 0 20px rgba(99, 102, 241, 0.3); }
  50% { box-shadow: 0 0 35px rgba(99, 102, 241, 0.5); }
}

@keyframes rgbCycle {
  0% {
    color: #8b5cf6;
    text-shadow: 0 0 6px rgba(139,92,246,0.85), 0 0 18px rgba(139,92,246,0.45);
    transform: translateY(0);
  }
  25% {
    color: #ff6b6b;
    text-shadow: 0 0 6px rgba(255,107,107,0.85), 0 0 18px rgba(255,107,107,0.35);
    transform: translateY(-2px);
  }
  50% {
    color: #ffd166;
    text-shadow: 0 0 6px rgba(255,209,102,0.9), 0 0 20px rgba(255,209,102,0.25);
    transform: translateY(0);
  }
  75% {
    color: #4ade80;
    text-shadow: 0 0 6px rgba(74,222,128,0.85), 0 0 18px rgba(74,222,128,0.35);
    transform: translateY(2px);
  }
  100% {
    color: #8b5cf6;
    text-shadow: 0 0 6px rgba(139,92,246,0.85), 0 0 18px rgba(139,92,246,0.45);
    transform: translateY(0);
  }
}

.developer-credit {
  text-align: center;
  padding: 20px;
  margin-top: 30px;
  font-size: 1.1rem;
  font-weight: 600;
  letter-spacing: 1px;
  animation: rgbCycle 6s ease-in-out infinite;
}

.developer-credit.small {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  padding: 8px 14px;
  margin-top: 8px;
  font-size: 0.8rem;
  font-weight: 700;
  letter-spacing: 0.5px;
  border-radius: 20px;
  background: linear-gradient(135deg, rgba(99,102,241,0.08) 0%, rgba(139,92,246,0.06) 50%, rgba(236,72,153,0.05) 100%);
  color: #0f172a;
  box-shadow: 0 4px 15px rgba(15, 23, 42, 0.06), inset 0 1px 0 rgba(255,255,255,0.8);
  border: 1px solid rgba(99,102,241,0.1);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-transform: none;
  animation: rgbCycle 4s linear infinite;
}

.footer-rgb .rgb-text {
  padding: 8px 14px;
  border-radius: 999px;
  font-weight: 600;
  background: linear-gradient(90deg,
    #5b21b6 0%,
    #7c3aed 12%,
    #ec4899 24%,
    #fb7185 36%,
    #f97316 48%,
    #f59e0b 60%,
    #06b6d4 72%,
    #0ea5a1 84%,
    #5b21b6 100%
  );
  background-size: 300% 300%;
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  -webkit-text-fill-color: transparent;
  animation: rgbShift 6s linear infinite;
  text-align: center;
}

@keyframes rgbShift {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

@media (max-width: 520px) {
  .footer-rgb .rgb-text { font-size: 0.92rem; }
}

/* Page Navigation */
.page-nav {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 1000;
  background: linear-gradient(135deg, rgba(99, 102, 241, 0.95) 0%, rgba(79, 70, 229, 0.98) 50%, rgba(139, 92, 246, 0.95) 100%);
  padding: 14px 28px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  box-shadow: 0 4px 30px rgba(99, 102, 241, 0.4), inset 0 1px 0 rgba(255,255,255,0.2);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border-bottom: 1px solid rgba(255,255,255,0.1);
  animation: fadeInDown 0.5s ease-out;
}

.page-nav::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
  background-size: 200% 100%;
  animation: shimmer 3s infinite;
  pointer-events: none;
}

.page-nav h1 {
  color: white;
  font-size: 1.4rem;
  font-weight: 700;
  display: flex;
  align-items: center;
  gap: 12px;
  text-shadow: 0 2px 10px rgba(0,0,0,0.2);
}

.page-nav h1 i {
  font-size: 1.5rem;
  animation: float 4s ease-in-out infinite;
}

.nav-buttons {
  display: flex;
  align-items: center;
  gap: 12px;
}

.nav-btn {
  padding: 10px 22px;
  border-radius: var(--radius-md);
  border: none;
  cursor: pointer;
  font-weight: 600;
  font-size: 0.95rem;
  transition: var(--transition-normal);
  display: flex;
  align-items: center;
  gap: 8px;
  position: relative;
  overflow: hidden;
}

.nav-btn.active {
  background: white;
  color: var(--primary);
  box-shadow: 0 4px 20px rgba(255, 255, 255, 0.5), inset 0 1px 0 rgba(255,255,255,1);
  font-weight: 700;
}

.nav-btn:not(.active) {
  background: rgba(255, 255, 255, 0.12);
  color: white;
  border: 1px solid rgba(255, 255, 255, 0.2);
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);
}

.nav-btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
}

.nav-btn:active {
  transform: translateY(-1px);
}

/* Action bar and buttons (Print / Clear) */
.action-bar {
  display: flex;
  gap: 10px;
  justify-content: flex-end;
  align-items: center;
  padding: 12px 16px;
}
.action-btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 10px 14px;
  border-radius: 12px;
  border: none;
  cursor: pointer;
  font-weight: 600;
  color: #fff;
  box-shadow: 0 6px 18px rgba(2,24,40,0.06);
  transition: transform 0.12s ease, box-shadow 0.12s ease, opacity 0.12s ease;
}
.action-btn i { font-size: 1rem; }
.action-btn:focus { outline: 3px solid rgba(14,165,233,0.18); outline-offset: 2px; }
.btn.btn-success.action-btn { background: linear-gradient(135deg,var(--primary),var(--primary-dark)); }
.btn.btn-danger.action-btn { background: linear-gradient(135deg,#ef4444,#dc2626); }
.action-btn:hover { transform: translateY(-2px); }

/* Responsive: show icon only on small screens */
@media (max-width: 600px) {
  .action-bar { gap: 8px; padding: 8px; }
  .action-btn { padding: 10px; width: 44px; justify-content: center; }
  .action-btn .action-label { display: none; }
}

/* Page Containers */
.page-container {
  display: none;
  padding-top: 90px;
  min-height: 100vh;
  animation: fadeIn 0.4s ease-out;
}

.page-container.active {
  display: block;
}

/* Information Page */
.info-page {
  max-width: 1440px;
  margin: 0 auto;
  padding: 18px;
  padding-bottom: 90px;
}

.form-sections {
  display: flex;
  flex-direction: column;
  gap: 11px;
}

.form-section {
  background: var(--card-bg);
  border-radius: var(--radius-xl);
  padding: 16px;
  box-shadow: var(--shadow-md);
  border: 1px solid var(--border-color);
  transition: var(--transition-normal);
  animation: fadeInUp 0.45s ease-out backwards;
  position: relative;
  overflow: hidden;
  border-left: 4px solid transparent;
  background-image: linear-gradient(var(--card-bg), var(--card-bg)), linear-gradient(180deg, var(--primary), var(--accent));
  background-origin: border-box;
  background-clip: padding-box, border-box;
}

.form-section:hover {
  transform: translateY(-6px);
  box-shadow: var(--shadow-lg), var(--shadow-glow);
  border-color: transparent;
}

.form-section:nth-child(1) { animation-delay: 0.1s; }
.form-section:nth-child(2) { animation-delay: 0.2s; }
.form-section:nth-child(3) { animation-delay: 0.3s; }
.form-section:nth-child(4) { animation-delay: 0.4s; }

.section-header {
  display: flex;
  align-items: center;
  gap: 14px;
  margin-bottom: 16px;
  padding-bottom: 11px;
  border-bottom: 1px solid var(--border-light);
  position: relative;
  cursor: pointer;
  user-select: none;
  transition: var(--transition-normal);
}

.section-header:hover {
  opacity: 0.95;
}

.section-toggle {
  margin-left: auto;
  font-size: 1rem;
  color: var(--text-muted);
  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), color 0.2s ease, background 0.2s ease;
  padding: 10px;
  border-radius: var(--radius-sm);
  background: var(--bg-secondary);
}

.section-header:hover .section-toggle {
  color: var(--primary);
  background: rgba(99, 102, 241, 0.12);
}

.form-section.collapsed .section-toggle {
  transform: rotate(-90deg);
}

.form-section.collapsed .section-header {
  margin-bottom: 0;
  padding-bottom: 0;
  border-bottom: none;
}

.form-fields {
  overflow: hidden;
  max-height: 2000px;
  opacity: 1;
  transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1), 
              opacity 0.3s ease,
              padding 0.3s ease,
              margin 0.3s ease;
  contain: layout style;
}

.form-section.collapsed .form-fields {
  max-height: 0;
  opacity: 0;
  padding-top: 0;
  padding-bottom: 0;
  margin: 0;
}

.section-header i {
  font-size: 1.3rem;
  color: var(--primary);
  background: linear-gradient(135deg, rgba(99, 102, 241, 0.12), rgba(139, 92, 246, 0.08));
  padding: 14px;
  border-radius: var(--radius-md);

/* Permanent address: move same-as-present checkbox into header on right */
#permanent-address .section-header { gap: 12px; }
#permanent-address .same-as-present-header { margin-left: auto; display:flex; align-items:center; color:var(--text-secondary); font-size:0.95rem; }
#permanent-address .same-as-present-header input { width:16px; height:16px; }
#permanent-address .section-toggle { margin-left: 8px; }
  transition: var(--transition-normal);
  box-shadow: var(--shadow-xs);
}

.form-section:hover .section-header i {
  transform: scale(1.1) rotate(-5deg);
  background: linear-gradient(135deg, var(--primary), var(--accent));
  color: white;
  box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
}

.section-header h2 {
  font-size: 1.15rem;
  font-weight: 700;
  color: var(--text-primary);
  letter-spacing: -0.02em;
  flex: 1;
}

.form-group {
  margin-bottom: 18px;
  animation: fadeIn 0.3s ease-out backwards;
}

.form-group label {
  display: block;
  font-size: 0.875rem;
  font-weight: 600;
  color: var(--text-secondary);
  margin-bottom: 8px;
  transition: var(--transition-fast);
}

.form-group:focus-within label {
  color: var(--primary);
  transform: translateX(2px);
}

.form-group input,
.form-group select,
.form-group textarea {
  width: 100%;
  padding: 14px 16px;
  border: 2px solid var(--border-color);
  border-radius: var(--radius-md);
  font-size: 0.95rem;
  font-family: inherit;
  transition: var(--transition-normal);
  background: linear-gradient(180deg, #ffffff 0%, #fafbfc 100%);
  color: var(--text-primary);
  box-shadow: var(--shadow-xs);
}

.form-group input::placeholder,
.form-group textarea::placeholder {
  color: var(--text-muted);
  font-weight: 400;
}

.form-group input:hover,
.form-group select:hover,
.form-group textarea:hover {
  border-color: var(--primary-light);
  background: #ffffff;
  box-shadow: var(--shadow-sm);
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.15), var(--shadow-md);
  background: white;
}

.form-group textarea {
  resize: vertical;
  min-height: 90px;
}

.form-fields {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 16px;
}

.form-fields .form-group {
  margin-bottom: 0;
}

.form-fields .form-group.span-2 {
  grid-column: span 2;
}

.form-fields .form-group.span-3 {
  grid-column: span 3;
}

.form-fields .form-group.span-4 {
  grid-column: span 4;
}

/* Sub-section headers for organizing fields */
.sub-section-header {
  grid-column: 1 / -1;
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px 14px;
  margin: 8px 0 4px 0;
  background: linear-gradient(135deg, rgba(99, 102, 241, 0.08) 0%, rgba(139, 92, 246, 0.05) 100%);
  border-radius: var(--radius-md);
  border-left: 3px solid var(--primary);
}

.sub-section-header:first-child {
  margin-top: 0;
}

.sub-section-header i {
  color: var(--primary);
  font-size: 0.95rem;
}

.sub-section-header span {
  font-size: 0.85rem;
  font-weight: 600;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.action-bar {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: linear-gradient(180deg, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.98) 100%);
  backdrop-filter: blur(18px);
  -webkit-backdrop-filter: blur(18px);
  padding: 12px 18px;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 12px;
  box-shadow: 0 -8px 30px rgba(12, 35, 64, 0.08), inset 0 1px 0 rgba(255,255,255,0.85);
  z-index: 100;
  border-top: 1px solid rgba(165, 243, 252, 0.85);
  animation: fadeInUp 0.35s ease-out;
}

.btn {
  padding: 10px 18px;
  border-radius: 10px;
  border: none;
  cursor: pointer;
  font-weight: 700;
  font-size: 0.92rem;
  transition: var(--transition-normal);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  position: relative;
  overflow: hidden;
  text-decoration: none;
  letter-spacing: 0.02em;
}

.btn-primary {
  background: var(--primary-gradient);
  color: white;
  box-shadow: 0 4px 20px rgba(99, 102, 241, 0.4), inset 0 1px 0 rgba(255,255,255,0.2);
}

.btn-primary:hover {
  box-shadow: 0 8px 35px rgba(99, 102, 241, 0.5), inset 0 1px 0 rgba(255,255,255,0.2);
}

.btn-success {
  background: var(--success-gradient);
  color: white;
  box-shadow: 0 4px 20px rgba(16, 185, 129, 0.4), inset 0 1px 0 rgba(255,255,255,0.2);
}

.btn-success:hover {
  box-shadow: 0 8px 35px rgba(16, 185, 129, 0.5), inset 0 1px 0 rgba(255,255,255,0.2);
}

.btn-danger {
  background: var(--danger-gradient);
  color: white;
  box-shadow: 0 4px 20px rgba(239, 68, 68, 0.4), inset 0 1px 0 rgba(255,255,255,0.2);
}

.btn-danger:hover {
  box-shadow: 0 8px 35px rgba(239, 68, 68, 0.5), inset 0 1px 0 rgba(255,255,255,0.2);
}

.btn-info {
  background: var(--info-gradient);
  color: white;
  box-shadow: 0 4px 20px rgba(14, 165, 233, 0.4), inset 0 1px 0 rgba(255,255,255,0.2);
}

.btn-info:hover {
  box-shadow: 0 8px 35px rgba(14, 165, 233, 0.5), inset 0 1px 0 rgba(255,255,255,0.2);
}

.btn:hover {
  transform: translateY(-4px);
}

.btn:active {
  transform: translateY(-2px);
}

/* Form Preview Page */
.preview-page {
  padding: 24px;
  padding-bottom: 120px;
  animation: fadeIn 0.4s ease-out;
}

.preview-controls {
  max-width: 1000px;
  margin: 0 auto 28px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-wrap: wrap;
  gap: 16px;
  background: var(--card-bg);
  padding: 20px 28px;
  border-radius: var(--radius-xl);
  box-shadow: var(--shadow-md);
  border: 1px solid var(--border-color);
  animation: fadeInDown 0.5s ease-out;
  position: relative;
  overflow: hidden;
}

.form-type-selector {
  display: flex;
  align-items: center;
  gap: 10px;
}

.form-type-selector label {
  font-weight: 600;
  color: var(--text-secondary);
  display: flex;
  align-items: center;
  gap: 8px;
}

.form-type-selector label i {
  color: var(--primary);
}

.form-type-selector select {
  padding: 10px 18px;
  border: 2px solid var(--border-color);
  border-radius: var(--radius-sm);
  font-size: 0.95rem;
  font-family: inherit;
  cursor: pointer;
  transition: var(--transition-normal);
}

.form-type-selector select:hover {
  border-color: var(--primary-light);
}

.form-type-selector select:focus {
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
  outline: none;
}

.preview-container {
  max-width: 1000px;
  margin: 0 auto;
}

.preview-container .form-page,
.preview-container .form-page *:not(img) {
  text-transform: uppercase;
}

.form-page {
  display: block;
  position: relative;
  background: white;
  border-radius: var(--radius-xl);
  overflow: hidden;
  box-shadow: var(--shadow-lg);
  margin-bottom: 28px;
  transition: var(--transition-normal);
  border: 1px solid var(--border-color);
  contain: layout style paint;
}

.form-page.hidden {
  display: none;
}

.form-page:nth-child(1) { animation-delay: 0.1s; }
.form-page:nth-child(2) { animation-delay: 0.2s; }
.form-page:nth-child(3) { animation-delay: 0.3s; }
.form-page:nth-child(4) { animation-delay: 0.4s; }
.form-page:nth-child(5) { animation-delay: 0.1s; }
.form-page:nth-child(6) { animation-delay: 0.2s; }
.form-page:nth-child(7) { animation-delay: 0.3s; }
.form-page:nth-child(8) { animation-delay: 0.4s; }

.form-page:hover {
  box-shadow: var(--shadow-xl), 0 0 0 3px var(--primary-light);
  transform: translateY(-4px);
}

.form-page img {
  width: 100%;
  height: auto;
  display: block;
}

.overlay {
  position: absolute;
  color: #000;
  font-size: 13px;
  font-weight: 500;
  font-family: 'Times New Roman', Times, serif;
  pointer-events: none;
  white-space: nowrap;
  contain: layout style paint;
  will-change: transform;
}

/* Officer Seal overlays styling */
.overlay[data-field^="officerSeal"] {
  border: 2px solid #00000000;
  border-radius: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  font-weight: 800;
  padding: 10px;
  word-break: break-word;
  background: transparent;
  line-height: 1.2;
  white-space: pre-wrap;
  overflow: hidden;
  contain: layout style paint;
}

/* Checkbox / tick overlays â€” larger so ticks are more visible */
.overlay-check {
  font-size: 22px;
  font-weight: 700;
  line-height: 1;
}

.overlay.editing {
  pointer-events: auto;
  cursor: move;
  background: rgba(255, 243, 205, 0.9);
  border: 1px dashed #b71c1c;
  padding: 2px 4px;
  will-change: auto;
}

/* Overlay drag handle visual */
.overlay.handle { cursor: move; }

@media (max-width: 1024px) {
  .form-fields {
    grid-template-columns: repeat(3, 1fr);
  }
  .form-fields .form-group.span-4 {
    grid-column: span 3;
  }
}

@media (max-width: 900px) {
  .form-fields {
    grid-template-columns: repeat(2, 1fr);
  }
  .form-fields .form-group.span-3,
  .form-fields .form-group.span-4 {
    grid-column: span 2;
  }
}

@media (max-width: 600px) {
  .form-fields {
    grid-template-columns: 1fr;
  }
  .form-fields .form-group.span-2,
  .form-fields .form-group.span-3,
  .form-fields .form-group.span-4 {
    grid-column: span 1;
  }
}

::-webkit-scrollbar {
  width: 10px;
  height: 10px;
}

::-webkit-scrollbar-track {
  background: var(--bg-primary);
  border-radius: 5px;
}

::-webkit-scrollbar-thumb {
  background: linear-gradient(135deg, var(--primary-light), var(--primary));
  border-radius: 5px;
}

::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
}

::selection {
  background: var(--primary-light);
  color: white;
}

@media print {
  /* Hide all UI elements */
  .page-nav, .action-bar, .preview-controls, .slide-menu-toggle, .slide-menu, .slide-menu-backdrop, .info-page, #info-page {
    display: none !important;
    visibility: hidden !important;
  }
  
  /* Force form-page container to be visible */
  #form-page, 
  #form-page.page-container,
  .page-container#form-page {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
    position: static !important;
    padding: 0 !important;
    margin: 0 !important;
    height: auto !important;
    min-height: 0 !important;
  }
  
  body {
    margin: 0 !important;
    padding: 0 !important;
    overflow: visible !important;
    background: white !important;
  }
  
  html {
    margin: 0 !important;
    padding: 0 !important;
    background: white !important;
  }
  
  .preview-page {
    padding: 0 !important;
    margin: 0 !important;
    display: block !important;
    visibility: visible !important;
  }
  
  .preview-container {
    margin: 0 !important;
    padding: 0 !important;
    max-width: none !important;
    display: block !important;
    visibility: visible !important;
  }
  
  .form-page {
    box-shadow: none !important;
    border-radius: 0 !important;
    margin: 0 auto !important;
    padding: 0 !important;
    animation: none !important;
    page-break-after: always !important;
    page-break-inside: avoid !important;
    border: none !important;
    height: auto !important;
    display: block !important;
    position: relative !important;
    visibility: visible !important;
    width: 100% !important;
    max-width: 210mm !important;
  }
  
  /* Remove page break after the last visible page to avoid blank trailing page */
  .form-page:last-of-type:not(.hidden),
  .form-page:not(.hidden) + .form-page.hidden ~ .form-page.hidden,
  .form-page.conventional-page:last-of-type,
  .form-page.taqwa-page:last-of-type,
  .form-page.others-page:last-of-type {
    page-break-after: auto !important;
  }
  
  /* Specifically target last visible conventional page (page 4) */
  .form-page.conventional-page[data-page="4"]:not(.hidden) {
    page-break-after: auto !important;
  }
  
  /* Specifically target last visible taqwa page (page 8) */
  .form-page.taqwa-page[data-page="8"]:not(.hidden) {
    page-break-after: auto !important;
  }
  
  /* Specifically target last visible others page (page 13) */
  .form-page.others-page[data-page="13"]:not(.hidden) {
    page-break-after: auto !important;
  }
  
  /* Specifically target others page 14 and 15 */
  .form-page.others-page[data-page="14"]:not(.hidden) {
    page-break-after: auto !important;
  }
  
  .form-page.others-page[data-page="15"]:not(.hidden) {
    page-break-after: auto !important;
  }
  
  .form-page.hidden {
    display: none !important;
    visibility: hidden !important;
  }
  
  .form-page img {
    display: block !important;
    width: 100% !important;
    height: auto !important;
    max-width: 100% !important;
    margin: 0 !important;
    padding: 0 !important;
    border: none !important;
    visibility: visible !important;
  }
  
  .overlay {
    display: block !important;
    position: absolute !important;
    visibility: visible !important;
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
  }
  
  .overlay.editing {
    pointer-events: none !important;
  }
}

/* Left Slide Menu (copied from Account Opening editor) */
.slide-menu-toggle {
  position: fixed;
  left: 0;
  top: 50%;
  transform: translateY(-50%);
  z-index: 1001;
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  color: #fff;
  border: none;
  border-radius: 0 var(--radius-md) var(--radius-md) 0;
  padding: 14px 9px;
  cursor: pointer;
  box-shadow: var(--shadow-md);
  transition: var(--transition-normal);
  display: flex;
  align-items: center;
  justify-content: center;
}
.slide-menu-toggle:hover { padding-left: 14px; background: linear-gradient(135deg, var(--primary-dark), var(--accent)); }
.slide-menu-toggle i { font-size: 1.2rem; }

.slide-menu-backdrop { position: fixed; inset: 0; background: rgba(15, 23, 42, 0.4); z-index: 1002; opacity: 0; visibility: hidden; transition: var(--transition-normal); }
.slide-menu-backdrop.show { opacity: 1; visibility: visible; }

.slide-menu { position: fixed; left: 0; top: 0; bottom: 0; width: 252px; max-width: 85vw; background: var(--card-bg); z-index: 1003; box-shadow: var(--shadow-lg); transform: translateX(-100%); transition: var(--transition-normal); display: flex; flex-direction: column; }
.slide-menu.open { transform: translateX(0); }
.slide-menu-header { display: flex; align-items: center; justify-content: space-between; padding: 18px; background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: #fff; }
.slide-menu-header h3 { font-size: 1.1rem; font-weight: 600; display: flex; align-items: center; gap: 10px; }
.slide-menu-close { background: rgba(255,255,255,0.2); border: none; color: #fff; width: 32px; height: 32px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: var(--transition-fast); }
.slide-menu-close:hover { background: rgba(255,255,255,0.3); }
.slide-menu-body { flex: 1; overflow-y: auto; padding: 14px; }
.slide-menu-nav { list-style: none; }
.slide-menu-nav li { margin-bottom: 4px; }
.slide-menu-nav a { display: flex; align-items: center; gap: 12px; padding: 12px 16px; border-radius: var(--radius-md); color: var(--text-primary); text-decoration: none; font-weight: 500; transition: var(--transition-fast); }
.slide-menu-nav a:hover { background: var(--bg-secondary); color: var(--primary); }
.slide-menu-nav a i { width: 20px; }

/* Account Type Popup */
.account-type-popup-backdrop {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(15, 23, 42, 0.7);
  backdrop-filter: blur(6px);
  z-index: 2000;
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.35s ease, visibility 0.35s ease;
}
.account-type-popup-backdrop.show { opacity: 1; visibility: visible; }
.account-type-popup {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0.92);
  background: var(--card-bg);
  border-radius: 16px;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255,255,255,0.05);
  width: 96%;
  max-width: 980px;
  height: auto;
  max-height: 88vh;
  z-index: 2001;
  opacity: 0;
  visibility: hidden;
  transition: transform 0.35s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.35s ease, visibility 0.35s ease;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}
.account-type-popup-backdrop.show .account-type-popup { opacity: 1; visibility: visible; transform: translate(-50%, -50%) scale(1); }
.account-type-popup-header { 
  display: flex; 
  align-items: center; 
  justify-content: space-between; 
  padding: 20px 24px; 
  background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%); 
  color: #fff;
  border-bottom: 3px solid rgba(59, 130, 246, 0.3);
}
.account-type-popup-header h3 { 
  font-size: 1.25rem; 
  font-weight: 700; 
  display: flex; 
  gap: 10px; 
  align-items: center;
  letter-spacing: -0.02em;
}
.account-type-popup-close { 
  background: rgba(255, 255, 255, 0.15); 
  border: none; 
  color: #fff; 
  width: 36px; 
  height: 36px; 
  border-radius: 50%; 
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
  font-size: 1.1rem;
}
.account-type-popup-close:hover { 
  background: rgba(255, 255, 255, 0.25); 
  transform: rotate(90deg);
}
.account-type-popup-body { 
  padding: 24px; 
  display: flex; 
  gap: 24px; 
  flex: 1; 
  overflow: hidden;
  background: var(--bg-primary);
}
.account-type-form { 
  flex: 1.2; 
  overflow-y: auto; 
  padding-right: 12px;
  display: flex;
  flex-direction: column;
  gap: 20px;
}
.account-type-presets { 
  width: 420px; 
  border-left: 2px solid var(--border-color); 
  padding-left: 24px; 
  display: flex; 
  flex-direction: column;
  background: var(--card-bg);
  border-radius: 12px;
  padding: 20px;
  margin: -10px -10px -10px 0;
}
.account-type-presets-title { 
  font-weight: 700; 
  color: var(--primary); 
  margin-bottom: 16px; 
  font-size: 1rem;
  display: flex;
  align-items: center;
  gap: 8px;
  padding-bottom: 12px;
  border-bottom: 2px solid var(--border-color);
}
.account-type-popup-body .row { display: flex; gap: 10px; align-items: center; }
.account-type-select { 
  width: 100%; 
  padding: 12px 16px; 
  border-radius: 10px; 
  border: 2px solid var(--border-color);
  font-size: 1rem;
  font-weight: 500;
  background: var(--card-bg);
  transition: all 0.2s ease;
  cursor: pointer;
}
.account-type-select:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

/* Presets Popup */
.presets-popup-backdrop { position: fixed; top:0; left:0; right:0; bottom:0; background: rgba(15,23,42,0.6); backdrop-filter: blur(4px); z-index:2100; opacity:0; visibility:hidden; transition: opacity .25s, visibility .25s; }
.presets-popup-backdrop.show { opacity:1; visibility:visible; }
.presets-popup { position: fixed; top:50%; left:50%; transform: translate(-50%,-50%) scale(.95); width:90%; max-width:720px; background:var(--card-bg); border-radius:var(--radius-xl); box-shadow:var(--shadow-lg); z-index:2101; opacity:0; visibility:hidden; transition: transform .25s, opacity .25s; }
.presets-popup-backdrop.show .presets-popup { opacity:1; visibility:visible; transform: translate(-50%,-50%) scale(1); }
.presets-popup-header { padding:12px 16px; background: linear-gradient(135deg,var(--primary),var(--primary-dark)); color:#fff; display:flex; align-items:center; justify-content:space-between; }
.presets-popup-body { padding:14px 16px; max-height:60vh; overflow:auto; }
.presets-list { list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:8px; }
.presets-item { display:flex; align-items:center; justify-content:space-between; padding:10px; border-radius:8px; background:var(--bg-secondary); }
.presets-item .meta { font-size:0.95rem; color:var(--text-secondary); }
.presets-empty { text-align:center; padding:30px; color:var(--text-muted); }

/* Saved Presets Panel (Full Form Data) */
.saved-presets-panel { position:fixed; top:0; right:-420px; width:400px; height:100%; background:var(--card-bg); box-shadow:-8px 0 40px rgba(0,0,0,0.15); z-index:1100; transition:right 0.4s cubic-bezier(0.4,0,0.2,1); display:flex; flex-direction:column; border-left:1px solid var(--border-color); }
.saved-presets-panel.open { right:0; }
.saved-presets-header { padding:20px; background:linear-gradient(135deg,var(--primary),var(--primary-dark)); color:white; display:flex; align-items:center; justify-content:space-between; }
.saved-presets-header h3 { font-size:1.1rem; font-weight:700; display:flex; align-items:center; gap:10px; }
.saved-presets-close { background:rgba(255,255,255,0.2); border:none; color:white; width:36px; height:36px; border-radius:50%; cursor:pointer; font-size:1.1rem; transition:var(--transition-normal); display:flex; align-items:center; justify-content:center; }
.saved-presets-close:hover { background:rgba(255,255,255,0.3); transform:rotate(90deg); }
.saved-presets-list { flex:1; overflow-y:auto; padding:16px; background:var(--bg-primary); }
.saved-preset-item { background:white; border-radius:var(--radius-md); padding:16px; margin-bottom:12px; border:2px solid var(--border-color); transition:var(--transition-normal); }
.saved-preset-item:hover { border-color:var(--primary); transform:translateX(-4px); box-shadow:var(--shadow-md); }
.saved-preset-item h4 { font-size:1rem; margin-bottom:6px; color:var(--text-primary); font-weight:700; display:flex; align-items:center; gap:8px; }
.saved-preset-item p { font-size:0.85rem; color:var(--text-secondary); margin-bottom:10px; }
.saved-preset-actions { display:flex; gap:8px; }
.saved-preset-btn { padding:8px 14px; border-radius:var(--radius-sm); border:none; cursor:pointer; font-size:0.85rem; font-weight:600; transition:var(--transition-normal); }
.saved-preset-btn.load { background:linear-gradient(135deg,var(--primary),var(--primary-dark)); color:white; }
.saved-preset-btn.load:hover { transform:translateY(-2px); box-shadow:0 4px 15px rgba(14,165,233,0.4); }
.saved-preset-btn.delete { background:linear-gradient(135deg,var(--danger),#dc2626); color:white; }
.saved-preset-btn.delete:hover { transform:translateY(-2px); box-shadow:0 4px 15px rgba(239,68,68,0.4); }
.saved-presets-backdrop { position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(15,23,42,0.6); backdrop-filter:blur(4px); -webkit-backdrop-filter:blur(4px); z-index:1050; opacity:0; visibility:hidden; transition:var(--transition-normal); }
.saved-presets-backdrop.show { opacity:1; visibility:visible; }
/* Toast notification */
.toast { position:fixed; bottom:30px; left:50%; transform:translateX(-50%) translateY(100px); background:var(--text-primary); color:white; padding:14px 28px; border-radius:var(--radius-md); font-weight:600; z-index:9999; opacity:0; transition:all 0.3s ease; box-shadow:var(--shadow-lg); }
.toast.show { opacity:1; transform:translateX(-50%) translateY(0); }

/* Officer Seal Popup */
.officer-seal-popup-backdrop {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(15, 23, 42, 0.6);
  backdrop-filter: blur(4px);
  z-index: 2000;
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.3s ease, visibility 0.3s ease;
}
.officer-seal-popup-backdrop.show {
  opacity: 1;
  visibility: visible;
}
.officer-seal-popup {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0.9);
  background: var(--card-bg);
  border-radius: var(--radius-xl);
  box-shadow: var(--shadow-lg);
  width: 80%;
  max-width: 648px;
  overflow: hidden;
  z-index: 2001;
  opacity: 0;
  visibility: hidden;
  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s ease, visibility 0.3s ease;
}
.officer-seal-popup-backdrop.show .officer-seal-popup {
  opacity: 1;
  visibility: visible;
  transform: translate(-50%, -50%) scale(1);
}
.officer-seal-popup-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 16px;
  background: linear-gradient(135deg, #059669 0%, #047857 100%);
  color: white;
}
.officer-seal-popup-header h3 {
  font-size: 0.88rem;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 8px;
}
.officer-seal-popup-close {
  background: rgba(255,255,255,0.2);
  border: none;
  color: white;
  width: 28px;
  height: 28px;
  border-radius: 50%;
  cursor: pointer;
  transition: var(--transition-fast);
}
.officer-seal-popup-close:hover {
  background: rgba(255,255,255,0.3);
}
.officer-seal-popup-body {
  padding: 18px;
  overflow-y: visible;
  display: flex;
  flex-direction: column;
  gap: 16px;
}
.officer-seal-fields {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 16px;
  margin-bottom: 22px;
  padding-bottom: 22px;
  border-bottom: 2px solid var(--border-color);
}
.officer-seal-field {
  display: flex;
  flex-direction: column;
  gap: 8px;
}
.officer-seal-field label {
  font-weight: 700;
  color: var(--primary);
  font-size: 0.78rem;
  display: flex;
  align-items: center;
  gap: 6px;
}
.officer-seal-field label i {
  font-size: 0.9rem;
}
.officer-seal-field input,
.officer-seal-field textarea {
  padding: 10px 11px;
  border: 2px solid var(--border-color);
  border-radius: 6px;
  font-size: 0.70rem;
  transition: var(--transition-fast);
  font-family: inherit;
  resize: vertical;
}
.officer-seal-field textarea {
  min-height: 80px;
  line-height: 1.3;
}
.officer-seal-field input:focus,
.officer-seal-field textarea:focus {
  outline: none;
  border-color: #059669;
  box-shadow: 0 0 0 3px rgba(5, 150, 105, 0.15);
  background: rgba(5, 150, 105, 0.02);
}
.seal-preview-section {
  margin-bottom: 0;
  text-align: center;
  flex-shrink: 0;
}
.seal-preview-title {
  font-weight: 700;
  color: var(--text-secondary);
  margin-bottom: 12px;
  font-size: 0.78rem;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
}
.seal-preview {
  display: flex;
  justify-content: center;
  gap: 19px;
  margin-bottom: 20px;
  flex-wrap: nowrap;
}
.seal-item {
  width: 114px;
  height: 114px;
  border: none;
  border-radius: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  font-size: 0.53rem;
  font-weight: 800;
  color: #000;
  padding: 10px;
  word-break: break-word;
  background: rgba(0, 0, 0, 0.02);
  line-height: 1.2;
  overflow: hidden;
  position: relative;
  box-shadow: none;
}
.seal-item::before {
  content: '';
  position: absolute;
  width: 100%;
  height: 100%;
  border-radius: 0;
  background: none;
  opacity: 0;
  pointer-events: none;
}
.seal-item-text {
  position: relative;
  z-index: 1;
  white-space: pre-wrap;
}
.officer-seal-save-btn {
  width: 100%;
  padding: 14px 24px;
  background: linear-gradient(135deg, #059669 0%, #047857 100%);
  color: white;
  border: none;
  border-radius: 8px;
  font-weight: 600;
  font-size: 1rem;
  cursor: pointer;
  transition: var(--transition-fast);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}
.officer-seal-save-btn:hover {
  box-shadow: 0 4px 15px rgba(5, 150, 105, 0.4);
  transform: translateY(-2px);
}
.officer-seal-save-btn:active {
  transform: translateY(0);
}
@media (max-width: 1024px) {
  .officer-seal-fields {
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
  }
}
@media (max-width: 768px) {
  .officer-seal-fields {
    grid-template-columns: 1fr;
    gap: 14px;
  }
  .seal-preview {
    gap: 16px;
  }
  .seal-item {
    width: 120px;
    height: 120px;
  }
}

  </style>
</head>
<body>

  <!-- Page Navigation -->
  <nav class="page-nav">
    <h1><i class="fas fa-file-alt"></i>TD/RD Account Form Editor</h1>
    <div class="nav-buttons">
      <button class="nav-btn active" data-page="info"><i class="fas fa-edit"></i> <span>Information Input</span></button>
      <button class="nav-btn" data-page="form"><i class="fas fa-file-image"></i> <span>Form Preview</span></button>
    </div>
  </nav>

  <!-- Left Slide Menu Toggle -->
  <button class="slide-menu-toggle" id="slideMenuToggle" title="Open Menu"><i class="fas fa-bars"></i></button>
  <!-- Slide Menu Backdrop -->
  <div class="slide-menu-backdrop" id="slideMenuBackdrop"></div>
  <!-- Slide Menu Panel -->
  <div class="slide-menu" id="slideMenu">
    <div class="slide-menu-header">
      <h3><i class="fas fa-list"></i> Quick Navigation</h3>
      <button class="slide-menu-close" id="slideMenuClose"><i class="fas fa-times"></i></button>
    </div>
    <div class="slide-menu-body">
      <div class="slide-quick-field" style="padding:5px 7px; border-bottom:1px solid var(--border-color);">
        <label for="slideBranchInput" style="display:block; font-weight:600; color:var(--text-secondary); margin-bottom:3px; font-size:0.95rem;">Branch Name</label>
        <input id="slideBranchInput" name="branchName" type="text" placeholder="Branch name" style="width:100%; padding:6px 8px; border-radius:4px; border:1px solid var(--border-color); font-size:0.95rem;">
      </div>
      <ul class="slide-menu-nav" style="padding:7px; display:flex; flex-direction:column; gap:5px;">
        <li style="margin-bottom:2.5px;"><a href="#" id="slideMenuAccountType"><i class="fas fa-list-alt"></i> Product Details</a></li>
        <li style="margin-bottom:2.5px;"><a href="#" id="slideMenuOfficerSeal"><i class="fas fa-stamp"></i> Officer Seal</a></li>
        <li style="margin-bottom:2.5px;"><a href="#" id="slideMenuSavePreset"><i class="fas fa-save"></i> Save Preset</a></li>
        <li style="margin-bottom:2.5px;"><a href="#" id="slideMenuPresets"><i class="fas fa-folder-open"></i> Presets</a></li>
        <li style="margin-bottom:2.5px;"><a href="#" id="slideMenuExport"><i class="fas fa-file-export"></i> Export</a></li>
        <li style="margin-bottom:2.5px;"><a href="#" id="slideMenuImport"><i class="fas fa-file-import"></i> Import</a></li>
        <li style="margin-bottom:2.5px;"><a href="https://www.ucb.com.bd/rates/interest-rates/" target="_blank"><i class="fas fa-chart-line"></i> Interest Rates</a></li>
      </ul>
      <div style="padding:6px;border-top:1px solid var(--border-color); margin-top:4px; display:flex; justify-content:center;">
        <div class="developer-credit small footer-rgb" style="margin:0;"><span class="rgb-text">Developed by Tanzil Ahmed â€” EID 7966.</span></div>
      </div>
    </div>
  </div>
      <!-- Account Type Popup -->
      <div class="account-type-popup-backdrop" id="accountTypeBackdrop">
        <div class="account-type-popup">
          <div class="account-type-popup-header">
            <h3><i class="fas fa-list-alt"></i> Product Details</h3>
            <button class="account-type-popup-close" id="accountTypeClose"><i class="fas fa-times"></i></button>
          </div>
          <div class="account-type-popup-body">
            <div class="account-type-form">
              <!-- Account Type Selection -->
              <div style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.08), rgba(147, 51, 234, 0.08)); padding: 18px; border-radius: 12px; border: 2px solid rgba(59, 130, 246, 0.2);">
                <label style="display: flex; align-items: center; gap: 8px; font-weight: 700; color: var(--primary); margin-bottom: 12px; font-size: 1rem;">
                  <i class="fas fa-layer-group"></i> Account Type
                </label>
                <select id="accountTypeSelectPopup" class="account-type-select">
                  <option value="">Select Account Type</option>
                  <option value="FDR">ðŸ“Š FDR (Fixed Deposit Receipt)</option>
                  <option value="DPS">ðŸ’° DPS (Deposit Pension Scheme)</option>
                </select>
              </div>
              
              <!-- FDR specific fields -->
              <div class="fdr-fields" id="fdrFields" style="display:none; background: var(--card-bg); padding: 24px; border-radius: 12px; border: 2px solid rgba(34, 197, 94, 0.3); box-shadow: 0 4px 12px rgba(0,0,0,0.05);">
                <h4 style="margin-bottom: 18px; color: #059669; font-size: 1.1rem; font-weight: 700; display: flex; align-items: center; gap: 10px; padding-bottom: 12px; border-bottom: 2px solid rgba(34, 197, 94, 0.2);">
                  <i class="fas fa-money-check-alt"></i> FDR Product Details
                </h4>
                <div style="display: flex; flex-direction: column; gap: 18px;">
                  <div>
                    <label style="display: flex; align-items: center; gap: 8px; font-weight: 600; color: var(--text-primary); margin-bottom: 8px; font-size: 0.92rem;">
                      <i class="fas fa-tag" style="color: #059669;"></i> Product Name
                    </label>
                    <input type="text" id="fdrProductName" placeholder=" " style="width: 100%; padding: 12px 16px; border-radius: 10px; border: 2px solid var(--border-color); font-size: 0.95rem; transition: all 0.2s ease; box-sizing: border-box;" onfocus="this.style.borderColor='#3b82f6'; this.style.boxShadow='0 0 0 3px rgba(59,130,246,0.1)'" onblur="this.style.borderColor='var(--border-color)'; this.style.boxShadow='none'">
                  </div>
                  <div>
                    <label style="display: flex; align-items: center; gap: 8px; font-weight: 600; color: var(--text-primary); margin-bottom: 8px; font-size: 0.92rem;">
                      <i class="fas fa-percentage" style="color: #059669;"></i> Interest Rate
                    </label>
                    <div style="position: relative;">
                      <input type="text" id="fdrInterestRate" placeholder="9.5" style="width: 100%; padding: 12px 40px 12px 16px; border-radius: 10px; border: 2px solid var(--border-color); font-size: 0.95rem; font-weight: 600; transition: all 0.2s ease; box-sizing: border-box;" onfocus="this.style.borderColor='#3b82f6'; this.style.boxShadow='0 0 0 3px rgba(59,130,246,0.1)'" onblur="this.style.borderColor='var(--border-color)'; this.style.boxShadow='none'">
                      <span style="position: absolute; right: 16px; top: 50%; transform: translateY(-50%); font-weight: 700; color: var(--text-secondary);">%</span>
                    </div>
                  </div>
                  <div>
                    <label style="display: flex; align-items: center; gap: 8px; font-weight: 600; color: var(--text-primary); margin-bottom: 8px; font-size: 0.92rem;">
                      <i class="fas fa-calendar-alt" style="color: #059669;"></i> Tenure Period
                    </label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
                      <div>
                        <input type="number" id="fdrTenorYears" placeholder="Years" min="0" style="width: 100%; padding: 12px; border-radius: 10px; border: 2px solid var(--border-color); font-size: 0.95rem; text-align: center; font-weight: 600; transition: all 0.2s ease; box-sizing: border-box;" onfocus="this.style.borderColor='#3b82f6'; this.style.boxShadow='0 0 0 3px rgba(59,130,246,0.1)'" onblur="this.style.borderColor='var(--border-color)'; this.style.boxShadow='none'">
                        <div style="text-align: center; margin-top: 6px; font-size: 0.8rem; color: var(--text-muted); font-weight: 600;">Years</div>
                      </div>
                      <div>
                        <input type="number" id="fdrTenorMonths" placeholder="Months" min="0" style="width: 100%; padding: 12px; border-radius: 10px; border: 2px solid var(--border-color); font-size: 0.95rem; text-align: center; font-weight: 600; transition: all 0.2s ease; box-sizing: border-box;" onfocus="this.style.borderColor='#3b82f6'; this.style.boxShadow='0 0 0 3px rgba(59,130,246,0.1)'" onblur="this.style.borderColor='var(--border-color)'; this.style.boxShadow='none'">
                        <div style="text-align: center; margin-top: 6px; font-size: 0.8rem; color: var(--text-muted); font-weight: 600;">Months</div>
                      </div>
                      <div>
                        <input type="number" id="fdrTenorDays" placeholder="Days" min="0" style="width: 100%; padding: 12px; border-radius: 10px; border: 2px solid var(--border-color); font-size: 0.95rem; text-align: center; font-weight: 600; transition: all 0.2s ease; box-sizing: border-box;" onfocus="this.style.borderColor='#3b82f6'; this.style.boxShadow='0 0 0 3px rgba(59,130,246,0.1)'" onblur="this.style.borderColor='var(--border-color)'; this.style.boxShadow='none'">
                        <div style="text-align: center; margin-top: 6px; font-size: 0.8rem; color: var(--text-muted); font-weight: 600;">Days</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- DPS specific fields -->
              <div class="dps-fields" id="dpsFields" style="display:none; background: var(--card-bg); padding: 24px; border-radius: 12px; border: 2px solid rgba(236, 72, 153, 0.3); box-shadow: 0 4px 12px rgba(0,0,0,0.05);">
                <h4 style="margin-bottom: 18px; color: #db2777; font-size: 1.1rem; font-weight: 700; display: flex; align-items: center; gap: 10px; padding-bottom: 12px; border-bottom: 2px solid rgba(236, 72, 153, 0.2);">
                  <i class="fas fa-piggy-bank"></i> DPS Scheme Details
                </h4>
                <div style="display: flex; flex-direction: column; gap: 18px;">
                  <div>
                    <label style="display: flex; align-items: center; gap: 8px; font-weight: 600; color: var(--text-primary); margin-bottom: 8px; font-size: 0.92rem;">
                      <i class="fas fa-file-signature" style="color: #db2777;"></i> Scheme Name
                    </label>
                    <input type="text" id="dpsSchemeName" placeholder=" " style="width: 100%; padding: 12px 16px; border-radius: 10px; border: 2px solid var(--border-color); font-size: 0.95rem; transition: all 0.2s ease; box-sizing: border-box;" onfocus="this.style.borderColor='#3b82f6'; this.style.boxShadow='0 0 0 3px rgba(59,130,246,0.1)'" onblur="this.style.borderColor='var(--border-color)'; this.style.boxShadow='none'">
                  </div>
                  <div>
                    <label style="display: flex; align-items: center; gap: 8px; font-weight: 600; color: var(--text-primary); margin-bottom: 8px; font-size: 0.92rem;">
                      <i class="fas fa-hourglass-half" style="color: #db2777;"></i> Duration (Years)
                    </label>
                    <input type="number" id="dpsYears" placeholder="e.g., 5" min="0" style="width: 100%; padding: 12px 16px; border-radius: 10px; border: 2px solid var(--border-color); font-size: 0.95rem; font-weight: 600; transition: all 0.2s ease; box-sizing: border-box;" onfocus="this.style.borderColor='#3b82f6'; this.style.boxShadow='0 0 0 3px rgba(59,130,246,0.1)'" onblur="this.style.borderColor='var(--border-color)'; this.style.boxShadow='none'">
                  </div>
                </div>
              </div>
              
              <!-- Action Buttons -->
              <div style="display: flex; justify-content: flex-end; gap: 12px; padding-top: 8px;">
                <button class="btn" id="accountTypeCancelBtn" style="padding: 12px 24px; border-radius: 10px; font-weight: 600; font-size: 0.95rem; background: var(--bg-secondary); color: var(--text-primary); border: 2px solid var(--border-color); transition: all 0.2s ease;" onmouseover="this.style.background='var(--border-color)'" onmouseout="this.style.background='var(--bg-secondary)'">
                  <i class="fas fa-times"></i> Cancel
                </button>
                <button class="btn btn-info" id="accountTypeSaveBtn" style="padding: 12px 28px; border-radius: 10px; font-weight: 700; font-size: 0.95rem; background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; border: none; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3); transition: all 0.2s ease;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(59, 130, 246, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(59, 130, 246, 0.3)'">
                  <i class="fas fa-check-circle"></i> Save Product
                </button>
              </div>
            </div>

            <!-- Presets List (Right Side) -->
            <div class="account-type-presets">
              <div class="account-type-presets-title"><i class="fas fa-folder-open"></i> Product</div>
              <ul class="presets-list" id="presetsList" style="flex:1; list-style:none; padding:0; margin:0; overflow-y:auto; display:flex; flex-direction:column; gap:6px;"></ul>
              <div class="presets-empty" id="presetsEmpty" style="text-align:center; padding:20px 10px; color:var(--text-muted); font-size:0.9rem;">No product saved yet.</div>
            </div>
          </div>
        </div>
      </div>

  <!-- Officer Seal Popup -->
  <div class="officer-seal-popup-backdrop" id="officerSealBackdrop">
    <div class="officer-seal-popup">
      <div class="officer-seal-popup-header">
        <h3><i class="fas fa-stamp"></i> Officer Seal</h3>
        <button class="officer-seal-popup-close" id="officerSealClose"><i class="fas fa-times"></i></button>
      </div>
      <div class="officer-seal-popup-body">
        <div class="officer-seal-fields">
          <div class="officer-seal-field">
            <label for="officer1Name"><i class="fas fa-user-tie"></i> Officer 1</label>
            <textarea id="officer1Name" placeholder="Name&#10;Designation&#10;Bank/Organization&#10;Branch&#10;ID/Reference"></textarea>
          </div>
          <div class="officer-seal-field">
            <label for="officer2Name"><i class="fas fa-user-tie"></i> Officer 2</label>
            <textarea id="officer2Name" placeholder="Name&#10;Designation&#10;Bank/Organization&#10;Branch&#10;ID/Reference"></textarea>
          </div>
          <div class="officer-seal-field">
            <label for="officer3Name"><i class="fas fa-user-tie"></i> Officer 3</label>
            <textarea id="officer3Name" placeholder="Name&#10;Designation&#10;Bank/Organization&#10;Branch&#10;ID/Reference"></textarea>
          </div>
        </div>
        <div class="officer-seal-controls" style="display:flex;align-items:center;gap:12px;margin-bottom:12px;">
          <label for="officerSealSize" style="font-weight:600;color:var(--text-secondary);">Seal Size</label>
          <input id="officerSealSize" type="range" min="80" max="220" value="140" />
          <span id="officerSealSizeValue" style="min-width:56px;display:inline-block;text-align:left;">140px</span>
        </div>
        <div class="seal-preview-section">
          <div class="seal-preview-title"><i class="fas fa-square"></i> Seal Preview</div>
          <div class="seal-preview">
            <div class="seal-item" id="sealPreview1"><div class="seal-item-text">Officer 1</div></div>
            <div class="seal-item" id="sealPreview2"><div class="seal-item-text">Officer 2</div></div>
            <div class="seal-item" id="sealPreview3"><div class="seal-item-text">Officer 3</div></div>
          </div>
        </div>
        <button type="button" class="officer-seal-save-btn" id="saveOfficerSealBtn"><i class="fas fa-save"></i> Save Officer Seals</button>
      </div>
    </div>
  </div>

  <!-- Page 1: Information Input -->
  <div class="page-container active" id="info-page">
    <div class="info-page">
      <form id="deposit-account-form">
        <div class="form-sections">
          
          <!-- Account Information -->
          <div class="form-section" id="account-info">
            <div class="section-header">
              <i class="fas fa-university"></i>
              <h2>Account Information</h2>
              <i class="fas fa-chevron-down section-toggle"></i>
            </div>
            <div class="form-fields">
              <!-- Account Identifiers -->
              <div class="sub-section-header">
                <i class="fas fa-fingerprint"></i>
                <span>Account Identifiers</span>
              </div>
              <div class="form-group">
                <label>Account Number</label>
                <input type="text" name="accountNumber" placeholder="Enter account number">
              </div>
              <div class="form-group">
                <label>CIF Number</label>
                <input type="text" name="cifNumber" placeholder="Enter CIF number">
              </div>
              <div class="form-group">
                <label>RM Code</label>
                <input type="text" name="rmCode" placeholder="RM Code">
              </div>
              <div class="form-group">
                <label>Debit My Account</label>
                <input type="text" name="debitMyAccount" placeholder="Debit my account">
              </div>
              <div class="form-group">
                <label>ISR Bank</label>
                <input type="text" name="isrBank" placeholder="ISR Bank">
              </div>
              <div class="form-group">
                <label>ISR Customer</label>
                <input type="text" name="isrCustomer" placeholder="ISR Customer">
              </div>

              <!-- Account Holder Name -->
              <div class="sub-section-header">
                <i class="fas fa-user-tag"></i>
                <span>Account Holder Name</span>
              </div>
              <div class="form-group">
                <label>Full Name (English)</label>
                <input type="text" name="fullNameEn" placeholder="Enter full name in English">
              </div>
              <div class="form-group">
                <label>Full Name (Bangla)</label>
                <input type="text" name="fullNameBn" placeholder="à¦ªà§‚à¦°à§à¦£ à¦¨à¦¾à¦® à¦¬à¦¾à¦‚à¦²à¦¾à¦¯à¦¼">
              </div>
              <div class="form-group">
                <label>Name of Organization (English)</label>
                <input type="text" name="orgNameEn" placeholder="Enter organization name in English">
              </div>
              <div class="form-group">
                <label>Name of Organization (Bangla)</label>
                <input type="text" name="orgNameBn" placeholder="à¦¸à¦‚à¦¸à§à¦¥à¦¾à¦° à¦¨à¦¾à¦® à¦¬à¦¾à¦‚à¦²à¦¾à¦¯à¦¼">
              </div>

              <!-- Account Configuration -->
              <div class="sub-section-header">
                <i class="fas fa-cogs"></i>
                <span>Account Configuration</span>
              </div>
              <div class="form-group">
                <label>Account Type</label>
                <select name="accountType" id="mainAccountType">
                  <option value="">Select Account Type</option>
                  <option value="FDR">FDR</option>
                  <option value="DPS">DPS</option>
                </select>
              </div>
              <div class="form-group">
                <label>Product</label>
                <select name="productSelect" id="productSelect">
                  <option value="">Select Product</option>
                </select>
              </div>
              <div class="form-group">
                <label id="depositAmountLabel">Amount</label>
                <input type="text" name="depositAmount" placeholder="Enter deposit amount">
              </div>
              <div class="form-group">
                <label>Mode of Operation</label>
                <select name="modeOfOperation" id="modeOfOperation">
                  <option value="">Select Mode</option>
                  <option value="Single">Single</option>
                  <option value="Joint">Joint</option>
                </select>
              </div>

              <!-- Joint Account (if applicable) -->
              <div class="sub-section-header" id="jointAccountHeader" style="display:none;">
                <i class="fas fa-users"></i>
                <span>Joint Account Holders</span>
              </div>
              <div class="form-group" id="secondApplicantField" style="display:none;">
                <label>2nd Applicant</label>
                <input type="text" name="secondApplicant" placeholder="Second applicant name">
              </div>
              <div class="form-group" id="thirdApplicantField" style="display:none;">
                <label>3rd Applicant</label>
                <input type="text" name="thirdApplicant" placeholder="Third applicant name">
              </div>

              <!-- Maturity & Renewal -->
              <div class="sub-section-header">
                <i class="fas fa-sync-alt"></i>
                <span>Maturity & Renewal</span>
              </div>
              <div class="form-group">
                <label>Renewal</label>
                <select name="maturityInstruction">
                  <option value="">Select Option</option>
                  <option value="RenewBoth">Renew both</option>
                  <option value="RenewPrincipal">Renew principal only</option>
                </select>
              </div>
              <div class="form-group" id="creditInterestField">
                <label>Interest Account Number</label>
                <input type="text" name="interestAccountNumber" placeholder="Interest Account Number">
              </div>
              <div class="form-group" style="display:flex; align-items:center; gap:8px;">
                <input type="checkbox" id="sameAsLinkedAccountPersonal" name="sameAsLinkedAccountPersonal" checked>
                <label for="sameAsLinkedAccountPersonal" style="margin:0; font-size:0.95rem; cursor:pointer; white-space:nowrap;">Same as Link Account (Personal)</label>
              </div>
              <div class="form-group" style="display:flex; align-items:center; gap:8px;">
                <input type="checkbox" id="sameAsLinkedAccountNominee" name="sameAsLinkedAccountNominee" checked>
                <label for="sameAsLinkedAccountNominee" style="margin:0; font-size:0.95rem; cursor:pointer; white-space:nowrap;">Same as Link Account (Nominee)</label>
              </div>
            </div>
          </div>

          <!-- Organization Information -->
          <div class="form-section" id="organization-info">
            <div class="section-header">
              <i class="fas fa-building"></i>
              <h2>Organization Information</h2>
              <i class="fas fa-chevron-down section-toggle"></i>
            </div>
            <div class="form-fields org-grid" style="display:grid; grid-template-columns:repeat(4,1fr); gap:12px;">
              <!-- Trade Licence Information -->
              <div class="sub-section-header">
                <i class="fas fa-file-certificate"></i>
                <span>Trade Licence</span>
              </div>
              <div class="form-group">
                <label>Trade Licence No.</label>
                <input type="text" name="tradeLicenceNo" placeholder="Trade licence number">
              </div>
              <div class="form-group">
                <label>Trade Licence Date</label>
                <input type="date" name="tradeLicenceDate">
              </div>
              <div class="form-group">
                <label>Issuing Authority</label>
                <input type="text" name="tradeLicenceAuthority" placeholder="Issuing authority">
              </div>
              <div class="form-group">
                <!-- Identity Documents moved to Personal Details -->
              </div>

              <!-- Registration Details -->
              <div class="sub-section-header">
                <i class="fas fa-registered"></i>
                <span>Registration Details</span>
              </div>
              <div class="form-group">
                <label>Registration No.</label>
                <input type="text" name="registrationNo" placeholder="Registration number">
              </div>
              <div class="form-group">
                <label>Registration Date</label>
                <input type="date" name="registrationDate">
              </div>
              <div class="form-group">
                <label>Registration Authority</label>
                <input type="text" name="registrationAuthority" placeholder="Registration authority">
              </div>
              <div class="form-group">
                <label>Registered Address</label>
                <input type="text" name="registeredAddress" placeholder="Registered address">
              </div>

              <!-- Tax & Business Information -->
              <div class="sub-section-header">
                <i class="fas fa-receipt"></i>
                <span>Tax & Business Information</span>
              </div>
              <div class="form-group">
                <label>VAT Registration No./BIN</label>
                <input type="text" name="vatBin" placeholder="VAT registration or BIN number">
              </div>
              <div class="form-group">
                <label>E-TIN (if any)</label>
                <input type="text" name="eTin" placeholder="E-TIN">
              </div>
              <div class="form-group">
                <label>Business/Office Address</label>
                <input type="text" name="businessAddress" placeholder="Business or office address">
              </div>
              <div class="form-group">
                <label>Annual Turnover</label>
                <input type="text" name="annualTurnover" placeholder="Annual turnover amount">
              </div>

              <!-- Organization Type & Nature -->
              <div class="sub-section-header">
                <i class="fas fa-sitemap"></i>
                <span>Organization Type & Nature</span>
              </div>
              <div class="form-group">
                <label>Type of Organization</label>
                <select name="orgType">
                  <option value="">Select Type of Organization</option>
                  <option value="Proprietorship">Proprietorship</option>
                  <option value="Partnership">Partnership</option>
                  <option value="JointVenture">Joint Venture</option>
                  <option value="PrivateLtd">Private Limited Company</option>
                  <option value="PublicLtd">Public Limited Company</option>
                  <option value="Trust">Trust</option>
                  <option value="NGO">NGO/NPO</option>
                  <option value="Club">Club/Society</option>
                  <option value="Educational">Educational Institute</option>
                  <option value="Religious">Religious Institute</option>
                  <option value="Others">Others (Please specify)</option>
                </select>
                <input type="text" name="orgTypeOther" placeholder="Please specify if Others selected" style="margin-top:8px; width:100%; padding:8px; border:1px solid var(--border-color); border-radius:4px; box-sizing:border-box; display:none;">
              </div>
              <div class="form-group">
                <label>Type of Business</label>
                <select name="businessType">
                  <option value="">Select Type of Business</option>
                  <option value="Trading">Trading</option>
                  <option value="Service">Service</option>
                  <option value="Manufacturing">Manufacturing</option>
                  <option value="Others">Others (Please specify)</option>
                </select>
                <input type="text" name="businessTypeOther" placeholder="Please specify if Others selected" style="margin-top:8px; width:100%; padding:8px; border:1px solid var(--border-color); border-radius:4px; box-sizing:border-box; display:none;">
              </div>
              <div class="form-group">
                <label>Nature of Business (Details)</label>
                <input type="text" name="businessNature" placeholder="Describe the nature of business" />
              </div>
            </div>
          </div>

          <!-- Individual Information -->
          <div class="form-section" id="depositor-info">
            <div class="section-header">
              <i class="fas fa-user"></i>
              <h2>Individual Information</h2>
              <i class="fas fa-chevron-down section-toggle"></i>
            </div>
            <div class="form-fields">
              <!-- Personal Details -->
              <div class="sub-section-header">
                <i class="fas fa-id-card"></i>
                <span>Personal Details</span>
              </div>
              <div class="form-group">
                <label>Date of Birth</label>
                <input type="date" name="dateOfBirth">
              </div>
              <div class="form-group">
                <label>Identity Document</label>
                <select name="identityDocumentType">
                  <option value="">Select ID Type</option>
                  <option value="NID">National ID</option>
                  <option value="Passport">Passport</option>
                  <option value="BirthCertificate">Birth Certificate</option>
                  <option value="Others">Others</option>
                </select>
                <input type="text" name="identityDocumentNumber" placeholder="Document number" style="margin-top:8px; width:100%; padding:8px; box-sizing:border-box;">
              </div>
              <div class="form-group">
                <label>Gender</label>
                <select name="gender">
                  <option value="">Select Gender</option>
                  <option value="Male">Male</option>
                  <option value="Female">Female</option>
                  <option value="Third">Third Gender</option>
                </select>
              </div>
              <div class="form-group">
                <label>Nationality</label>
                <input type="text" name="nationality" placeholder="Nationality">
              </div>
              <!-- Duplicate Identity Document block removed -->
              <div class="form-group">
                <!-- Placeholder for alignment -->
              </div>
              <!-- Hidden fields for specific identity document numbers -->
              <input type="hidden" name="nationalIdNumber" value="">
              <input type="hidden" name="passportNumber" value="">
              <input type="hidden" name="birthCertificateNumber" value="">

              <!-- Family Information -->
              <div class="sub-section-header">
                <i class="fas fa-users"></i>
                <span>Family Information</span>
              </div>
              <div class="form-group">
                <label>Father's Name</label>
                <input type="text" name="fatherName" placeholder="Father's full name">
              </div>
              <div class="form-group">
                <label>Mother's Name</label>
                <input type="text" name="motherName" placeholder="Mother's full name">
              </div>
              <div class="form-group">
                <label>Spouse's Name</label>
                <input type="text" name="spouseName" placeholder="Spouse's full name">
              </div>
              <div class="form-group">
                <!-- Placeholder for alignment -->
              </div>

              <!-- Occupation & Income -->
              <div class="sub-section-header">
                <i class="fas fa-briefcase"></i>
                <span>Occupation & Income</span>
              </div>
              <div class="form-group">
                <label>Profession (In details)</label>
                <input type="text" name="profession" placeholder="Profession in details">
              </div>
              <div class="form-group">
                <label>Probable Monthly Income</label>
                <input type="text" name="probableMonthlyIncome" placeholder="Estimated monthly income">
              </div>
              <div class="form-group">
                <label>Source of Fund (In details)</label>
                <input type="text" name="sourceOfFund" placeholder="Source of funds">
              </div>
              <div class="form-group">
                <label>E-TIN (if any)</label>
                <input type="text" name="eTinIndividual" placeholder="E-TIN number">
              </div>

              <!-- Identity Documents removed (moved to Personal Details) -->

              <!-- Contact Information -->
              <div class="sub-section-header">
                <i class="fas fa-phone-alt"></i>
                <span>Contact Information</span>
              </div>
              <div class="form-group">
                <label>Mobile Number</label>
                <input type="tel" name="mobileNumber" placeholder="01XXXXXXXXX">
              </div>
              <div class="form-group">
                <label>Email Address</label>
                <input type="email" name="email" placeholder="example@email.com">
              </div>
            </div>
          </div>

          <!-- Present Address -->
          <div class="form-section" id="present-address">
            <div class="section-header">
              <i class="fas fa-map-marker-alt"></i>
              <h2>Present Address</h2>
              <i class="fas fa-chevron-down section-toggle"></i>
            </div>
            <div class="form-fields">
              <div class="form-group">
                <label>House/Holding No.</label>
                <input type="text" name="presentHouse" placeholder="House/Holding number">
              </div>
              <div class="form-group">
                <label>Area/Village</label>
                <input type="text" name="presentArea" placeholder="Area/Village">
              </div>
              <div class="form-group">
                <label>Post Office</label>
                <input type="text" name="presentPostOffice" placeholder="Post Office">
              </div>
              <div class="form-group">
                <label>Post Code</label>
                <input type="text" name="presentPostCode" placeholder="Post Code">
              </div>
              <div class="form-group">
                <label>Thana / Upazila</label>
                <input type="text" name="presentThana" placeholder="Thana/Upazila">
              </div>
              <div class="form-group">
                <label>District</label>
                <input type="text" name="presentDistrict" placeholder="District">
              </div>
              <div class="form-group">
                <label>Country</label>
                <input type="text" name="presentCountry" placeholder="Country">
              </div>
              <input type="hidden" name="presentAddress" />
            </div>
          </div>

          <!-- Permanent Address -->
          <div class="form-section" id="permanent-address">
            <div class="section-header">
              <i class="fas fa-home"></i>
              <h2>Permanent Address</h2>
              <div class="same-as-present-header">
                <label style="margin:0;">
                  <input type="checkbox" id="sameAsPresent" style="margin-right:8px; vertical-align:middle;"> Same as Present Address
                </label>
              </div>
              <i class="fas fa-chevron-down section-toggle"></i>
            </div>
            <div class="form-fields">
              
              <div class="form-group">
                <label>House/Holding No.</label>
                <input type="text" name="permanentHouse" placeholder="House/Holding number">
              </div>
              <div class="form-group">
                <label>Area/Village</label>
                <input type="text" name="permanentArea" placeholder="Area/Village">
              </div>
              <div class="form-group">
                <label>Post Office</label>
                <input type="text" name="permanentPostOffice" placeholder="Post Office">
              </div>
              <div class="form-group">
                <label>Post Code</label>
                <input type="text" name="permanentPostCode" placeholder="Post Code">
              </div>
              <div class="form-group">
                <label>Thana/Upazila</label>
                <input type="text" name="permanentThana" placeholder="Thana/Upazila">
              </div>
              <div class="form-group">
                <label>District</label>
                <input type="text" name="permanentDistrict" placeholder="District">
              </div>
              <div class="form-group">
                <label>Country</label>
                <input type="text" name="permanentCountry" placeholder="Country">
              </div>
              <input type="hidden" name="permanentAddress" />
            </div>
          </div>

          <!-- Nominee Information -->
          <div class="form-section" id="nominee-info">
            <div class="section-header">
              <i class="fas fa-user-shield"></i>
              <h2>Nominee Information</h2>
              <i class="fas fa-chevron-down section-toggle"></i>
            </div>
            <div class="form-fields">
              <div class="form-group">
                <label>Nominee Name</label>
                <input type="text" name="nomineeName" placeholder="Nominee's full name">
              </div>
              <div class="form-group">
                <label>Relationship with Applicant</label>
                <input type="text" name="nomineeRelation" placeholder="e.g., Father, Mother, Spouse">
              </div>
              <div class="form-group">
                <label>Date of Birth</label>
                <input type="date" name="nomineeDob">
              </div>
              <div class="form-group">
                <label>Percentage of Share</label>
                <input type="text" name="nomineeShare" placeholder="% of share">
              </div>
              <div class="form-group">
                <label>Identity Document</label>
                <select name="nomineeIdentityDocumentType">
                  <option value="">Select ID Type</option>
                  <option value="NID">National ID</option>
                  <option value="Passport">Passport</option>
                  <option value="BirthCertificate">Birth Certificate</option>
                  <option value="Others">Others</option>
                </select>
                <input type="text" name="nomineeIdentityDocumentNumber" placeholder="Document number" style="margin-top:8px; width:100%; padding:8px; box-sizing:border-box;">
              </div>
              <div class="form-group">
                <label>Nominee Address</label>
                <div style="margin-bottom: 8px; display: flex; align-items: center; gap: 8px; flex-wrap: nowrap; white-space: nowrap;">
                  <input type="checkbox" id="sameAsAccountHolderAddress" name="sameAsAccountHolderAddress">
                  <label for="sameAsAccountHolderAddress" style="margin: 0; font-size: 0.95rem; cursor: pointer; white-space: nowrap;">Same as Account Holder Address</label>
                </div>
                <input type="text" name="nomineeAddress" placeholder="Nominee's address">
              </div>
              <div class="form-group">
                <label>Phone/Mobile No.</label>
                <input type="tel" name="nomineePhone" placeholder="Phone/Mobile No.">
              </div>
              <div class="form-group">
                <label>E-mail</label>
                <input type="email" name="nomineeEmail" placeholder="E-mail">
              </div>
            </div>
          </div>

          <!-- KYC Information Section -->
          <div class="form-section" id="kyc-info">
            <div class="section-header">
              <i class="fas fa-clipboard-check"></i>
              <h2>KYC Information</h2>
              <i class="fas fa-chevron-down section-toggle"></i>
            </div>
            <div class="form-fields" style="grid-template-columns: repeat(3, 1fr);">
              <!-- Row 1 -->
              <div class="form-group">
                <label>Client's Business</label>
                <select name="kycClientBusiness">
                  <option value="">Select Client's Business</option>
                  <option value="Jewelry/Gold/Valuable Metals Business|5">Jewelry/Gold/Valuable Metals Business â€” Score: 5</option>
                  <option value="NGO/NPO|5">NGO/NPO â€” Score: 5</option>
                  <option value="Money Changer/Courier Service/Mobile Banking Agent|5">Money Changer/Courier Service/Mobile Banking Agent â€” Score: 5</option>
                  <option value="Film Production/Distribution agency|5">Film Production/Distribution agency â€” Score: 5</option>
                  <option value="Real Estate Developer/Agent|5">Real Estate Developer/Agent â€” Score: 5</option>
                  <option value="Mobile phone operator/Internet or cable TV operator|5">Mobile phone operator/Internet or cable TV operator â€” Score: 5</option>
                  <option value="Promoter/Contractor-Construction Projects|5">Promoter/Contractor-Construction Projects â€” Score: 5</option>
                  <option value="Intermediary of buying/selling of land/house|5">Intermediary of buying/selling of land/house â€” Score: 5</option>
                  <option value="Art and Antiquities Dealer|5">Art and Antiquities Dealer â€” Score: 5</option>
                  <option value="Insurance/brokerage agency|5">Insurance/brokerage agency â€” Score: 5</option>
                  <option value="Restaurant/Bar/Night Club/Parlour/Residential Hotel|5">Restaurant/Bar/Night Club/Parlour/Residential Hotel â€” Score: 5</option>
                  <option value="Islamic Institute/organization & educational Institute|5">Islamic Institute/organization & educational Institute â€” Score: 5</option>
                  <option value="Export/Import & Export/Import Agent|5">Export/Import & Export/Import Agent â€” Score: 5</option>
                  <option value="Trust|5">Trust â€” Score: 5</option>
                  <option value="Manpower export|5">Manpower export â€” Score: 5</option>
                  <option value="Business (Petrol Pump/CNG Station)|5">Business (Petrol Pump/CNG Station) â€” Score: 5</option>
                  <option value="Firearms|5">Firearms â€” Score: 5</option>
                  <option value="Ship Breaking business|5">Ship Breaking business â€” Score: 5</option>
                  <option value="RMG/Garments Accessories/packaging/Buying House|5">RMG/Garments Accessories/packaging/Buying House â€” Score: 5</option>
                  <option value="Bank/leasing/Finance Company|4">Bank/leasing/Finance Company â€” Score: 4</option>
                  <option value="Share/Stocks dealer, broker, portfolio manager, merchant banker|5">Share/Stocks dealer, broker, portfolio manager, merchant banker â€” Score: 5</option>
                  <option value="Business (Indenting)|4">Business (Indenting) â€” Score: 4</option>
                  <option value="Software/Information and Technology business|5">Software/Information and Technology business â€” Score: 5</option>
                  <option value="Business (outsourcing)|4">Business (outsourcing) â€” Score: 4</option>
                  <option value="Offshore/Non-Resident Corporation|5">Offshore/Non-Resident Corporation â€” Score: 5</option>
                  <option value="Law firm/engineering firm/consultancy firm|4">Law firm/engineering firm/consultancy firm â€” Score: 4</option>
                  <option value="Fuel & electricity Producing company|4">Fuel & electricity Producing company â€” Score: 4</option>
                  <option value="Service Provider|3">Service Provider â€” Score: 3</option>
                  <option value="Print & Electronic Media|4">Print & Electronic Media â€” Score: 4</option>
                  <option value="Tobacco and Cigarettes Business|3">Tobacco and Cigarettes Business â€” Score: 3</option>
                  <option value="Travel Agent/Tourism Company|4">Travel Agent/Tourism Company â€” Score: 4</option>
                  <option value="Amusement Park/Entertainment Provider|3">Amusement Park/Entertainment Provider â€” Score: 3</option>
                  <option value="Merchant over 10 million investments in business|4">Merchant over 10 million investments in business â€” Score: 4</option>
                  <option value="Motor Parts Trader/Workshop|3">Motor Parts Trader/Workshop â€” Score: 3</option>
                  <option value="Chain Store/shopping mall|4">Chain Store/shopping mall â€” Score: 4</option>
                  <option value="Poultry/dairy/fishing firm|2">Poultry/dairy/fishing firm â€” Score: 2</option>
                  <option value="Freight/Shipping/Cargo Agent/C&F agent|4">Freight/Shipping/Cargo Agent/C&F agent â€” Score: 4</option>
                  <option value="Agro business/rice mill/beverage|2">Agro business/rice mill/beverage â€” Score: 2</option>
                  <option value="Automobiles business (New or Reconditioned)|4">Automobiles business (New or Reconditioned) â€” Score: 4</option>
                  <option value="Small Business (Investment below BDT 5 million)|2">Small Business (Investment below BDT 5 million) â€” Score: 2</option>
                  <option value="Leather/Leather goods Business|4">Leather/Leather goods Business â€” Score: 4</option>
                  <option value="Computer/Mobile Phone Dealer|2">Computer/Mobile Phone Dealer â€” Score: 2</option>
                  <option value="Construction Materials Trader|4">Construction Materials Trader â€” Score: 4</option>
                  <option value="Manufacturer (except weapons)|2">Manufacturer (except weapons) â€” Score: 2</option>
                  <option value="Business Agent|3">Business Agent â€” Score: 3</option>
                  <option value="Transport Operator|3">Transport Operator â€” Score: 3</option>
                  <option value="Thread/'Jhut' Merchant|3">Thread/'Jhut' Merchant â€” Score: 3</option>
                  <option value="Business (medicine production and Marketing)|3">Business (medicine production and Marketing) â€” Score: 3</option>
                  <option value="Cold storage business|3">Cold storage business â€” Score: 3</option>
                  <option value="Business (Advertisement)|3">Business (Advertisement) â€” Score: 3</option>
                  <option value="Others|01-05">Others â€” Score: 01-05</option>
                </select>
              </div>
              <div class="form-group">
                <label>Client's Profession</label>
                <select name="kycClientProfession">
                  <option value="">Select Client's Profession</option>
                  <option value="Pilot/Flight Attendant|5">Pilot/Flight Attendant â€” Score: 5</option>
                  <option value="High Official of Multinational Company (MNC)|4">High Official of Multinational Company (MNC) â€” Score: 4</option>
                  <option value="Trustee|5">Trustee â€” Score: 5</option>
                  <option value="Homemaker|4">Homemaker â€” Score: 4</option>
                  <option value="Professional (Journalist, Lawyer, Doctor, Engineer, Chartered Accountant, etc.)|4">Professional (Journalist, Lawyer, Doctor, Engineer, Chartered Accountant, etc.) â€” Score: 4</option>
                  <option value="Information Technology (IT) sector employee|4">Information Technology (IT) sector employee â€” Score: 4</option>
                  <option value="Director (Private/Public Limited Company)|4">Director (Private/Public Limited Company) â€” Score: 4</option>
                  <option value="Athlete/Media Celebrity/Producer/Director|4">Athlete/Media Celebrity/Producer/Director â€” Score: 4</option>
                  <option value="Freelance Software Developer|4">Freelance Software Developer â€” Score: 4</option>
                  <option value="Teacher (Public/Private/Autonomous Educational Institution)|2">Teacher (Public/Private/Autonomous Educational Institution) â€” Score: 2</option>
                  <option value="Government service|3">Government service â€” Score: 3</option>
                  <option value="Private Sector Employee|2">Private Sector Employee â€” Score: 2</option>
                  <option value="Landlord/Homeowner|3">Landlord/Homeowner â€” Score: 3</option>
                  <option value="Self-employed Professional|2">Self-employed Professional â€” Score: 2</option>
                  <option value="Private Service: Managerial|3">Private Service: Managerial â€” Score: 3</option>
                  <option value="Student|2">Student â€” Score: 2</option>
                  <option value="Retiree|1">Retiree â€” Score: 1</option>
                  <option value="Farmer/Fisherman/Labourer|1">Farmer/Fisherman/Labourer â€” Score: 1</option>
                  <option value="Others:|01-05">Others: â€” Score: 01-05</option>
                </select>
              </div>
              <div class="form-group">
                <label>Type of On-boarding Score</label>
                <select name="kycTypeOfOnboarding">
                  <option value="">Select Type of On-boarding</option>
                  <option value="Branch/Relationship Manager|2" selected>Branch/Relationship Manager â€” Score: 2</option>
                  <option value="Direct Sales Agent|3">Direct Sales Agent â€” Score: 3</option>
                  <option value="Walk in|3">Walk in â€” Score: 3</option>
                  <option value="Internet/Self check-in/other non-face to face|5">Internet/Self check-in/other non-face to face â€” Score: 5</option>
                </select>
              </div>
              <!-- Row 2 -->
              <div class="form-group">
                <label>PEP/IP/CEO</label>
                <select name="kycPepIpCeo">
                  <option value="">Select PEP/IP/CEO</option>
                  <option value="No|0" selected>No â€” Score: 0</option>
                  <option value="Yes|5">Yes â€” Score: 5</option>
                </select>
              </div>
              <div class="form-group">
                <label>Close Associate of PEP/IP/CEO</label>
                <select name="kycCloseAssociatePep">
                  <option value="">Select Close Associate</option>
                  <option value="No|0" selected>No â€” Score: 0</option>
                  <option value="Yes|5">Yes â€” Score: 5</option>
                </select>
              </div>
              <div class="form-group">
                <label>Customer's Avg Yearly Transaction</label>
                <select name="kycAvgYearlyTransaction">
                  <option value="">Select Average Yearly Transaction</option>
                  <option value="Individual - Up to Taka 10 Lac|1">Individual - Up to Taka 10 Lac â€” Score: 1</option>
                  <option value="Individual - Above Taka 10 Lac to up to 50 Lac|2">Individual - Above Taka 10 Lac to up to 50 Lac â€” Score: 2</option>
                  <option value="Individual - Above Taka 50 Lac to up to 5 Crore|3">Individual - Above Taka 50 Lac to up to 5 Crore â€” Score: 3</option>
                  <option value="Individual - Above Taka 5 Crore|5">Individual - Above Taka 5 Crore â€” Score: 5</option>
                  <option value="Entity - Up to Taka 10 Lac|0">Entity - Up to Taka 10 Lac â€” Score: 0</option>
                  <option value="Entity - Above Taka 10 Lac to up to 50 Lac|1">Entity - Above Taka 10 Lac to up to 50 Lac â€” Score: 1</option>
                  <option value="Entity - Above Taka 50 Lac to up to 5 Crore|2">Entity - Above Taka 50 Lac to up to 5 Crore â€” Score: 2</option>
                  <option value="Entity - Above Taka 5 Crore|4">Entity - Above Taka 5 Crore â€” Score: 4</option>
                </select>
              </div>
              <!-- Row 3 -->
              <div class="form-group">
                <label>Credible Source of Funds?</label>
                <select name="kycCredibleSourceOfFunds">
                  <option value="">Select Credible Source</option>
                  <option value="Yes|1">Yes â€” Score: 1</option>
                  <option value="No|5">No â€” Score: 5</option>
                </select>
              </div>
              <div class="form-group">
                <label>Source(s) of Funds Verify</label>
                <input type="text" name="kycSourceOfFundsVerify" value="FACE TO FACE CONVERSATION" placeholder="Source(s) of Funds Verify">
              </div>
              <div class="form-group">
                <label>Source of Fund document</label>
                <input type="text" name="kycSourceOfFundDocument" placeholder="Source of Fund document">
              </div>
              <div class="form-group">
                <label>Face to Face Conversation</label>
                <input type="text" name="kycFaceToFaceConversation" value="FACE TO FACE CONVERSATION" placeholder="Face to Face Conversation">
              </div>
              <!-- Row 4 -->
              <div class="form-group">
                <label>AML Tracking Number</label>
                <input type="text" name="kycAmlTrackingNumber" placeholder="AML Tracking Number">
              </div>
              <div class="form-group">
                <label>Sector Code</label>
                <input type="text" name="sectorCode" placeholder="Sector Code">
              </div>
            </div>
          </div>

        </div>
      </form>
    </div>

    <!-- Action Bar -->
    <div class="action-bar" role="region" aria-label="Form actions">
      <div style="display:flex;align-items:center;gap:12px;flex-wrap:wrap;">
        <!-- Form Type Selector (hidden) -->
        <div class="form-type-selector" style="display:none;">
          <label for="formTypeSelect" style="font-weight:600;font-size:0.9rem;color:var(--text-secondary);margin:0;">Form Type:</label>
          <select id="formTypeSelect" style="padding:8px 12px;border:1px solid var(--border-color);border-radius:4px;font-size:0.9rem;cursor:pointer;background:white;color:var(--text-primary);">
            <option value="conventional">Conventional</option>
            <option value="taqwa">Taqwa</option>
            <option value="others">KYC Stand Alone FD</option>
          </select>
        </div>
        
        <!-- Print and Clear Buttons -->
        <div style="display:flex;gap:12px;">
          <button type="button" class="btn btn-success action-btn" id="printBtn" aria-label="Print form">
            <i class="fas fa-print" aria-hidden="true"></i>
            <span class="action-label">Print Form</span>
          </button>
          <button type="button" class="btn btn-info action-btn" id="kycPrintBtn" aria-label="Print KYC" style="display:none;">
            <i class="fas fa-print" aria-hidden="true"></i>
            <span class="action-label">KYC Print</span>
          </button>
          <button type="button" class="btn btn-danger action-btn" id="clearBtn" aria-label="Clear form">
            <i class="fas fa-trash" aria-hidden="true"></i>
            <span class="action-label">Clear</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Page 2: Form Preview -->
  <div class="page-container" id="form-page">
    <div class="preview-page">
      <div class="preview-controls">
        <div style="display:flex;align-items:center;gap:12px;flex-wrap:wrap;">
          <div class="edit-toggle">
            <input type="checkbox" id="editMode">
            <label for="editMode"><i class="fas fa-edit"></i> Edit Overlay Positions</label>
          </div>
          <div class="form-type-selector">
            <label for="formTypeSelectPreview"><i class="fas fa-file-alt"></i> Form Type:</label>
            <select id="formTypeSelectPreview">
              <option value="conventional">Conventional</option>
              <option value="taqwa">Taqwa</option>
              <option value="others">KYC Stand Alone FD</option>
            </select>
          </div>
          <div class="preview-actions">
            <button class="btn btn-warning" id="savePositionsBtn"><i class="fas fa-save"></i> Save Positions</button>
          </div>
        </div>
      </div>

      <div class="preview-container">
        <!-- Conventional Form Pages (images located in images/ folder) -->
        <div class="form-page conventional-page" data-page="1">
          <img loading="lazy" src="images/Conventional TDRD/account-opening-form-term-deposit-savings-scheme-special-scheme_page-0001.jpg" alt="Conventional Form Page 1">
        </div>
        <div class="form-page conventional-page" data-page="2">
          <img loading="lazy" src="images/Conventional TDRD/account-opening-form-term-deposit-savings-scheme-special-scheme_page-0002.jpg" alt="Conventional Form Page 2">
        </div>
        <div class="form-page conventional-page" data-page="3">
          <img loading="lazy" src="images/Conventional TDRD/account-opening-form-term-deposit-savings-scheme-special-scheme_page-0003.jpg" alt="Conventional Form Page 3">
        </div>
        <div class="form-page conventional-page" data-page="4">
          <img loading="lazy" src="images/Conventional TDRD/account-opening-form-term-deposit-savings-scheme-special-scheme_page-0004.jpg" alt="Conventional Form Page 4">
        </div>

        <!-- Taqwa Form Pages (images located in images/ folder) -->
        <div class="form-page taqwa-page hidden" data-page="5">
          <img loading="lazy" src="images/Taqwa TDRD/ucb-taqwa-tdscheme-deposit-account-opening-form_page-0001.jpg" alt="Taqwa Form Page 1">
        </div>
        <div class="form-page taqwa-page hidden" data-page="6">
          <img loading="lazy" src="images/Taqwa TDRD/ucb-taqwa-tdscheme-deposit-account-opening-form_page-0002.jpg" alt="Taqwa Form Page 2">
        </div>
        <div class="form-page taqwa-page hidden" data-page="7">
          <img loading="lazy" src="images/Taqwa TDRD/ucb-taqwa-tdscheme-deposit-account-opening-form_page-0003.jpg" alt="Taqwa Form Page 3">
        </div>
        <div class="form-page taqwa-page hidden" data-page="8">
          <img loading="lazy" src="images/Taqwa TDRD/ucb-taqwa-tdscheme-deposit-account-opening-form_page-0004.jpg" alt="Taqwa Form Page 4">
        </div>

        <!-- KYC Stand Alone FD Form Pages -->
        <div class="form-page others-page hidden" data-page="9">
          <img loading="lazy" src="images/Others/KYC - Stand Alone FD_page-0001.jpg" alt="KYC Stand Alone FD Page 1">
        </div>
        <div class="form-page others-page hidden" data-page="10">
          <img loading="lazy" src="images/Others/KYC - Stand Alone FD_page-0002.jpg" alt="KYC Stand Alone FD Page 2">
        </div>
        <div class="form-page others-page hidden" data-page="11">
          <img loading="lazy" src="images/Others/KYC - Stand Alone FD_page-0003.jpg" alt="KYC Stand Alone FD Page 3">
        </div>
        <div class="form-page others-page hidden" data-page="12">
          <img loading="lazy" src="images/Others/KYC - Stand Alone FD_page-0004.jpg" alt="KYC Stand Alone FD Page 4">
        </div>
        <div class="form-page others-page hidden" data-page="13">
          <img loading="lazy" src="images/Others/KYC - Stand Alone FD_page-0005.jpg" alt="KYC Stand Alone FD Page 5">
        </div>
        <div class="form-page others-page hidden" data-page="14">
          <img loading="lazy" src="images/Others/Blank.jpg" alt="Blank Page">
        </div>
        <div class="form-page others-page hidden" data-page="15">
          <img loading="lazy" src="images/Others/SBS Form_page-0001.jpg" alt="SBS Form Page 1">
        </div>
      </div>
    </div>

    <!-- Action Bar for Form Page -->
    <div class="action-bar">
    </div>
  </div>

  <!-- Saved Presets Panel (Full Form Data) -->
  <div class="saved-presets-backdrop" id="savedPresetsBackdrop"></div>
  <div class="saved-presets-panel" id="savedPresetsPanel">
    <div class="saved-presets-header">
      <h3><i class="fas fa-folder-open"></i> Saved Presets</h3>
      <button class="saved-presets-close" id="closeSavedPresetsBtn"><i class="fas fa-times"></i></button>
    </div>
    <div class="saved-presets-list" id="savedPresetsList">
      <!-- Presets will be dynamically loaded here -->
    </div>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast"></div>

  <script>
(function() {
  /*
   * Deposit Account Form Editor - Script Index
   * Sections:
   *  1) DOM Elements & Constants
   *  2) Form Persistence (load/save)
   *  3) Page Navigation UI
   *  4) Overlay System (config, create, render, save)
   *  5) Presets (save/load/render/edit)
   *  6) Account Type Popup wiring
   *  7) Slide Menu + Misc UI
   *  8) Product dropdown
   *  9) Initialization
   */

  // Performance: Debounce function for event handlers
  function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
      const later = () => {
        clearTimeout(timeout);
        func(...args);
      };
      clearTimeout(timeout);
      timeout = setTimeout(later, wait);
    };
  }

  // DOM Elements
  const form = document.getElementById('deposit-account-form');
  const navBtns = document.querySelectorAll('.nav-btn');
  const pageContainers = document.querySelectorAll('.page-container');
  const printBtn = document.getElementById('printBtn');
  const clearBtn = document.getElementById('clearBtn');
  const kycPrintBtn = document.getElementById('kycPrintBtn');
  
  // Function to update KYC Print button visibility based on Sector Code
  function updateKYCPrintButtonVisibility() {
    const sectorCode = form.elements['sectorCode']?.value || '';
    if (kycPrintBtn) {
      kycPrintBtn.style.display = sectorCode !== '' ? '' : 'none';
    }
  }
  
  // Add event listener to Sector Code field
  const sectorCodeField = form.elements['sectorCode'];
  if (sectorCodeField) {
    sectorCodeField.addEventListener('input', updateKYCPrintButtonVisibility);
    sectorCodeField.addEventListener('change', updateKYCPrintButtonVisibility);
  }
  
  // Initialize KYC Print button visibility on page load
  try { updateKYCPrintButtonVisibility(); } catch (e) {}
  
  // KYC Print button functionality
  if (kycPrintBtn) {
    kycPrintBtn.addEventListener('click', function() {
      // Switch to KYC Stand Alone FD form type
      formTypeSelect.value = 'others';
      formTypeSelect.dispatchEvent(new Event('change'));
      
      // Switch to form preview before printing
      const formPageBtn = document.querySelector('.nav-btn[data-page="form"]');
      if (formPageBtn) formPageBtn.click();
      
      // Small delay to ensure the form preview is rendered
      setTimeout(function() {
        window.print();
        // After print dialog closes, return to information input page
        const infoPageBtn = document.querySelector('.nav-btn[data-page="info"]');
        if (infoPageBtn) infoPageBtn.click();
      }, 200);
    });
  }
  const formTypeSelect = document.getElementById('formTypeSelect');
  const formTypePreviewSelect = document.getElementById('formTypeSelectPreview');

  // Constants
  const FORM_KEY = 'deposit_form_data_v1';
  const SAVED_PRESETS_KEY = 'deposit_saved_presets_v1';
  // Persist branch name separately so it survives form clears
  const BRANCH_KEY = 'deposit_branch_name_v1';

  // Saved Presets Panel Elements
  const savedPresetsPanel = document.getElementById('savedPresetsPanel');
  const savedPresetsBackdrop = document.getElementById('savedPresetsBackdrop');
  const savedPresetsList = document.getElementById('savedPresetsList');
  const closeSavedPresetsBtn = document.getElementById('closeSavedPresetsBtn');
  const toast = document.getElementById('toast');

  // Toast notification
  function showToast(message) {
    toast.textContent = message;
    toast.classList.add('show');
    setTimeout(() => toast.classList.remove('show'), 3000);
  }

  // Saved Presets Functions (Full Form Data)
  function loadSavedPresets() {
    try {
      const data = localStorage.getItem(SAVED_PRESETS_KEY);
      return data ? JSON.parse(data) : [];
    } catch (e) { return []; }
  }

  function saveFullFormPreset() {
    const name = prompt('Enter a name for this preset:');
    if (!name || !name.trim()) return;

    const formData = new FormData(form);
    const data = {};
    for (let [key, value] of formData.entries()) {
      data[key] = value;
    }
    // Include checkboxes
    document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
      if (cb.name) data[cb.name] = cb.checked;
    });

    const presets = loadSavedPresets();
    presets.push({
      id: Date.now(),
      name: name.trim(),
      date: new Date().toLocaleDateString(),
      data: data
    });

    try {
      localStorage.setItem(SAVED_PRESETS_KEY, JSON.stringify(presets));
      showToast('Preset saved: ' + name.trim());
      renderSavedPresets();
    } catch (e) {
      console.error('Failed to save preset', e);
      showToast('Failed to save preset');
    }
  }

  function loadSavedPreset(id) {
    const presets = loadSavedPresets();
    const preset = presets.find(p => p.id === id);
    if (!preset) return;

    Object.keys(preset.data).forEach(key => {
      const el = form.elements[key];
      if (!el) return;
      if (el.type === 'checkbox') {
        el.checked = !!preset.data[key];
      } else {
        el.value = preset.data[key] == null ? '' : preset.data[key];
      }
    });

    // Re-render overlays
    try { renderOverlaysForCurrentType(); } catch (e) {}
    showToast('Preset loaded: ' + preset.name);
    closeSavedPresetsPanel();
  }

  function deleteSavedPreset(id) {
    if (!confirm('Delete this preset?')) return;

    let presets = loadSavedPresets();
    presets = presets.filter(p => p.id !== id);

    try {
      localStorage.setItem(SAVED_PRESETS_KEY, JSON.stringify(presets));
      showToast('Preset deleted');
      renderSavedPresets();
    } catch (e) {
      console.error('Failed to delete preset', e);
    }
  }

  function renderSavedPresets() {
    const presets = loadSavedPresets();

    if (presets.length === 0) {
      savedPresetsList.innerHTML = '<div style="text-align:center; padding:40px; color:#666;"><i class="fas fa-folder-open" style="font-size:3rem; margin-bottom:16px; display:block;"></i>No saved presets yet</div>';
      return;
    }

    savedPresetsList.innerHTML = presets.map(preset => `
      <div class="saved-preset-item">
        <h4><i class="fas fa-user"></i> ${preset.name}</h4>
        <p><i class="fas fa-calendar"></i> Saved: ${preset.date}</p>
        <div class="saved-preset-actions">
          <button class="saved-preset-btn load" onclick="window.loadSavedPreset(${preset.id})"><i class="fas fa-upload"></i> Load</button>
          <button class="saved-preset-btn delete" onclick="window.deleteSavedPreset(${preset.id})"><i class="fas fa-trash"></i> Delete</button>
        </div>
      </div>
    `).join('');
  }

  // Expose functions globally
  window.loadSavedPreset = loadSavedPreset;
  window.deleteSavedPreset = deleteSavedPreset;

  function openSavedPresetsPanel() {
    renderSavedPresets();
    savedPresetsPanel.classList.add('open');
    savedPresetsBackdrop.classList.add('show');
  }

  function closeSavedPresetsPanel() {
    savedPresetsPanel.classList.remove('open');
    savedPresetsBackdrop.classList.remove('show');
  }

  // Wire up saved presets panel events
  if (closeSavedPresetsBtn) closeSavedPresetsBtn.addEventListener('click', closeSavedPresetsPanel);
  // Backdrop click disabled - popup won't close when clicking outside

  // Page Navigation
  navBtns.forEach(btn => {
    btn.addEventListener('click', function() {
      const page = this.getAttribute('data-page');
      
      navBtns.forEach(b => b.classList.remove('active'));
      this.classList.add('active');
      
      pageContainers.forEach(pc => pc.classList.remove('active'));
      document.getElementById(`${page}-page`).classList.add('active');

      // Show only the button that switches to the other page
      navBtns.forEach(b => {
        if (b.dataset.page === page) {
          b.style.display = 'none';
        } else {
          b.style.display = '';
        }
      });

      if (page === 'form') {
        updateOverlays();
      }
    });
  });

  // Initialize: hide the Information Input button since it's the default active page
  navBtns.forEach(btn => {
    if (btn.dataset.page === 'info') {
      btn.style.display = 'none';
    }
  });

  // Attach change listeners for gender (residentStatus removed)
  ['gender'].forEach(name => {
    try {
      const sel = form.elements[name];
      if (sel && sel.tagName === 'SELECT') {
        sel.addEventListener('change', function() { setOverlayText(name, sel.value || ''); updateGenderTicks(); });
        // set initial overlay value from select
        setOverlayText(name, sel.value || '');
        try { updateGenderTicks(); } catch (e) {}
        return;
      }
      const nodes = document.querySelectorAll('input[name="' + name + '"]');
      if (nodes && nodes.length) {
        nodes.forEach(n => n.addEventListener('change', function() {
          const checked = Array.from(nodes).find(i => i.checked);
          const val = checked ? checked.value : '';
          setOverlayText(name, val);
          try { updateGenderTicks(); } catch (e) {}
        }));
        // initialize from existing radio selection
        const checkedInit = Array.from(nodes).find(i => i.checked);
        if (checkedInit) setOverlayText(name, checkedInit.value || '');
      }
    } catch (e) {}
  });

  // === Form Persistence ===
  // Load form data from localStorage
  function loadFormData() {
    const saved = localStorage.getItem(FORM_KEY);
    if (saved) {
      try {
        const data = JSON.parse(saved);
        Object.keys(data).forEach(key => {
          const field = form.elements[key];
          if (field) {
            try {
              if (field.type === 'checkbox') {
                // saved checkboxes use 'on' when checked (FormData default without value attr)
                field.checked = (data[key] === true || data[key] === 'true' || data[key] === 'on' || data[key] === '1');
              } else if (field.type === 'radio') {
                // radios handled elsewhere; set checked for matching value
                const radios = document.getElementsByName(key);
                Array.from(radios).forEach(r => { r.checked = (r.value === data[key]); });
              } else {
                field.value = data[key];
              }
            } catch (e) {
              field.value = data[key];
            }
          }
        });
        // restore branchName into a hidden input and slide menu input if present
        // First check if branchName is in form data, otherwise try BRANCH_KEY
        let branchValue = (data && data.branchName !== undefined) ? data.branchName : null;
        if (!branchValue) {
          try { branchValue = localStorage.getItem(BRANCH_KEY) || ''; } catch (e) {}
        }
        if (branchValue) {
          let branchEl = form.elements['branchName'];
          if (!branchEl) {
            const hidden = document.createElement('input');
            hidden.type = 'hidden';
            hidden.name = 'branchName';
            hidden.value = branchValue;
            form.appendChild(hidden);
            branchEl = hidden;
          } else {
            branchEl.value = branchValue;
          }
          const slide = document.getElementById('slideBranchInput');
          if (slide) slide.value = branchValue;
          try { setOverlayText('branchName', branchValue); } catch (e) {}
        }
        // restore dpsYears to popup
        if (data && data.dpsYears !== undefined) {
          const dpsYearsPopup = document.getElementById('dpsYears');
          if (dpsYearsPopup) {
            dpsYearsPopup.value = data.dpsYears || '';
          }
        }
        // restore dpsSchemeName to popup
        if (data && data.schemeName !== undefined) {
          const dpsSchemePopup = document.getElementById('dpsSchemeName');
          if (dpsSchemePopup) {
            dpsSchemePopup.value = data.schemeName || '';
          }
        }
      } catch (e) {}
    } else {
      // No form data saved, but still try to restore branch name from BRANCH_KEY
      try {
        const savedBranch = localStorage.getItem(BRANCH_KEY);
        if (savedBranch) {
          let branchEl = form.elements['branchName'];
          if (!branchEl) {
            const hidden = document.createElement('input');
            hidden.type = 'hidden';
            hidden.name = 'branchName';
            hidden.value = savedBranch;
            form.appendChild(hidden);
            branchEl = hidden;
          } else {
            branchEl.value = savedBranch;
          }
          const slide = document.getElementById('slideBranchInput');
          if (slide) slide.value = savedBranch;
          try { setOverlayText('branchName', savedBranch); } catch (e) {}
        }
      } catch (e) {}
    }
  }

  // Save form data to localStorage
  function saveFormData() {
    const data = {};
    const formData = new FormData(form);
    formData.forEach((value, key) => {
      data[key] = value;
    });
    // Explicitly save checkbox states (FormData only includes checked checkboxes)
    const checkboxes = form.querySelectorAll('input[type="checkbox"]');
    checkboxes.forEach(cb => {
      if (cb.name) {
        data[cb.name] = cb.checked ? 'on' : '';
      }
    });
    // Explicitly save slideBranchInput to ensure it persists
    const slideBranchInput = document.getElementById('slideBranchInput');
    if (slideBranchInput) {
      data['branchName'] = slideBranchInput.value;
      // Also save to BRANCH_KEY separately so it survives form clears
      try { localStorage.setItem(BRANCH_KEY, slideBranchInput.value); } catch (e) {}
    }
    localStorage.setItem(FORM_KEY, JSON.stringify(data));
  }

  // Auto-save on input with debounce for better performance
  const debouncedSave = debounce(saveFormData, 500);
  form.addEventListener('input', function(e) {
    debouncedSave();
    // Instantly update overlays for immediate preview
    try { updateOverlays(); } catch (err) {}
  });
  form.addEventListener('change', function(e) {
    saveFormData();
    // Instantly update overlays for immediate preview
    try { updateOverlays(); } catch (err) {}
  });

  // --- Auto-translate Full Name (English) -> Full Name (Bangla) (uses Google Translate like Account Opening editor) ---
  async function translateText(text) {
    if (!text || text.trim() === '') return '';
    try {
      const apiUrl = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=bn&dt=t&q=${encodeURIComponent(text)}`;
      const response = await fetch(apiUrl);
      const data = await response.json();
      if (data && data[0] && Array.isArray(data[0])) {
        const translated = data[0].map(item => item[0]).join('');
        return translated;
      }
      return '';
    } catch (e) {
      return '';
    }
  }

  const translateDebounced = debounce(async (text) => {
    if (!text || text.trim() === '') {
      if (form.elements['fullNameBn']) {
        form.elements['fullNameBn'].value = '';
        try { setOverlayText('fullNameBn', ''); } catch (e) {}
        debouncedSave();
      }
      return;
    }
    
    // Check if text starts with "mst" or "most" (case-insensitive, with optional period)
    const prefixMatch = text.trim().match(/^(mst\.?|most\.?)\s+/i);
    let textToTranslate = text.trim();
    let hasPrefix = false;
    
    if (prefixMatch) {
      hasPrefix = true;
      // Remove the prefix and translate only the remaining name
      textToTranslate = text.trim().substring(prefixMatch[0].length).trim();
    }
    
    const translated = await translateText(textToTranslate);
    if (form.elements['fullNameBn']) {
      // If prefix was detected, prepend Bengali "à¦®à§‹à¦›à¦¾à¦ƒ" to the translated name
      const finalBangla = hasPrefix && translated ? 'à¦®à§‹à¦›à¦¾à¦ƒ ' + translated : translated;
      form.elements['fullNameBn'].value = finalBangla;
      try { setOverlayText('fullNameBn', finalBangla); } catch (e) {}
      debouncedSave();
    }
  }, 700);

  const fullNameEnField = form.elements['fullNameEn'];
  if (fullNameEnField) {
    fullNameEnField.addEventListener('input', function(e) {
      const englishText = e.target.value || '';
      translateDebounced(englishText);
      updateCombinedApplicants();
    });
  }

  // Auto-translate Organization Name (English) to Organization Name (Bangla)
  const translateOrgNameDebounced = debounce(async (text) => {
    if (!text || text.trim() === '') {
      if (form.elements['orgNameBn']) {
        form.elements['orgNameBn'].value = '';
        try { setOverlayText('orgNameBn', ''); } catch (e) {}
        try { setOverlayText('orgNameBn2', ''); } catch (e) {}
        debouncedSave();
      }
      return;
    }
    
    const translated = await translateText(text.trim());
    if (form.elements['orgNameBn']) {
      form.elements['orgNameBn'].value = translated;
      try { setOverlayText('orgNameBn', translated); } catch (e) {}
      try { setOverlayText('orgNameBn2', translated); } catch (e) {}
      debouncedSave();
    }
  }, 700);

  const orgNameEnField = form.elements['orgNameEn'];
  if (orgNameEnField) {
    orgNameEnField.addEventListener('input', function(e) {
      const englishText = e.target.value || '';
      translateOrgNameDebounced(englishText);
      // Sync to second overlay
      try { setOverlayText('orgNameEn2', englishText); } catch (e) {}
    });
  }

  // Check if 4th digit of Account Number is 1 or 2 to show/hide organization name fields
  function updateOrgNameFieldsVisibility() {
    const accountNumber = (form.elements['accountNumber'] && form.elements['accountNumber'].value) || '';
    const fourthDigit = accountNumber.charAt(3); // 0-indexed, so 3 is the 4th position
    const shouldShow = fourthDigit === '1' || fourthDigit === '2';
    
    // Find the form groups containing orgNameEn and orgNameBn
    const orgNameEnGroup = form.elements['orgNameEn'] ? form.elements['orgNameEn'].closest('.form-group') : null;
    const orgNameBnGroup = form.elements['orgNameBn'] ? form.elements['orgNameBn'].closest('.form-group') : null;
    
    if (orgNameEnGroup) {
      orgNameEnGroup.style.display = shouldShow ? '' : 'none';
    }
    if (orgNameBnGroup) {
      orgNameBnGroup.style.display = shouldShow ? '' : 'none';
    }
  }
  
  // Add event listener to account number field
  const accountNumberField = form.elements['accountNumber'];
  if (accountNumberField) {
    accountNumberField.addEventListener('input', updateOrgNameFieldsVisibility);
  }
  
  // Initialize visibility on page load
  try { updateOrgNameFieldsVisibility(); } catch (e) {}

  // Check if 1st digit of Account Number is 7 to show/hide ISR Bank and ISR Customer fields
  function updateISRFieldsVisibility() {
    const accountNumber = (form.elements['accountNumber'] && form.elements['accountNumber'].value) || '';
    const firstDigit = accountNumber.charAt(0); // 0-indexed, so 0 is the 1st position
    const shouldShow = firstDigit === '7';
    
    // Find the form groups containing isrBank and isrCustomer
    const isrBankGroup = form.elements['isrBank'] ? form.elements['isrBank'].closest('.form-group') : null;
    const isrCustomerGroup = form.elements['isrCustomer'] ? form.elements['isrCustomer'].closest('.form-group') : null;
    
    if (isrBankGroup) {
      isrBankGroup.style.display = shouldShow ? '' : 'none';
    }
    if (isrCustomerGroup) {
      isrCustomerGroup.style.display = shouldShow ? '' : 'none';
    }
  }
  
  // Add event listener to account number field for ISR visibility
  if (accountNumberField) {
    accountNumberField.addEventListener('input', updateISRFieldsVisibility);
  }
  
  // Initialize ISR fields visibility on page load
  try { updateISRFieldsVisibility(); } catch (e) {}

  // --- Update Combined Applicants (fullNameEn + secondApplicant + thirdApplicant joined with "and") ---
  function updateCombinedApplicants() {
    // Ensure hidden input exists
    let combinedEl = form.elements['combinedApplicants'];
    if (!combinedEl) {
      combinedEl = document.createElement('input');
      combinedEl.type = 'hidden';
      combinedEl.name = 'combinedApplicants';
      form.appendChild(combinedEl);
    }

    const fullName = (form.elements['fullNameEn'] && form.elements['fullNameEn'].value || '').trim();
    const secondApplicant = (form.elements['secondApplicant'] && form.elements['secondApplicant'].value || '').trim();
    const thirdApplicant = (form.elements['thirdApplicant'] && form.elements['thirdApplicant'].value || '').trim();

    const names = [];
    if (fullName) names.push(fullName);
    if (secondApplicant) names.push(secondApplicant);
    if (thirdApplicant) names.push(thirdApplicant);

    const combined = names.join(' and ');
    combinedEl.value = combined;

    // Update overlay
    try { setOverlayText('combinedApplicants', combined); } catch (e) {}
  }

  // Wire events for combined applicants
  ['fullNameEn', 'secondApplicant', 'thirdApplicant'].forEach(fieldName => {
    const field = form.elements[fieldName];
    if (field) {
      field.addEventListener('input', updateCombinedApplicants);
      field.addEventListener('change', updateCombinedApplicants);
      field.addEventListener('input', updateCombinedApplicantsBangla);
      field.addEventListener('change', updateCombinedApplicantsBangla);
    }
  });

  // Initialize combined applicants on script load
  updateCombinedApplicants();
  updateCombinedApplicantsBangla();

  // --- Translate Combined Applicants to Bangla with mst/most prefix handling for each name ---
  // Helper: translate a single name with mst/most prefix handling
  async function translateNameWithPrefix(name) {
    if (!name || name.trim() === '') return '';
    
    const trimmed = name.trim();
    const prefixMatch = trimmed.match(/^(mst\.?|most\.?)\s+/i);
    
    if (prefixMatch) {
      // Has mst/most prefix - translate the rest and prepend à¦®à§‹à¦›à¦¾à¦ƒ
      const textToTranslate = trimmed.substring(prefixMatch[0].length).trim();
      const translated = await translateText(textToTranslate);
      return translated ? 'à¦®à§‹à¦›à¦¾à¦ƒ ' + translated : '';
    } else {
      // No prefix - translate as-is
      return await translateText(trimmed);
    }
  }

  async function updateCombinedApplicantsBangla() {
    const fullName = (form.elements['fullNameEn'] && form.elements['fullNameEn'].value || '').trim();
    const secondApplicant = (form.elements['secondApplicant'] && form.elements['secondApplicant'].value || '').trim();
    const thirdApplicant = (form.elements['thirdApplicant'] && form.elements['thirdApplicant'].value || '').trim();

    // Collect non-empty names
    const names = [];
    if (fullName) names.push(fullName);
    if (secondApplicant) names.push(secondApplicant);
    if (thirdApplicant) names.push(thirdApplicant);
    
    // Ensure hidden input exists
    let combinedBnEl = form.elements['combinedApplicantsBn'];
    if (!combinedBnEl) {
      combinedBnEl = document.createElement('input');
      combinedBnEl.type = 'hidden';
      combinedBnEl.name = 'combinedApplicantsBn';
      form.appendChild(combinedBnEl);
    }
    
    if (names.length === 0) {
      combinedBnEl.value = '';
      try { setOverlayText('combinedApplicantsBn', ''); } catch (e) {}
      return;
    }
    
    // Translate each name individually with mst/most prefix handling
    const translatedNames = await Promise.all(names.map(name => translateNameWithPrefix(name)));
    
    // Join with Bengali "à¦à¦¬à¦‚" (and)
    const finalBangla = translatedNames.filter(n => n).join(' à¦à¦¬à¦‚ ');
    
    combinedBnEl.value = finalBangla;
    try { setOverlayText('combinedApplicantsBn', finalBangla); } catch (e) {}
    debouncedSave();
  }

  // === Page Navigation & Misc UI ===
  // Print functionality
  printBtn.addEventListener('click', function() {
    // Check account number's first digit to determine form type
    const accountNumberValue = form.elements['accountNumber']?.value || '';
    const firstDigit = accountNumberValue.charAt(0);
    
    // Determine form type based on first digit of account number
    let targetFormType = 'conventional'; // default
    if (firstDigit === '7') {
      targetFormType = 'taqwa';
    }
    
    // Switch form type if needed
    formTypeSelect.value = targetFormType;
    formTypeSelect.dispatchEvent(new Event('change'));
    
    // Switch to form preview before printing
    const formPageBtn = document.querySelector('.nav-btn[data-page="form"]');
    if (formPageBtn) formPageBtn.click();
    
    // Small delay to ensure the form preview is rendered
    setTimeout(function() {
      window.print();
      // After print dialog closes, return to information input page
      const infoPageBtn = document.querySelector('.nav-btn[data-page="info"]');
      if (infoPageBtn) infoPageBtn.click();
    }, 200);
  });

  // Clear form
  clearBtn.addEventListener('click', function() {
    if (confirm('Are you sure you want to clear all data?')) {
      // Preserve branch name before clearing
      const slideBranchInput = document.getElementById('slideBranchInput');
      const preservedBranch = slideBranchInput ? slideBranchInput.value : '';
      
      form.reset();
      localStorage.removeItem(FORM_KEY);
      
      // Restore branch name after clear
      if (slideBranchInput && preservedBranch) {
        slideBranchInput.value = preservedBranch;
        setHiddenInput('branchName', preservedBranch);
        try { setOverlayText('branchName', preservedBranch); } catch (e) {}
      }
      
      // Update overlays after clear
      try { updateOverlays(); } catch (e) {}
      showToast('Form cleared');
    }
  });

  // Form type selector
  formTypeSelect.addEventListener('change', function() {
    const conventionalPages = document.querySelectorAll('.conventional-page');
    const taqwaPages = document.querySelectorAll('.taqwa-page');
    const othersPages = document.querySelectorAll('.others-page');
    
    if (this.value === 'conventional') {
      conventionalPages.forEach(page => page.classList.remove('hidden'));
      taqwaPages.forEach(page => page.classList.add('hidden'));
      othersPages.forEach(page => page.classList.add('hidden'));
    } else if (this.value === 'taqwa') {
      conventionalPages.forEach(page => page.classList.add('hidden'));
      taqwaPages.forEach(page => page.classList.remove('hidden'));
      othersPages.forEach(page => page.classList.add('hidden'));
    } else if (this.value === 'others') {
      conventionalPages.forEach(page => page.classList.add('hidden'));
      taqwaPages.forEach(page => page.classList.add('hidden'));
      othersPages.forEach(page => page.classList.remove('hidden'));
    }
    // Re-render overlays for the selected form type
    renderOverlaysForCurrentType();
    // Keep preview selector in sync if present
    if (formTypePreviewSelect) formTypePreviewSelect.value = this.value;
  });

  // Wire the preview select to the same behavior (keeps both selectors in sync)
  if (formTypePreviewSelect) {
    formTypePreviewSelect.addEventListener('change', function() {
      if (formTypeSelect) {
        formTypeSelect.value = this.value;
        formTypeSelect.dispatchEvent(new Event('change'));
      }
    });
  }

  // === Same as Account Holder Present Address functionality ===
  const sameAsAccountHolderCheckbox = document.getElementById('sameAsAccountHolderAddress');
  const nomineeAddressInput = form.elements['nomineeAddress'];
  const presentAddressInput = form.elements['presentAddress'];
  
  if (sameAsAccountHolderCheckbox && nomineeAddressInput && presentAddressInput) {
    // When checkbox is checked, copy present address to nominee address
    sameAsAccountHolderCheckbox.addEventListener('change', function() {
      if (this.checked) {
        nomineeAddressInput.value = presentAddressInput.value;
        setOverlayText('nomineeAddress', presentAddressInput.value);
        setTickOverlay('tickSameAsAccountHolderAddress', true);
      } else {
        nomineeAddressInput.value = '';
        setOverlayText('nomineeAddress', '');
        setTickOverlay('tickSameAsAccountHolderAddress', false);
      }
      saveFormData();
    });
    
    // If present address changes and checkbox is checked, auto-update nominee address
    presentAddressInput.addEventListener('input', function() {
      if (sameAsAccountHolderCheckbox.checked) {
        nomineeAddressInput.value = this.value;
        setOverlayText('nomineeAddress', this.value);
        debouncedSave();
      }
    });
  }

  // === Same as Link Account checkboxes (Account Information) ===
  // Helper: hide/show major personal/org/address sections when "Same as Link Account (Personal)" is checked
  function toggleSectionsForSameAsPersonal(checked) {
    try {
      const ids = ['organization-info','depositor-info','present-address','permanent-address','kyc-info'];
      ids.forEach(id => {
        const el = document.getElementById(id);
        if (!el) return;
        el.style.display = checked ? 'none' : '';
      });
    } catch (e) {}
  }

  const sameAsLinkedAccountPersonal = document.getElementById('sameAsLinkedAccountPersonal');
  const sameAsLinkedAccountNominee = document.getElementById('sameAsLinkedAccountNominee');
  
  // Helper: hide/show nominee section when "Same as Link Account (Nominee)" is checked
  function toggleNomineeSection(checked) {
    try {
      const el = document.getElementById('nominee-info');
      if (!el) return;
      el.style.display = checked ? 'none' : '';
    } catch (e) {}
  }
  
  if (sameAsLinkedAccountPersonal) {
    sameAsLinkedAccountPersonal.addEventListener('change', function() {
      const accountVal = (form.elements['accountNumber'] && form.elements['accountNumber'].value) || '';
      const fourthChar = accountVal.length > 3 ? accountVal[3] : '';
      const debitVal = (form.elements['debitMyAccount'] && form.elements['debitMyAccount'].value) ? form.elements['debitMyAccount'].value : '';
      const overlayText = this.checked && accountVal ? 'Same as Link Account: ' + debitVal : '';
      
      // Show/hide based on checkbox state and account number's 4th digit
      if (!accountVal) {
        // No account number, hide everywhere
        document.querySelectorAll('.overlay[data-field="sameAsLinkedAccountPersonalNote"]').forEach(ov => {
          ov.style.display = 'none';
          ov.textContent = '';
        });
      } else if (fourthChar === '3') {
        // Page 2 only
        document.querySelectorAll('.overlay[data-field="sameAsLinkedAccountPersonalNote"]').forEach(ov => {
          const page = ov.parentElement.getAttribute('data-page');
          if (page === '2') {
            ov.style.display = this.checked ? 'block' : 'none';
            ov.textContent = overlayText;
          } else {
            ov.style.display = 'none';
            ov.textContent = '';
          }
        });
      } else if (fourthChar === '1' || fourthChar === '2') {
        // Page 1 only
        document.querySelectorAll('.overlay[data-field="sameAsLinkedAccountPersonalNote"]').forEach(ov => {
          const page = ov.parentElement.getAttribute('data-page');
          if (page === '1') {
            ov.style.display = this.checked ? 'block' : 'none';
            ov.textContent = overlayText;
          } else {
            ov.style.display = 'none';
            ov.textContent = '';
          }
        });
      } else {
        // Other 4th digit, hide everywhere
        document.querySelectorAll('.overlay[data-field="sameAsLinkedAccountPersonalNote"]').forEach(ov => {
          ov.style.display = 'none';
          ov.textContent = '';
        });
      }
      
      setTickOverlay('tickSameAsLinkedAccountPersonal', this.checked);
      // hide/show related sections when personal link is checked
      toggleSectionsForSameAsPersonal(this.checked);
      saveFormData();
    });
    // keep overlay updated when debitMyAccount changes
    const debitInput = form.elements['debitMyAccount'];
    if (debitInput) {
      debitInput.addEventListener('input', function() {
        if (sameAsLinkedAccountPersonal.checked) {
          const accountVal = (form.elements['accountNumber'] && form.elements['accountNumber'].value) || '';
          const fourthChar = accountVal.length > 3 ? accountVal[3] : '';
          const overlayText = 'Same as Link Account: ' + (this.value || '');
          
          if (accountVal) {
            // Update overlay on correct page based on 4th digit
            document.querySelectorAll('.overlay[data-field="sameAsLinkedAccountPersonalNote"]').forEach(ov => {
              const page = ov.parentElement.getAttribute('data-page');
              if ((fourthChar === '3' && page === '2') || ((fourthChar === '1' || fourthChar === '2') && page === '1')) {
                ov.textContent = overlayText;
                ov.style.display = 'block';
              }
            });
          }
          debouncedSave();
        }
      });
    }
  }
  if (sameAsLinkedAccountNominee) {
    sameAsLinkedAccountNominee.addEventListener('change', function() {
      const debitVal = (form.elements['debitMyAccount'] && form.elements['debitMyAccount'].value) ? form.elements['debitMyAccount'].value : '';
      const overlayText = 'Same as Link Account: ' + debitVal;
      
      if (this.checked) {
        // Show on page 3 only
        document.querySelectorAll('.overlay[data-field="sameAsLinkedAccountNomineeNote"]').forEach(ov => {
          const page = ov.parentElement.getAttribute('data-page');
          if (page === '3') {
            ov.textContent = overlayText;
            ov.style.display = 'block';
          }
        });
        setTickOverlay('tickSameAsLinkedAccountNominee', true);
        // hide nominee information when linked to personal account
        toggleNomineeSection(true);
      } else {
        // Hide on all pages
        document.querySelectorAll('.overlay[data-field="sameAsLinkedAccountNomineeNote"]').forEach(ov => {
          ov.textContent = '';
          ov.style.display = 'none';
        });
        setTickOverlay('tickSameAsLinkedAccountNominee', false);
        toggleNomineeSection(false);
      }
      saveFormData();
    });
    // keep overlay updated when debitMyAccount changes
    const debitInputNominee = form.elements['debitMyAccount'];
    if (debitInputNominee) {
      debitInputNominee.addEventListener('input', function() {
        if (sameAsLinkedAccountNominee.checked) {
          const overlayText = 'Same as Link Account: ' + (this.value || '');
          // Update only page 3 overlay
          document.querySelectorAll('.overlay[data-field="sameAsLinkedAccountNomineeNote"]').forEach(ov => {
            const page = ov.parentElement.getAttribute('data-page');
            if (page === '3') {
              ov.textContent = overlayText;
              ov.style.display = 'block';
            }
          });
          debouncedSave();
        }
      });
    }
  }

  // === Overlay System ===
  // Overlay positions storage key
  const OVERLAY_KEY = 'deposit_overlay_positions_v1';
  const editMode = document.getElementById('editMode');
  const savePositionsBtn = document.getElementById('savePositionsBtn');

  // App storage versioning - clear persisted editor data when version changes
  const APP_VERSION_KEY = 'deposit_editor_version';
  const APP_VERSION = 'v2';

  function ensureStorageVersion() {
    try {
      const stored = localStorage.getItem(APP_VERSION_KEY);
      // If the app version changed, clear overlay positions but PRESERVE form data
      if (stored !== APP_VERSION) {
        // Only clear overlay positions and presets, NOT form data (FORM_KEY)
        const keysToClear = [OVERLAY_KEY, 'deposit_account_type_presets_v1'];
        keysToClear.forEach(k => { try { localStorage.removeItem(k); } catch (e) {} });
        try { localStorage.setItem(APP_VERSION_KEY, APP_VERSION); } catch (e) {}
        // Editor storage version changed - form data preserved
      }

      // Additionally, detect overlay configuration schema changes by hashing overlayConfig
      try {
        if (typeof overlayConfig !== 'undefined') {
          function djb2Hash(str) {
            let hash = 5381;
            for (let i = 0; i < str.length; i++) {
              hash = ((hash << 5) + hash) + str.charCodeAt(i);
              hash = hash & 0xFFFFFFFF;
            }
            return (hash >>> 0).toString(16);
          }
          const cfgString = JSON.stringify(overlayConfig);
          const currentCfgHash = djb2Hash(cfgString);
          const CFG_HASH_KEY = 'deposit_overlay_config_hash';
          const storedCfgHash = localStorage.getItem(CFG_HASH_KEY);
          if (storedCfgHash !== currentCfgHash) {
            // configuration changed â€” merge new overlay entries into saved positions instead of clearing
            try {
              const saved = loadOverlayPositions() || {};
              Object.keys(overlayConfig).forEach(type => {
                const cfgList = overlayConfig[type] || [];
                const existing = saved[type] || [];
                const existingKeys = new Set(existing.map(i => (i.field || '') + '::' + (i.page || '1')));
                const toAdd = [];
                cfgList.forEach(item => {
                  const key = (item.field || '') + '::' + (item.page || '1');
                  if (!existingKeys.has(key)) {
                    toAdd.push({ page: item.page || '1', field: item.field, leftPercent: parseFloat(item.left) || 0, topPercent: parseFloat(item.top) || 0 });
                  }
                });
                if (toAdd.length) saved[type] = (saved[type] || []).concat(toAdd);
              });
              saveOverlayPositionsObject(saved);
              try { localStorage.setItem(CFG_HASH_KEY, currentCfgHash); } catch (e) {}
              // Overlay configuration changed
            } catch (e) {
              // Overlay merge failed
              try { localStorage.removeItem(OVERLAY_KEY); } catch (er) {}
              try { localStorage.setItem(CFG_HASH_KEY, currentCfgHash); } catch (er) {}
            }
          }
        }
      } catch (e) {}
    } catch (e) {
      // Could not verify storage version
    }
  }

  // Load overlay positions object from localStorage (per form type)
  function loadOverlayPositions() {
    try {
      const raw = localStorage.getItem(OVERLAY_KEY);
      return raw ? JSON.parse(raw) : {};
    } catch (e) {
      // Error loading overlay positions
      return {};
    }
  }

  // Save overlay positions object to localStorage
  function saveOverlayPositionsObject(obj) {
    try {
      localStorage.setItem(OVERLAY_KEY, JSON.stringify(obj));
    } catch (e) {
      // Error saving overlay positions
    }
  }

  // Utility: get current form type
  function getCurrentFormType() {
    return formTypeSelect.value || 'conventional';
  }

  // Clear any existing overlay DOM elements
  function clearOverlays() {
    document.querySelectorAll('.form-page .overlay').forEach(el => el.remove());
  }

  // Letter spacing multipliers (in em units)
  const LETTER_SPACING = {
    accountNumber: 1.08,
    accountNumber1: 1.08,
    cifNumber: 1.08,
    interestAccountNumber: 1.08,
    eTin: 1.30,
    eTinIndividual: 1.30,
    tradeLicenceDate: 1.20,
    registrationDate: 1.20,
    dateOfBirth: 1.30,
    nomineeDob: 0.80,
    presentPostCode: 1.10,
    permanentPostCode: 1.10,
    sectorCodeIfFullNameEn: 1.08,
    sectorCodeIfOrgNameEn: 1.08,
    nineNineEightIfFullNameEn: 1.08,
    nineNineEightIfOrgNameEn: 1.08
  };

  // Helper function to apply letter spacing to overlay elements
  function applyLetterSpacing(overlay, fieldName, page) {
    // Special cases:
    // - debitMyAccount: larger spacing on page 4 and 8
    // - accountNumber: larger spacing on page 4 and 8; reduced spacing on page 5; only "Account No 1" on page 7 gets increased spacing; NO spacing on page 9
    // - cifNumber: NO spacing on page 9
    if (fieldName === 'debitMyAccount' && page === '4') {
      overlay.style.letterSpacing = '1.50em';
      return;
    }
    if (fieldName === 'debitMyAccount' && page === '5') {
      overlay.style.letterSpacing = '1.10em';
      return;
    }
    // Page 9: accountNumber, cifNumber, and eTinIndividual should have NO spacing
    if ((fieldName === 'accountNumber' || fieldName === 'cifNumber' || fieldName === 'eTinIndividual') && page === '9') {
      overlay.style.letterSpacing = 'normal';
      return;
    }
    // Page 15: accountNumber should have NO spacing
    if (fieldName === 'accountNumber' && page === '15') {
      overlay.style.letterSpacing = 'normal';
      return;
    }
    if (fieldName === 'accountNumber' && (page === '4' || page === '6' || page === '8')) {
      overlay.style.letterSpacing = '1.50em';
      return;
    }
    // Page 7 "accountNumber1" uses increased spacing
    if (fieldName === 'accountNumber1' && page === '7') {
      overlay.style.letterSpacing = '1.50em';
      return;
    }
    if (fieldName === 'accountNumber' && page === '5') {
      overlay.style.letterSpacing = '1.10em';
      return;
    }
    if (LETTER_SPACING[fieldName] !== undefined) {
      overlay.style.letterSpacing = LETTER_SPACING[fieldName] + 'em';
    }
  }

  // Helper function to add NBSP between each character (for fields without letter-spacing)
  function addNBSPBetweenCharacters(text, fieldName) {
    if (text === undefined || text === null) return text;
    // Fields using letter-spacing don't need NBSP - return plain text
    if (LETTER_SPACING[fieldName] !== undefined) {
      return String(text);
    }
    // Default: 3 regular NBSPs + 1 narrow no-break space
    const nbsp = '\u00A0\u00A0\u00A0\u202F';
    return String(text).split('').join(nbsp);
  }

  // Create an overlay DOM element from data and attach drag/delete handlers
  function createOverlayElement(data) {
    // data: { page, field, leftPercent, topPercent }
    const pageEl = document.querySelector(`.form-page[data-page="${data.page}"]`);
    if (!pageEl) return null;

    const overlay = document.createElement('div');
    overlay.className = 'overlay';
    // display text: for most overlays we show the field name, but for accountNumber and cifNumber show the actual value
    let displayText = data.field || 'field';
    if (form) {
      if (data.field === 'accountNumber' && form.elements['accountNumber']) {
        displayText = form.elements['accountNumber'].value || displayText;
      } else if (data.field === 'accountNumber1' && form.elements['accountNumber']) {
        displayText = form.elements['accountNumber'].value || displayText;
      } else if (data.field === 'cifNumber' && form.elements['cifNumber']) {
        displayText = form.elements['cifNumber'].value || displayText;
      } else if (data.field === 'interestAccountNumber' && form.elements['interestAccountNumber']) {
        displayText = form.elements['interestAccountNumber'].value || displayText;
      } else if (data.field === 'branchName') {
        const branchInput = form.elements['branchName'] || document.getElementById('slideBranchInput');
        if (branchInput) displayText = branchInput.value || displayText;
      } else if (data.field === 'productName' && form.elements['productName']) {
        displayText = form.elements['productName'].value || displayText;
      } else if (data.field === 'schemeName') {
        const s = (form.elements['schemeName'] && form.elements['schemeName'].value) || (form.elements['dpsSchemeName'] && form.elements['dpsSchemeName'].value) || '';
        displayText = s ? s : displayText;
      } else if (data.field === 'todayDate') {
        const d = (form.elements['todayDate'] && form.elements['todayDate'].value) || '';
        if (d) {
          displayText = d;
        } else {
          // fallback to current date
          const now = new Date();
          const dd = String(now.getDate()).padStart(2, '0');
          const mm = String(now.getMonth() + 1).padStart(2, '0');
          const yyyy = now.getFullYear();
          // Format: DD-MM-YYYY for page 9, DD    MM    YYYY for others
          if (data.page === '9') {
            displayText = dd + '-' + mm + '-' + yyyy;
          } else {
            displayText = dd + '\u00A0\u00A0\u00A0\u00A0' + mm + '\u00A0\u00A0\u00A0\u00A0' + yyyy;
          }
        }
      } else if (data.field === 'orgNameEn') {
        displayText = (form.elements['orgNameEn'] && form.elements['orgNameEn'].value) || displayText;
      } else if (data.field === 'orgNameBn') {
        displayText = (form.elements['orgNameBn'] && form.elements['orgNameBn'].value) || displayText;
      } else if (data.field === 'tradeLicenceNo') {
        displayText = (form.elements['tradeLicenceNo'] && form.elements['tradeLicenceNo'].value) || displayText;
      } else if (data.field === 'tradeLicenceDate') {
        displayText = (form.elements['tradeLicenceDate'] && form.elements['tradeLicenceDate'].value) || displayText;
      } else if (data.field === 'tradeLicenceAuthority') {
        displayText = (form.elements['tradeLicenceAuthority'] && form.elements['tradeLicenceAuthority'].value) || displayText;
      } else if (data.field === 'registrationNo') {
        displayText = (form.elements['registrationNo'] && form.elements['registrationNo'].value) || displayText;
      } else if (data.field === 'registrationDate') {
        displayText = (form.elements['registrationDate'] && form.elements['registrationDate'].value) || displayText;
      } else if (data.field === 'registrationAuthority') {
        displayText = (form.elements['registrationAuthority'] && form.elements['registrationAuthority'].value) || displayText;
      } else if (data.field === 'registeredAddress') {
        displayText = (form.elements['registeredAddress'] && form.elements['registeredAddress'].value) || displayText;
      } else if (data.field === 'vatBin') {
        displayText = (form.elements['vatBin'] && form.elements['vatBin'].value) || displayText;
      } else if (data.field === 'businessAddress') {
        displayText = (form.elements['businessAddress'] && form.elements['businessAddress'].value) || displayText;
      } else if (data.field === 'eTin') {
        displayText = (form.elements['eTin'] && form.elements['eTin'].value) || displayText;
      } else if (data.field === 'orgTypeOther') {
        displayText = (form.elements['orgTypeOther'] && form.elements['orgTypeOther'].value) || displayText;
      } else if (data.field === 'businessTypeOther') {
        displayText = (form.elements['businessTypeOther'] && form.elements['businessTypeOther'].value) || displayText;
      } else if (data.field === 'frequency') {
        const f = (form.elements['frequency'] && form.elements['frequency'].value) || 'Monthly';
        displayText = f;
      } else if (data.field === 'dpsYears') {
        const y = (form.elements['dpsYears'] && form.elements['dpsYears'].value) || (form.elements['dpsYears'] && form.elements['dpsYears'].value) || '';
        displayText = y ? (y + (y === '1' ? ' year' : ' years')) : displayText;
      } else if (data.field === 'dpsMonths') {
        const yv = (form.elements['dpsYears'] && form.elements['dpsYears'].value) || '';
        const months = Number(yv) ? String(Number(yv) * 12) : '';
        displayText = months;
      } else if (data.field === 'productInterestRate' && form.elements['productInterestRate']) {
        const rate = form.elements['productInterestRate'].value;
        displayText = rate ? (rate + '%') : displayText;
      } else if (data.field === 'amountFDR') {
        // Prefer dedicated hidden field, otherwise fall back to depositAmount
        const amt = (form.elements['amountFDR'] && form.elements['amountFDR'].value) || (form.elements['depositAmount'] && form.elements['depositAmount'].value) || '';
        displayText = amt ? amt : 'Amount (FDR)';
      } else if (data.field === 'amountDPSInWords') {
        const w = (form.elements['amountDPSInWords'] && form.elements['amountDPSInWords'].value) || '';
        displayText = w ? w : 'Amount (DPS) in words';
      } else if (data.field === 'amountFDRInWords') {
        const w = (form.elements['amountFDRInWords'] && form.elements['amountFDRInWords'].value) || '';
        displayText = w ? w : 'Amount (FDR) in words';
      } else if (data.field === 'amountDPS') {
        const amt = (form.elements['amountDPS'] && form.elements['amountDPS'].value) || (form.elements['depositAmount'] && form.elements['depositAmount'].value) || '';
        displayText = amt ? amt : 'Amount (DPS)';
      } else if (data.field === 'tenorYears') {
        const y = form.elements['tenorYears'] ? form.elements['tenorYears'].value : '';
        displayText = y ? y : displayText;
      } else if (data.field === 'tenorMonths') {
        const m = form.elements['tenorMonths'] ? form.elements['tenorMonths'].value : '';
        displayText = m ? m : displayText;
      } else if (data.field === 'tenorDays') {
        const d = form.elements['tenorDays'] ? form.elements['tenorDays'].value : '';
        displayText = d ? d : displayText;
        } else if (data.field === 'staticTwo') {
          displayText = '2';
        } else if (data.field === 'staticFourPage2') {
          displayText = '4';
      } else if (form.elements && form.elements[data.field]) {
        // Generic fallback: if a form element exists with the same name, use its value
        displayText = form.elements[data.field].value || displayText;
      }
    }
    // If this overlay is a static number box (staticOne/staticTwo/staticFour...), prefer the configured label
    const staticNumberFields = ['staticOne', 'staticTwo', 'staticThreePage3', 'staticFour', 'staticFourPage2', 'staticFourPage3', 'savingsLabel', 'naPage10_1', 'naPage10_2'];
    if (data.label && staticNumberFields.includes(data.field)) {
      displayText = data.label;
    }
    
    // Apply NBSP spacing for specific fields (but NOT accountNumber/cifNumber/eTinIndividual on page 9, NOT accountNumber on page 15)
    const fieldsWithNBSPSpacing = ['accountNumber', 'accountNumber1', 'cifNumber', 'interestAccountNumber', 'eTin', 'eTinIndividual', 'presentPostCode', 'permanentPostCode', 'tradeLicenceDate', 'registrationDate', 'sectorCodeIfFullNameEn', 'sectorCodeIfOrgNameEn', 'nineNineEightIfFullNameEn', 'nineNineEightIfOrgNameEn'];
    if (fieldsWithNBSPSpacing.includes(data.field)) {
      // Skip NBSP spacing for accountNumber, cifNumber, and eTinIndividual on page 9; accountNumber on page 15
      if (((data.field === 'accountNumber' || data.field === 'cifNumber' || data.field === 'eTinIndividual') && data.page === '9') || (data.field === 'accountNumber' && data.page === '15')) {
        // No spacing for page 9 and page 15
      } else {
        if ((data.field === 'tradeLicenceDate' || data.field === 'registrationDate') && displayText) {
          displayText = formatDateForOverlay(displayText);
        }
        displayText = addNBSPBetweenCharacters(displayText, data.field);
      }
    }
    
    // Handle dateOfBirth formatting - convert to DDMMYYYY for letter-spacing
    if (data.field === 'dateOfBirth' && displayText) {
      displayText = formatDateForOverlay(displayText);
    }
    
    overlay.textContent = displayText;
    overlay.setAttribute('data-field', data.field || '');
    // Preserve the configured label on the DOM so update logic can fall back to it
    if (data.label) overlay.setAttribute('data-label', data.label);
    overlay.setAttribute('data-page', data.page);
    overlay.style.left = (data.leftPercent || 0) + '%';
    overlay.style.top = (data.topPercent || 0) + '%';
    
    // Apply letter-spacing for specific fields (but NOT accountNumber/cifNumber/eTinIndividual on page 9, NOT accountNumber on page 15)
    if (fieldsWithNBSPSpacing.includes(data.field)) {
      if (!(((data.field === 'accountNumber' || data.field === 'cifNumber' || data.field === 'eTinIndividual') && data.page === '9') || (data.field === 'accountNumber' && data.page === '15'))) {
        applyLetterSpacing(overlay, data.field, data.page);
      }
    }
    // Apply letter-spacing for dateOfBirth and nomineeDob
    if (data.field === 'dateOfBirth' || data.field === 'nomineeDob') {
      applyLetterSpacing(overlay, data.field, data.page);
    }
    // Apply letter-spacing for debitMyAccount on page 4
    if (data.field === 'debitMyAccount') {
      applyLetterSpacing(overlay, data.field, data.page);
    }
    // Apply letter-spacing for sector code fields on page 15
    if (data.field === 'sectorCodeIfFullNameEn' || data.field === 'sectorCodeIfOrgNameEn' || data.field === 'nineNineEightIfFullNameEn' || data.field === 'nineNineEightIfOrgNameEn') {
      applyLetterSpacing(overlay, data.field, data.page);
    }

    // If this overlay represents a tick (visual check), apply tick styling
    const isTickOverlay = typeof data.field === 'string' && (data.field.startsWith('tick') || data.field.includes('ClientBusiness') || data.field.includes('ClientProfession') || data.field.includes('TypeOfOnboarding') || data.field.includes('PepIpCeo') || data.field.includes('CloseAssociate') || data.field.includes('AvgYearlyTransaction') || data.field.includes('CredibleSourceOfFunds') || data.field.includes('TotalScore'));
    if (isTickOverlay) {
      overlay.className = 'overlay overlay-check';
      // If a label is provided for the tick overlay, display it by default
      overlay.textContent = data.label || '';
    }

    // When in edit mode, overlays become interactive
    function updateEditingState() {
      if (editMode.checked) {
        overlay.classList.add('editing');
        overlay.style.pointerEvents = 'auto';
      } else {
        overlay.classList.remove('editing');
        overlay.style.pointerEvents = 'none';
      }
    }

    updateEditingState();

    // Drag handlers
    let dragging = false;
    let startX = 0, startY = 0;
    let origLeft = 0, origTop = 0;

    overlay.addEventListener('pointerdown', function(e) {
      if (!editMode.checked) return;
      e.preventDefault();
      dragging = true;
      overlay.setPointerCapture(e.pointerId);
      const rect = pageEl.getBoundingClientRect();
      startX = e.clientX;
      startY = e.clientY;
      // compute current px positions
      origLeft = (parseFloat(overlay.style.left) / 100) * rect.width;
      origTop = (parseFloat(overlay.style.top) / 100) * rect.height;

      function onPointerMove(ev) {
        if (!dragging) return;
        const dx = ev.clientX - startX;
        const dy = ev.clientY - startY;
        let newLeftPx = origLeft + dx;
        let newTopPx = origTop + dy;
        // clamp
        newLeftPx = Math.max(0, Math.min(newLeftPx, rect.width - overlay.offsetWidth));
        newTopPx = Math.max(0, Math.min(newTopPx, rect.height - overlay.offsetHeight));
        const leftPct = (newLeftPx / rect.width) * 100;
        const topPct = (newTopPx / rect.height) * 100;
        overlay.style.left = leftPct + '%';
        overlay.style.top = topPct + '%';
      }

      function onPointerUp(ev) {
        dragging = false;
        try { overlay.releasePointerCapture(ev.pointerId); } catch (e) {}
        document.removeEventListener('pointermove', onPointerMove);
        document.removeEventListener('pointerup', onPointerUp);
      }

      document.addEventListener('pointermove', onPointerMove);
      document.addEventListener('pointerup', onPointerUp);
    });

    // Watch edit mode changes to toggle interactivity
    editMode.addEventListener('change', updateEditingState);

    // Hide overlay if it has no meaningful content (excluding tick overlays and static fields)
    const staticFields = ['staticOne', 'staticTwo', 'staticFour', 'staticFourPage2', 'staticThreePage3', 'staticFourPage3', 'staticFourPage4', 'staticFourPage4Second', 'naPage10_1', 'naPage10_2', 'tickPage10_1', 'tickPage10_2', 'tickPage10_3'];
    const fieldsToAlwaysShow = ['schemeName', 'dpsYears', 'frequency'];
    const shouldCheckEmpty = !isTickOverlay && !staticFields.includes(data.field) && !fieldsToAlwaysShow.includes(data.field);
    if (shouldCheckEmpty && (!displayText || displayText === data.field)) {
      overlay.style.display = 'none';
    }
    // Force static number overlays to always be visible
    if (staticFields.includes(data.field)) {
      overlay.style.display = '';
    }

    pageEl.appendChild(overlay);
    return overlay;
  }

  // Helper: set overlay text for a given field name
  function setOverlayText(fieldName, text) {
    // Apply NBSP spacing for specific fields (but NOT accountNumber/cifNumber on page 9)
    const fieldsWithNBSPSpacing = ['accountNumber', 'accountNumber1', 'cifNumber', 'interestAccountNumber', 'eTin', 'eTinIndividual', 'presentPostCode', 'permanentPostCode', 'tradeLicenceDate', 'registrationDate'];
    if (fieldsWithNBSPSpacing.includes(fieldName) && text) {
      // Skip initial NBSP spacing for accountNumber and cifNumber - will handle per overlay below
      if (!((fieldName === 'accountNumber' || fieldName === 'cifNumber'))) {
        if ((fieldName === 'tradeLicenceDate' || fieldName === 'registrationDate') && text) {
          text = formatDateForOverlay(text);
        }
        text = addNBSPBetweenCharacters(text, fieldName);
      }
    }
    
    // Handle dateOfBirth formatting - convert to DDMMYYYY for letter-spacing
    if ((fieldName === 'dateOfBirth' || fieldName === 'nomineeDob') && text) {
      text = formatDateForOverlay(text);
    }
    
    const nodes = document.querySelectorAll('.overlay[data-field="' + fieldName + '"]');
    nodes.forEach(el => {
      let displayText = text;
      const page = el.dataset.page;
      
      // Handle todayDate with page-specific formatting
      if (fieldName === 'todayDate' && displayText) {
        if (page === '9') {
          // Format as DD-MM-YYYY for page 9
          const dateMatch = displayText.match(/(\d{2})\s*[-\/]?\s*(\d{2})\s*[-\/]?\s*(\d{4})/);
          if (dateMatch) {
            displayText = dateMatch[1] + '-' + dateMatch[2] + '-' + dateMatch[3];
          }
        }
        // For other pages, displayText keeps its spacing as provided
      }
      
      // Handle accountNumber and cifNumber spacing per page
      if ((fieldName === 'accountNumber' || fieldName === 'cifNumber') && displayText) {
        if (page !== '9') {
          // Apply NBSP spacing for pages other than 9
          displayText = addNBSPBetweenCharacters(displayText, fieldName);
        }
        // For page 9, keep displayText without spacing
      }
      
      // Hide overlay when text is empty, show when it has content
      if (displayText !== undefined && displayText !== null && displayText !== '') {
        el.textContent = displayText;
        el.style.display = '';
        // Apply letter-spacing for specific fields
        if (fieldsWithNBSPSpacing.includes(fieldName)) {
          applyLetterSpacing(el, fieldName, page);
        }
        // Apply letter-spacing for dateOfBirth and nomineeDob
        if (fieldName === 'dateOfBirth' || fieldName === 'nomineeDob') {
          applyLetterSpacing(el, fieldName, page);
        }
        // Apply letter-spacing for debitMyAccount on page 4
        if (fieldName === 'debitMyAccount') {
          applyLetterSpacing(el, fieldName, page);
        }
      } else {
        el.textContent = '';
        el.style.display = 'none';
      }
    });
  }

  // Helper: set/unset a tick overlay (uses a visible checkmark when true)
  function setTickOverlay(fieldName, checked) {
    const nodes = document.querySelectorAll('.overlay[data-field="' + fieldName + '"]');
    nodes.forEach(el => {
      if (checked) {
        el.textContent = el.dataset.label || 'âœ“';
        el.style.display = '';
      } else {
        el.textContent = '';
        el.style.display = 'none';
      }
    });
  }

  // Update all overlays with current form data (called when switching to Form Preview)
  function updateOverlays() {
    // Collect form data
    const formData = new FormData(form);
    const data = {};
    for (let [key, value] of formData.entries()) {
      data[key] = value;
    }

    // Get account type
    const mainAccountType = document.getElementById('mainAccountType');
    const accountType = mainAccountType ? mainAccountType.value : (form.elements['accountType'] ? form.elements['accountType'].value : '');
    
    console.log('updateOverlays - accountType:', accountType);

    // Get DPS popup values (check popup first, then fallback to hidden inputs)
    const dpsSchemeInput = document.getElementById('dpsSchemeName');
    const dpsYearsInput = document.getElementById('dpsYears');
    
    // Get scheme name from popup or hidden input
    if (dpsSchemeInput && dpsSchemeInput.value) {
      data.schemeName = dpsSchemeInput.value;
    } else if (form.elements['schemeName'] && form.elements['schemeName'].value) {
      data.schemeName = form.elements['schemeName'].value;
    }
    
    // Get dpsYears from popup or hidden input
    let yearsValue = '';
    if (dpsYearsInput && dpsYearsInput.value) {
      yearsValue = dpsYearsInput.value;
    } else if (form.elements['dpsYears'] && form.elements['dpsYears'].value) {
      yearsValue = form.elements['dpsYears'].value;
    }
    
    if (yearsValue) {
      // Format dpsYears to show "1 Year" or "5 Years" format
      data.dpsYears = yearsValue === '1' ? (yearsValue + ' Year') : (yearsValue + ' Years');
      data.dpsMonths = String(Number(yearsValue) * 12);
    }
    
    // Get frequency value
    const frequencyInput = form.elements['frequency'];
    if (frequencyInput && frequencyInput.value) {
      data.frequency = frequencyInput.value;
    } else {
      data.frequency = 'Monthly';
    }

    // Define FDR and DPS specific fields
    const fdrFields = ['amountFDR', 'amountFDRInWords', 'tenorYears', 'tenorMonths', 'tenorDays', 'productName', 'productInterestRate'];
    const dpsFields = ['schemeName', 'dpsYears', 'dpsMonths', 'frequency', 'amountDPS', 'amountDPSInWords'];
    // Pages that have FDR/DPS specific fields (page 1 for conventional, page 5 for taqwa)
    const mainPages = ['1', '5'];

    // Update each overlay with its corresponding form value
    document.querySelectorAll('.overlay').forEach(overlay => {
      const field = overlay.dataset.field;
      const page = overlay.dataset.page;
      if (!field) return;

      // Defer rendering of generic tick overlays to dedicated tick-update functions
      // (tick overlays are controlled by functions like updateMaturityTicks/updateModeTicks)
      if (field && field.startsWith('tick')) {
        return;
      }

      // Handle Client's Business ticks: 53 positions linked to dropdown options (kycClientBusiness_1 to kycClientBusiness_53)
      if (field && field.startsWith('kycClientBusiness_')) {
        const tickNum = parseInt(field.split('_')[1], 10);
        const selectEl = form.elements['kycClientBusiness'];
        if (selectEl && selectEl.selectedIndex > 0 && selectEl.selectedIndex === tickNum) {
          overlay.textContent = 'âœ”';
          overlay.style.display = '';
        } else {
          overlay.textContent = '';
          overlay.style.display = 'none';
        }
        return;
      }

      // Handle Client's Profession ticks: 19 positions linked to dropdown options (kycClientProfession_1 to kycClientProfession_19)
      if (field && field.startsWith('kycClientProfession_')) {
        const tickNum = parseInt(field.split('_')[1], 10);
        const selectEl = form.elements['kycClientProfession'];
        if (selectEl && selectEl.selectedIndex > 0 && selectEl.selectedIndex === tickNum) {
          overlay.textContent = 'âœ”';
          overlay.style.display = '';
        } else {
          overlay.textContent = '';
          overlay.style.display = 'none';
        }
        return;
      }

      // Handle Type of On-boarding Score ticks: 4 positions linked to dropdown options (kycTypeOfOnboarding_1 to kycTypeOfOnboarding_4)
      if (field && field.startsWith('kycTypeOfOnboarding_')) {
        const tickNum = parseInt(field.split('_')[1], 10);
        const selectEl = form.elements['kycTypeOfOnboarding'];
        if (selectEl && selectEl.selectedIndex > 0 && selectEl.selectedIndex === tickNum) {
          overlay.textContent = 'âœ”';
          overlay.style.display = '';
        } else {
          overlay.textContent = '';
          overlay.style.display = 'none';
        }
        return;
      }

      // Handle PEP/IP/CEO ticks: 2 positions linked to dropdown options (kycPepIpCeo_1 to kycPepIpCeo_2)
      if (field && field.startsWith('kycPepIpCeo_')) {
        const tickNum = parseInt(field.split('_')[1], 10);
        const selectEl = form.elements['kycPepIpCeo'];
        if (selectEl && selectEl.selectedIndex > 0 && selectEl.selectedIndex === tickNum) {
          overlay.textContent = 'âœ”';
          overlay.style.display = '';
        } else {
          overlay.textContent = '';
          overlay.style.display = 'none';
        }
        return;
      }

      // Handle Close Associate of PEP/IP/CEO ticks: 2 positions linked to dropdown options (kycCloseAssociatePep_1 to kycCloseAssociatePep_2)
      if (field && field.startsWith('kycCloseAssociatePep_')) {
        const tickNum = parseInt(field.split('_')[1], 10);
        const selectEl = form.elements['kycCloseAssociatePep'];
        if (selectEl && selectEl.selectedIndex > 0 && selectEl.selectedIndex === tickNum) {
          overlay.textContent = 'âœ”';
          overlay.style.display = '';
        } else {
          overlay.textContent = '';
          overlay.style.display = 'none';
        }
        return;
      }

      // Handle Customer's Avg Yearly Transaction ticks: 8 positions linked to dropdown options (kycAvgYearlyTransaction_1 to kycAvgYearlyTransaction_8)
      if (field && field.startsWith('kycAvgYearlyTransaction_')) {
        const tickNum = parseInt(field.split('_')[1], 10);
        const selectEl = form.elements['kycAvgYearlyTransaction'];
        if (selectEl && selectEl.selectedIndex > 0 && selectEl.selectedIndex === tickNum) {
          overlay.textContent = 'âœ”';
          overlay.style.display = '';
        } else {
          overlay.textContent = '';
          overlay.style.display = 'none';
        }
        return;
      }

      // Handle Credible Source of Funds ticks: 2 positions linked to dropdown options (kycCredibleSourceOfFunds_1 to kycCredibleSourceOfFunds_2)
      if (field && field.startsWith('kycCredibleSourceOfFunds_')) {
        const tickNum = parseInt(field.split('_')[1], 10);
        const selectEl = form.elements['kycCredibleSourceOfFunds'];
        if (selectEl && selectEl.selectedIndex > 0 && selectEl.selectedIndex === tickNum) {
          overlay.textContent = 'âœ”';
          overlay.style.display = '';
        } else {
          overlay.textContent = '';
          overlay.style.display = 'none';
        }
        return;
      }

      // Handle Client's Business Score textbox
      if (field === 'kycClientBusinessScore') {
        const businessField = form.elements['kycClientBusiness'];
        const businessVal = businessField ? businessField.value : '';
        let businessScore = '';
        if (businessVal && businessVal.includes('|')) {
          businessScore = businessVal.split('|')[1];
        }
        overlay.textContent = businessScore;
        overlay.style.display = businessScore ? '' : 'none';
        return;
      }

      // Handle Client's Profession Score textbox
      if (field === 'kycClientProfessionScore') {
        const professionField = form.elements['kycClientProfession'];
        const professionVal = professionField ? professionField.value : '';
        let professionScore = '';
        if (professionVal && professionVal.includes('|')) {
          professionScore = professionVal.split('|')[1];
        }
        overlay.textContent = professionScore;
        overlay.style.display = professionScore ? '' : 'none';
        return;
      }

      // Handle KYC Total Score textbox - calculate the score
      if (field === 'kycTotalScore') {
        let totalScore = 0;

        // Client's Business score
        const businessField = form.elements['kycClientBusiness'];
        const businessVal = businessField ? businessField.value : '';
        if (businessVal && businessVal.includes('|')) {
          const score = businessVal.split('|')[1];
          if (score.includes('-')) {
            totalScore += parseInt(score.split('-')[1], 10) || 0;
          } else {
            totalScore += parseInt(score, 10) || 0;
          }
        }

        // Client's Profession score
        const professionField = form.elements['kycClientProfession'];
        const professionVal = professionField ? professionField.value : '';
        if (professionVal && professionVal.includes('|')) {
          const score = professionVal.split('|')[1];
          if (score.includes('-')) {
            totalScore += parseInt(score.split('-')[1], 10) || 0;
          } else {
            totalScore += parseInt(score, 10) || 0;
          }
        }

        // Type of On-boarding score
        const onboardingField = form.elements['kycTypeOfOnboarding'];
        const onboardingVal = onboardingField ? onboardingField.value : '';
        if (onboardingVal && onboardingVal.includes('|')) {
          totalScore += parseInt(onboardingVal.split('|')[1], 10) || 0;
        }

        // PEP/IP/CEO score
        const pepField = form.elements['kycPepIpCeo'];
        const pepVal = pepField ? pepField.value : '';
        if (pepVal && pepVal.includes('|')) {
          totalScore += parseInt(pepVal.split('|')[1], 10) || 0;
        }

        // Close Associate of PEP/IP/CEO score
        const closeAssociateField = form.elements['kycCloseAssociatePep'];
        const closeAssociateVal = closeAssociateField ? closeAssociateField.value : '';
        if (closeAssociateVal && closeAssociateVal.includes('|')) {
          totalScore += parseInt(closeAssociateVal.split('|')[1], 10) || 0;
        }

        // Customer's Avg Yearly Transaction score
        const transactionField = form.elements['kycAvgYearlyTransaction'];
        const transactionVal = transactionField ? transactionField.value : '';
        if (transactionVal && transactionVal.includes('|')) {
          totalScore += parseInt(transactionVal.split('|')[1], 10) || 0;
        }

        // Credible Source of Funds score
        const credibleField = form.elements['kycCredibleSourceOfFunds'];
        const credibleVal = credibleField ? credibleField.value : '';
        if (credibleVal && credibleVal.includes('|')) {
          totalScore += parseInt(credibleVal.split('|')[1], 10) || 0;
        }

        // Add 4 to total
        totalScore += 4;

        overlay.textContent = totalScore;
        overlay.style.display = '';
        
        // Update ticks based on total score
        try { updateTotalScoreTicks(); } catch (e) {}
        
        return;
      }

      // Handle sameAsLinkedAccountPersonalNote specially based on checkbox and 4th digit
      if (field === 'sameAsLinkedAccountPersonalNote') {
        const isChecked = form.elements['sameAsLinkedAccountPersonal'] && form.elements['sameAsLinkedAccountPersonal'].checked;
        const accountVal = (form.elements['accountNumber'] && form.elements['accountNumber'].value) || '';
        const fourthChar = accountVal.length > 3 ? accountVal[3] : '';
        const debitVal = (form.elements['debitMyAccount'] && form.elements['debitMyAccount'].value) ? form.elements['debitMyAccount'].value : '';
        const overlayText = isChecked && accountVal ? 'Same as Link Account: ' + debitVal : '';
        
        if (!isChecked || !accountVal) {
          overlay.style.display = 'none';
          overlay.textContent = '';
        } else if ((fourthChar === '1' || fourthChar === '2') && (page === '1' || page === '5')) {
          // Page 1 for conventional, Page 5 for taqwa
          overlay.style.display = 'block';
          overlay.textContent = overlayText;
        } else if (fourthChar === '3' && page === '2') {
          overlay.style.display = 'block';
          overlay.textContent = overlayText;
        } else if (fourthChar === '3' && page === '6') {
          // Page 6 for taqwa equivalent to page 2 in conventional
          overlay.style.display = 'block';
          overlay.textContent = overlayText;
        } else {
          overlay.style.display = 'none';
          overlay.textContent = '';
        }
        return;
      }

      // Handle sameAsLinkedAccountNomineeNote specially based on checkbox
      if (field === 'sameAsLinkedAccountNomineeNote') {
        const isChecked = form.elements['sameAsLinkedAccountNominee'] && form.elements['sameAsLinkedAccountNominee'].checked;
        const debitVal = (form.elements['debitMyAccount'] && form.elements['debitMyAccount'].value) ? form.elements['debitMyAccount'].value : '';
        const overlayText = isChecked ? 'Same as Link Account: ' + debitVal : '';
        
        if ((page === '3') || (page === '7')) {
          // Page 3 for conventional, Page 7 for taqwa
          if (isChecked && debitVal) {
            overlay.style.display = 'block';
            overlay.textContent = overlayText;
          } else {
            overlay.style.display = 'none';
            overlay.textContent = '';
          }
        } else {
          overlay.style.display = 'none';
          overlay.textContent = '';
        }
        return;
      }

      // Handle KYC Total Score ticks and risk level - these are controlled by updateTotalScoreTicks function
      if (field === 'kycTotalScore_1' || field === 'kycTotalScore_2' || field === 'kycRiskLevel') {
        // Let updateTotalScoreTicks function handle these
        return;
      }

      // Static number overlays should always show their configured label (or hardcoded fallback)
      const staticNumberFields = ['staticOne', 'staticTwo', 'staticThreePage3', 'staticFour', 'staticFourPage2', 'staticFourPage3', 'staticFourPage4', 'staticFourPage4Second', 'savingsLabel', 'naPage10_1', 'naPage10_2', 'tickPage10_1', 'tickPage10_2', 'tickPage10_3', 'tickStaticPage12', 'tickStaticPage12_2', 'kycClientBusiness_1', 'kycClientBusiness_2', 'kycClientBusiness_3', 'kycClientBusiness_4', 'kycClientBusiness_5', 'kycClientBusiness_6', 'kycClientBusiness_7', 'kycClientBusiness_8', 'kycClientBusiness_9', 'kycClientBusiness_10', 'kycClientBusiness_11', 'kycClientBusiness_12', 'kycClientBusiness_13', 'kycClientBusiness_14', 'kycClientBusiness_15', 'kycClientBusiness_16', 'kycClientBusiness_17', 'kycClientBusiness_18', 'kycClientBusiness_19', 'kycClientBusiness_20', 'kycClientBusiness_21', 'kycClientBusiness_22', 'kycClientBusiness_23', 'kycClientBusiness_24', 'kycClientBusiness_25', 'kycClientBusiness_26', 'kycClientBusiness_27', 'kycClientBusiness_28', 'kycClientBusiness_29', 'kycClientBusiness_30', 'kycClientBusiness_31', 'kycClientBusiness_32', 'kycClientBusiness_33', 'kycClientBusiness_34', 'kycClientBusiness_35', 'kycClientBusiness_36', 'kycClientBusiness_37', 'kycClientBusiness_38', 'kycClientBusiness_39', 'kycClientBusiness_40', 'kycClientBusiness_41', 'kycClientBusiness_42', 'kycClientBusiness_43', 'kycClientBusiness_44', 'kycClientBusiness_45', 'kycClientBusiness_46', 'kycClientBusiness_47', 'kycClientBusiness_48', 'kycClientBusiness_49', 'kycClientBusiness_50', 'kycClientBusiness_51', 'kycClientBusiness_52', 'kycClientBusiness_53', 'kycClientProfession_1', 'kycClientProfession_2', 'kycClientProfession_3', 'kycClientProfession_4', 'kycClientProfession_5', 'kycClientProfession_6', 'kycClientProfession_7', 'kycClientProfession_8', 'kycClientProfession_9', 'kycClientProfession_10', 'kycClientProfession_11', 'kycClientProfession_12', 'kycClientProfession_13', 'kycClientProfession_14', 'kycClientProfession_15', 'kycClientProfession_16', 'kycClientProfession_17', 'kycClientProfession_18', 'kycClientProfession_19', 'kycTypeOfOnboarding_1', 'kycTypeOfOnboarding_2', 'kycTypeOfOnboarding_3', 'kycTypeOfOnboarding_4', 'kycPepIpCeo_1', 'kycPepIpCeo_2', 'kycCloseAssociatePep_1', 'kycCloseAssociatePep_2', 'kycAvgYearlyTransaction_1', 'kycAvgYearlyTransaction_2', 'kycAvgYearlyTransaction_3', 'kycAvgYearlyTransaction_4', 'kycAvgYearlyTransaction_5', 'kycAvgYearlyTransaction_6', 'kycAvgYearlyTransaction_7', 'kycAvgYearlyTransaction_8', 'kycCredibleSourceOfFunds_1', 'kycCredibleSourceOfFunds_2'];
      if (staticNumberFields.includes(field)) {
        // Use dataset.label if available, otherwise use hardcoded values
        let staticLabel = (overlay.dataset && overlay.dataset.label) ? overlay.dataset.label : '';
        if (!staticLabel) {
          // Hardcoded fallback values
          if (field === 'staticTwo') staticLabel = '2';
          else if (field === 'staticFourPage2') staticLabel = '4';
          else if (field === 'staticFourPage4') staticLabel = '4';
          else if (field === 'staticFourPage4Second') staticLabel = '4';
          else if (field === 'staticFour') staticLabel = '4';
          else if (field === 'staticThreePage3') staticLabel = '3';
          else if (field === 'staticFourPage3') staticLabel = '4';
          else if (field === 'staticOne') staticLabel = '1';
          else if (field === 'savingsLabel') staticLabel = 'Savings';
          else if (field === 'naPage10_1') staticLabel = 'N/A';
          else if (field === 'naPage10_2') staticLabel = 'N/A';
          else if (field === 'tickPage10_1') staticLabel = 'âœ“';
          else if (field === 'tickPage10_2') staticLabel = 'âœ“';
          else if (field === 'tickPage10_3') staticLabel = 'âœ“';
          else if (field === 'tickStaticPage12') staticLabel = 'âœ“';
          else if (field === 'tickStaticPage12_2') staticLabel = 'âœ“';
          else if (field.includes('ClientBusiness_')) staticLabel = 'âœ“';
          else if (field.includes('ClientProfession_')) staticLabel = 'âœ“';
        }
        overlay.textContent = staticLabel;
        overlay.style.display = '';
        return;
      }

      // First, enforce FDR/DPS field visibility based on account type
      // When FDR is selected, ALWAYS hide DPS fields on main pages
      if (accountType === 'FDR' && dpsFields.includes(field) && mainPages.includes(page)) {
        overlay.textContent = '';
        overlay.style.display = 'none';
        return;
      }

      // When DPS is selected, ALWAYS hide FDR fields on main pages
      if (accountType === 'DPS' && fdrFields.includes(field) && mainPages.includes(page)) {
        console.log('Hiding FDR field:', field, 'on page:', page);
        overlay.textContent = '';
        overlay.style.display = 'none';
        return;
      }

      // Mirror orgNameEn to orgNameEn2, and orgNameBn to orgNameBn2
      // Hide when sameAsLinkedAccountPersonal is checked
      const sameAsLinked = form.elements['sameAsLinkedAccountPersonal'] && form.elements['sameAsLinkedAccountPersonal'].checked;
      
      if (field === 'orgNameEn2') {
        const orgNameEnValue = form.elements['orgNameEn'] ? form.elements['orgNameEn'].value : '';
        if (orgNameEnValue && !sameAsLinked) {
          overlay.textContent = orgNameEnValue;
          overlay.style.display = '';
        } else {
          overlay.textContent = '';
          overlay.style.display = 'none';
        }
        return;
      }

      if (field === 'orgNameBn2') {
        const orgNameBnValue = form.elements['orgNameBn'] ? form.elements['orgNameBn'].value : '';
        if (orgNameBnValue && !sameAsLinked) {
          overlay.textContent = orgNameBnValue;
          overlay.style.display = '';
        } else {
          overlay.textContent = '';
          overlay.style.display = 'none';
        }
        return;
      }

      // Hide fullNameEn and fullNameBn on pages 2 and 6 when sameAsLinkedAccountPersonal is checked
      if ((field === 'fullNameEn' || field === 'fullNameBn') && (page === '2' || page === '6') && sameAsLinked) {
        overlay.textContent = '';
        overlay.style.display = 'none';
        return;
      }

      // Get value from collected data first, fallback to form element
      let value = data[field];
      if (value === undefined || value === null || value === '') {
        // accountNumber1 uses the accountNumber form field value
        const fieldForValue = field === 'accountNumber1' ? 'accountNumber' : field;
        const el = form.elements[fieldForValue];
        if (el) {
          value = el.value || '';
        } else {
          value = '';
        }
      }

      // Update overlay - show only if value exists and field is not hidden by account type
      if (value !== undefined && value !== null && value !== '') {
        // Apply NBSP spacing for specific fields (but NOT accountNumber/cifNumber/eTinIndividual on page 9, NOT accountNumber on page 15)
        const fieldsWithNBSPSpacing = ['accountNumber', 'accountNumber1', 'cifNumber', 'interestAccountNumber', 'eTin', 'eTinIndividual', 'tradeLicenceDate', 'registrationDate', 'sectorCodeIfFullNameEn', 'sectorCodeIfOrgNameEn', 'nineNineEightIfFullNameEn', 'nineNineEightIfOrgNameEn'];
        if (fieldsWithNBSPSpacing.includes(field)) {
          // Skip NBSP spacing for accountNumber, cifNumber, and eTinIndividual on page 9; accountNumber on page 15
          if (((field === 'accountNumber' || field === 'cifNumber' || field === 'eTinIndividual') && page === '9') || (field === 'accountNumber' && page === '15')) {
            // No spacing for page 9 and page 15
          } else {
            if ((field === 'tradeLicenceDate' || field === 'registrationDate') && value) {
              value = formatDateForOverlay(value);
            }
            value = addNBSPBetweenCharacters(value, field);
          }
        }
        // Format dateOfBirth and nomineeDob as DDMMYYYY with letter-spacing
        if (field === 'dateOfBirth' || field === 'nomineeDob') {
          value = formatDateForOverlay(value);
          applyLetterSpacing(overlay, field, page);
        }
        // Format todayDate: DD-MM-YYYY for page 9, with spaces for others
        if (field === 'todayDate') {
          if (page === '9') {
            // Format as DD-MM-YYYY for page 9
            const dateMatch = value.match(/(\d{4})-(\d{2})-(\d{2})/);
            if (dateMatch) {
              value = dateMatch[3] + '-' + dateMatch[2] + '-' + dateMatch[1];
            }
          } else {
            // Keep spacing for other pages
            const dateMatch = value.match(/(\d{4})-(\d{2})-(\d{2})/);
            if (dateMatch) {
              const dd = dateMatch[3];
              const mm = dateMatch[2];
              const yyyy = dateMatch[1];
              value = dd + '\u00A0\u00A0\u00A0\u00A0' + mm + '\u00A0\u00A0\u00A0\u00A0' + yyyy;
            }
          }
        }
        // Apply letter-spacing for fields (but NOT accountNumber/cifNumber on page 9)
        if (field === 'debitMyAccount' || field === 'accountNumber' || field === 'accountNumber1' || field === 'cifNumber' || field === 'sectorCodeIfFullNameEn' || field === 'sectorCodeIfOrgNameEn' || field === 'nineNineEightIfFullNameEn' || field === 'nineNineEightIfOrgNameEn') {
          applyLetterSpacing(overlay, field, page);
        }
        overlay.textContent = value;
        overlay.style.display = '';
      } else if (overlay.dataset && overlay.dataset.label) {
        // If overlay has a configured label (static number boxes etc), show that label
        overlay.textContent = overlay.dataset.label;
        overlay.style.display = '';
      } else {
        // Hide empty overlays (but not if they're hidden by account type - already handled above)
        overlay.textContent = '';
        overlay.style.display = 'none';
      }
    });
    
    // Force tickTextbox to always show on page 3 (conventional) and page 7 (taqwa) (no conditions)
    const tickTextboxElements = document.querySelectorAll('.overlay[data-field="tickTextbox"][data-page="3"], .overlay[data-field="tickTextbox"][data-page="7"]');
    tickTextboxElements.forEach(el => {
      el.textContent = 'âœ“';
      el.style.display = '';
    });
    
    // Force tickOne to always show on page 2 (conventional) and page 6 (taqwa) (no conditions)
    const tickOneElements = document.querySelectorAll('.overlay[data-field="tickOne"][data-page="2"], .overlay[data-field="tickOne"][data-page="6"]');
    tickOneElements.forEach(el => {
      el.textContent = 'âœ“';
      el.style.display = '';
    });
    
    // Handle conditional FDR textboxes on page 15
    const fdrIfFullNameEnElements = document.querySelectorAll('.overlay[data-field="fdrIfFullNameEn"]');
    fdrIfFullNameEnElements.forEach(el => {
      const fullNameEnValue = form.elements['fullNameEn']?.value || '';
      if (fullNameEnValue !== '') {
        el.textContent = 'FDR';
        el.style.display = '';
      } else {
        el.textContent = '';
        el.style.display = 'none';
      }
    });
    
    const fdrIfOrgNameEnElements = document.querySelectorAll('.overlay[data-field="fdrIfOrgNameEn"]');
    fdrIfOrgNameEnElements.forEach(el => {
      const orgNameEnValue = form.elements['orgNameEn']?.value || '';
      if (orgNameEnValue !== '') {
        el.textContent = 'FDR';
        el.style.display = '';
      } else {
        el.textContent = '';
        el.style.display = 'none';
      }
    });
    
    // Handle conditional sector code textboxes on page 15
    const sectorCodeIfFullNameEnElements = document.querySelectorAll('.overlay[data-field="sectorCodeIfFullNameEn"]');
    sectorCodeIfFullNameEnElements.forEach(el => {
      const fullNameEnValue = form.elements['fullNameEn']?.value || '';
      const sectorCodeValue = form.elements['sectorCode']?.value || '';
      if (fullNameEnValue !== '' && sectorCodeValue !== '') {
        el.textContent = sectorCodeValue;
        el.style.display = '';
      } else {
        el.textContent = '';
        el.style.display = 'none';
      }
    });
    
    const sectorCodeIfOrgNameEnElements = document.querySelectorAll('.overlay[data-field="sectorCodeIfOrgNameEn"]');
    sectorCodeIfOrgNameEnElements.forEach(el => {
      const orgNameEnValue = form.elements['orgNameEn']?.value || '';
      const sectorCodeValue = form.elements['sectorCode']?.value || '';
      if (orgNameEnValue !== '' && sectorCodeValue !== '') {
        el.textContent = sectorCodeValue;
        el.style.display = '';
      } else {
        el.textContent = '';
        el.style.display = 'none';
      }
    });
    
    // Handle conditional 998 textboxes on page 15
    const nineNineEightIfFullNameEnElements = document.querySelectorAll('.overlay[data-field="nineNineEightIfFullNameEn"]');
    nineNineEightIfFullNameEnElements.forEach(el => {
      const fullNameEnValue = form.elements['fullNameEn']?.value || '';
      if (fullNameEnValue !== '') {
        el.textContent = '998';
        el.style.display = '';
      } else {
        el.textContent = '';
        el.style.display = 'none';
      }
    });
    
    const nineNineEightIfOrgNameEnElements = document.querySelectorAll('.overlay[data-field="nineNineEightIfOrgNameEn"]');
    nineNineEightIfOrgNameEnElements.forEach(el => {
      const orgNameEnValue = form.elements['orgNameEn']?.value || '';
      if (orgNameEnValue !== '') {
        el.textContent = '998';
        el.style.display = '';
      } else {
        el.textContent = '';
        el.style.display = 'none';
      }
    });
    
    // Load and display officer seals
    try {
      const officerSealsData = JSON.parse(localStorage.getItem('deposit_officer_seals_v1') || '{}');
      const sealSize = parseInt(officerSealsData.size || 140, 10) || 140;
      const sealWidth = Math.round(sealSize * 1.6);
      
      // Display officer seal 1
      if (officerSealsData.officer1) {
        const seal1Elements = document.querySelectorAll('.overlay[data-field="officerSeal1"]');
        seal1Elements.forEach(el => {
          el.textContent = officerSealsData.officer1;
          el.style.display = '';
          el.style.width = sealWidth + 'px';
          el.style.height = sealSize + 'px';
          el.style.whiteSpace = 'pre-wrap';
          el.style.fontSize = (0.65 * (sealSize / 140)) + 'rem';
          el.style.padding = Math.max(8, Math.round(sealSize * 0.06)) + 'px';
          el.style.overflow = 'hidden';
        });
      }
      // Display officer seal 2
      if (officerSealsData.officer2) {
        const seal2Elements = document.querySelectorAll('.overlay[data-field="officerSeal2"]');
        seal2Elements.forEach(el => {
          el.textContent = officerSealsData.officer2;
          el.style.display = '';
          el.style.width = sealWidth + 'px';
          el.style.height = sealSize + 'px';
          el.style.whiteSpace = 'pre-wrap';
          el.style.fontSize = (0.65 * (sealSize / 140)) + 'rem';
          el.style.padding = Math.max(8, Math.round(sealSize * 0.06)) + 'px';
          el.style.overflow = 'hidden';
        });
      }
      // Display officer seal 3
      if (officerSealsData.officer3) {
        const seal3Elements = document.querySelectorAll('.overlay[data-field="officerSeal3"]');
        seal3Elements.forEach(el => {
          el.textContent = officerSealsData.officer3;
          el.style.display = '';
          el.style.width = sealWidth + 'px';
          el.style.height = sealSize + 'px';
          el.style.whiteSpace = 'pre-wrap';
          el.style.fontSize = (0.65 * (sealSize / 140)) + 'rem';
          el.style.padding = Math.max(8, Math.round(sealSize * 0.06)) + 'px';
          el.style.overflow = 'hidden';
        });
      }
    } catch (e) {}
  }

  // Default overlay configuration per page (used when no saved positions exist)
  const overlayConfig = {
    conventional: [
      // Page 1
      { field: 'combinedApplicants', top: '18.5%', left: '22%', label: 'Applicants', page: '1' },
      { field: 'combinedApplicantsBn', top: '11%', left: '35%', label: 'Applicants (BN)', page: '1' },
      { field: 'todayDate', top: '6%', left: '85%', label: 'Date', page: '1' },
      { field: 'branchName', top: '4%', left: '10%', label: 'Branch Name', page: '1' },
      { field: 'branchName', top: '6%', left: '10%', label: 'Branch Name 1', page: '1' },
      { field: 'accountNumber', top: '12%', left: '28%', label: 'Account No', page: '1' },
      { field: 'cifNumber', top: '10%', left: '48%', label: 'CIF', page: '1' },
      { field: 'interestAccountNumber', top: '14%', left: '60%', label: 'Interest Account No', page: '1' },
      { field: 'productName', top: '30%', left: '10%', label: 'Product Name', page: '1' },
      // Simple static number overlays
      { field: 'staticOne', top: '22%', left: '70%', label: 'Static 1', page: '1' },
      { field: 'staticFour', top: '22%', left: '74%', label: 'Static 4', page: '1' },
      // Organization information overlays
      { field: 'orgNameEn', top: '6%', left: '10%', label: 'Organization Name (EN) - 1', page: '1' },
      { field: 'orgNameBn', top: '8%', left: '10%', label: 'Organization Name (BN) - 1', page: '1' },
      { field: 'orgNameEn2', top: '20%', left: '10%', label: 'Organization Name (EN) - 2', page: '1' },
      { field: 'orgNameBn2', top: '22%', left: '10%', label: 'Organization Name (BN) - 2', page: '1' },
      { field: 'tradeLicenceNo', top: '10%', left: '10%', label: 'Trade Licence No.', page: '1' },
      { field: 'tradeLicenceDate', top: '10%', left: '40%', label: 'Trade Licence Date', page: '1' },
      { field: 'tradeLicenceAuthority', top: '12%', left: '10%', label: 'Issuing Authority', page: '1' },
      { field: 'registrationNo', top: '14%', left: '10%', label: 'Registration No.', page: '1' },
      { field: 'registrationDate', top: '14%', left: '40%', label: 'Registration Date', page: '1' },
      { field: 'registrationAuthority', top: '16%', left: '10%', label: 'Registration Authority', page: '1' },
      { field: 'registeredAddress', top: '18%', left: '10%', label: 'Registered Address', page: '1' },
      { field: 'vatBin', top: '20%', left: '10%', label: 'VAT Registration No./BIN', page: '1' },
      { field: 'sameAsLinkedAccountPersonalNote', top: '46%', left: '35%', label: 'Same as Link Account', page: '1' },      
      { field: 'businessAddress', top: '22%', left: '10%', label: 'Business/Office Address', page: '2' },
      { field: 'eTin', top: '20%', left: '40%', label: 'E-TIN', page: '1' },
      // Organization type tick overlays on page 2
      { field: 'tickOrg_Proprietorship', top: '10%', left: '60%', label: '', page: '2' },
      { field: 'tickOrg_Partnership', top: '12%', left: '60%', label: '', page: '2' },
      { field: 'tickOrg_JointVenture', top: '14%', left: '60%', label: '', page: '2' },
      { field: 'tickOrg_PrivateLtd', top: '16%', left: '60%', label: '', page: '2' },
      { field: 'tickOrg_PublicLtd', top: '18%', left: '60%', label: '', page: '2' },
      { field: 'tickOrg_Trust', top: '20%', left: '60%', label: '', page: '2' },
      { field: 'tickOrg_NGO', top: '22%', left: '60%', label: '', page: '2' },
      { field: 'tickOrg_Club', top: '24%', left: '60%', label: '', page: '2' },
      { field: 'tickOrg_Educational', top: '26%', left: '60%', label: '', page: '2' },
      { field: 'tickOrg_Religious', top: '28%', left: '60%', label: '', page: '2' },
      { field: 'tickOrg_Others', top: '30%', left: '60%', label: '', page: '2' },
      { field: 'orgTypeOther', top: '32%', left: '62%', label: 'Org Type (Other)', page: '2' },
      // Business type ticks
      { field: 'tickBusiness_Trading', top: '10%', left: '66%', label: '', page: '2' },
      { field: 'tickBusiness_Service', top: '12%', left: '66%', label: '', page: '2' },
      { field: 'tickBusiness_Manufacturing', top: '14%', left: '66%', label: '', page: '2' },
      { field: 'tickBusiness_Others', top: '16%', left: '66%', label: '', page: '2' },
      { field: 'businessTypeOther', top: '18%', left: '68%', label: 'Business Type (Other)', page: '2' },
      { field: 'businessNature', top: '24%', left: '10%', label: 'Nature of Business', page: '2' },
      { field: 'annualTurnover', top: '26%', left: '10%', label: 'Annual Turnover', page: '2' },
      // Gender tick overlays on page 2
      { field: 'tickGender_Male', top: '28%', left: '60%', label: '', page: '2' },
      { field: 'tickGender_Female', top: '30%', left: '60%', label: '', page: '2' },
      { field: 'tickGender_Third', top: '32%', left: '60%', label: '', page: '2' },
      // Additional requested tick and static boxes on page 2
      { field: 'tickOne', top: '34%', left: '56%', label: '', page: '2' },
      { field: 'staticTwo', top: '44%', left: '10%', label: '2', page: '2' },
      { field: 'staticFourPage2', top: '44%', left: '14%', label: '4', page: '2' },
      // Page 3: small static numbers and a tick inside a textbox
      { field: 'staticThreePage3', top: '44%', left: '10%', label: '3', page: '3' },
      { field: 'staticFourPage3', top: '44%', left: '14%', label: '4', page: '3' },
      { field: 'tickTextbox', top: '34%', left: '56%', label: '', page: '3' },
      { field: 'kycAmlTrackingNumber', top: '8%', left: '70%', label: 'AML Tracking No', page: '3' },
      { field: 'accountNumber', top: '12%', left: '28%', label: 'Account No', page: '2' },
      { field: 'schemeName', top: '30%', left: '40%', label: 'Scheme Name', page: '1' },
      { field: 'dpsYears', top: '32%', left: '40%', label: 'Duration (Years)', page: '1' },
      { field: 'dpsMonths', top: '34%', left: '40%', label: 'Duration (Months)', page: '1' },

      { field: 'frequency', top: '34%', left: '25%', label: 'Frequency', page: '1' },
      { field: 'productInterestRate', top: '38%', left: '10%', label: 'Interest Rate', page: '1' },
      { field: 'amountFDR', top: '34%', left: '10%', label: 'Amount (FDR)', page: '1' },
      { field: 'amountDPS', top: '36%', left: '10%', label: 'Amount (DPS)', page: '1' },
      { field: 'amountFDRInWords', top: '38%', left: '10%', label: 'Amount (FDR) in words', page: '1' },
      { field: 'amountDPSInWords', top: '40%', left: '10%', label: 'Amount (DPS) in words', page: '1' },
      { field: 'tenorYears', top: '46%', left: '10%', label: 'Tenure (Y)', page: '1' },
      { field: 'tenorMonths', top: '46%', left: '20%', label: 'Tenure (M)', page: '1' },
      { field: 'tenorDays', top: '46%', left: '30%', label: 'Tenure (D)', page: '1' },
      // Tick overlays for maturity renewal options (visual ticks, not inputs)
      { field: 'tickRenewBoth', top: '50%', left: '62%', label: 'âœ“', page: '1' },
      { field: 'tickRenewPrincipal', top: '52%', left: '62%', label: 'âœ“', page: '1' },
      { field: 'tickModeSingle', top: '54%', left: '62%', label: 'âœ“', page: '1' },
      { field: 'tickModeJoint', top: '56%', left: '62%', label: 'âœ“', page: '1' },
      // Page 2-4: Add branch overlays for consistency
      { field: 'fullNameEn', top: '18.5%', left: '22%', label: 'Full Name (EN)', page: '2' },
      { field: 'fullNameBn', top: '11%', left: '35%', label: 'Full Name (BN)', page: '2' },
      { field: 'fatherName', top: '20%', left: '10%', label: "Father's Name", page: '2' },
      { field: 'motherName', top: '21.5%', left: '10%', label: "Mother's Name", page: '2' },
      { field: 'spouseName', top: '23%', left: '10%', label: "Spouse's Name", page: '2' },
      { field: 'dateOfBirth', top: '8%', left: '40%', label: 'Date of Birth', page: '2' },
      { field: 'nationality', top: '24.5%', left: '10%', label: 'Nationality', page: '2' },
      // residentStatus removed
      { field: 'profession', top: '28%', left: '10%', label: 'Profession', page: '2' },
      { field: 'probableMonthlyIncome', top: '29.5%', left: '10%', label: 'Probable Monthly Income', page: '2' },
      { field: 'sourceOfFund', top: '31%', left: '10%', label: 'Source of Fund', page: '2' },
      { field: 'eTinIndividual', top: '32.5%', left: '10%', label: 'E-TIN (Individual)', page: '2' },
      { field: 'identityDocumentNumber', top: '34%', left: '40%', label: 'ID Number', page: '2' },
      { field: 'tickId_NID', top: '34%', left: '55%', label: '', page: '2' },
      { field: 'tickId_Passport', top: '36%', left: '55%', label: '', page: '2' },
      { field: 'tickId_BirthCertificate', top: '38%', left: '55%', label: '', page: '2' },
      { field: 'tickId_Others', top: '40%', left: '55%', label: '', page: '2' },
      { field: 'mobileNumber', top: '35.5%', left: '10%', label: 'Mobile Number', page: '2' },
      { field: 'email', top: '35.5%', left: '40%', label: 'Email Address', page: '2' },
      { field: 'rmCode', top: '38%', left: '35%', label: 'RM Code', page: '3' },
      { field: 'secondApplicant', top: '41%', left: '35%', label: '2nd Applicant', page: '3' },
      { field: 'thirdApplicant', top: '43%', left: '35%', label: '3rd Applicant', page: '3' },
      { field: 'nomineeName', top: '15%', left: '35%', label: 'Nominee Name', page: '3' },
      { field: 'nomineeRelation', top: '18%', left: '35%', label: 'Relationship with Applicant', page: '3' },
      { field: 'nomineeDob', top: '21%', left: '35%', label: 'Nominee DOB', page: '3' },
      { field: 'nomineeShare', top: '24%', left: '65%', label: 'Share %', page: '3' },
      { field: 'nomineeIdentityDocumentNumber', top: '27%', left: '55%', label: 'Nominee ID Number', page: '3' },
      { field: 'tickNominee_NID', top: '27%', left: '75%', label: '', page: '3' },
      { field: 'tickNominee_Passport', top: '29%', left: '75%', label: '', page: '3' },
      { field: 'tickNominee_BirthCertificate', top: '31%', left: '75%', label: '', page: '3' },
      { field: 'tickNominee_Others', top: '33%', left: '75%', label: '', page: '3' },
      { field: 'nomineeAddress', top: '30%', left: '35%', label: 'Nominee Address', page: '3' },
      { field: 'nomineePhone', top: '33.5%', left: '35%', label: 'Nominee Phone', page: '3' },
      { field: 'nomineeEmail', top: '33.5%', left: '55%', label: 'Nominee Email', page: '3' },
      { field: 'sameAsLinkedAccountPersonalNote', top: '46%', left: '35%', label: 'Same as Link Account', page: '2' },
      // Individual present address subfields
      { field: 'presentHouse', top: '36.5%', left: '10%', label: 'House', page: '2' },
      { field: 'presentArea', top: '36.5%', left: '28%', label: 'Area', page: '2' },
      { field: 'presentPostOffice', top: '36.5%', left: '46%', label: 'Post Office', page: '2' },
      { field: 'presentPostCode', top: '36.5%', left: '64%', label: 'Post Code', page: '2' },
      { field: 'presentThana', top: '40%', left: '10%', label: 'Thana', page: '2' },
      { field: 'presentDistrict', top: '40%', left: '28%', label: 'District', page: '2' },
      { field: 'presentCountry', top: '40%', left: '46%', label: 'Country', page: '2' },
      // Individual permanent address subfields
      { field: 'permanentHouse', top: '42.5%', left: '10%', label: 'House', page: '2' },
      { field: 'permanentArea', top: '42.5%', left: '28%', label: 'Area', page: '2' },
      { field: 'permanentPostOffice', top: '42.5%', left: '46%', label: 'Post Office', page: '2' },
      { field: 'permanentPostCode', top: '42.5%', left: '64%', label: 'Post Code', page: '2' },
      { field: 'permanentThana', top: '46%', left: '10%', label: 'Thana', page: '2' },
      { field: 'permanentDistrict', top: '46%', left: '28%', label: 'District', page: '2' },
      { field: 'permanentCountry', top: '46%', left: '46%', label: 'Country', page: '2' },
      // passportNo and nid removed from page 2
      { field: 'accountNumber', top: '12%', left: '28%', label: 'Account No', page: '3' },
      { field: 'accountNumber', top: '12%', left: '28%', label: 'Account No 1', page: '3' },
      { field: 'sameAsLinkedAccountNomineeNote', top: '46%', left: '35%', label: 'Same as Link Account', page: '3' },
      { field: 'tickModeSingle', top: '54%', left: '62%', label: '', page: '3' },
      { field: 'tickModeJoint', top: '56%', left: '62%', label: '', page: '3' },
      { field: 'fullNameEn', top: '18.5%', left: '22%', label: 'Full Name (EN)', page: '3' },
      // Page 4: Static number overlays
      { field: 'staticFourPage4', top: '44%', left: '10%', label: '4', page: '4' },
      { field: 'staticFourPage4Second', top: '44%', left: '14%', label: '4', page: '4' },
      { field: 'accountNumber', top: '12%', left: '28%', label: 'Account No', page: '4' },
      { field: 'fullNameEn', top: '18.5%', left: '22%', label: 'Full Name (EN)', page: '4' },
      { field: 'debitMyAccount', top: '39.5%', left: '35%', label: 'Debit My Account', page: '4' },
      { field: 'secondApplicant', top: '41%', left: '35%', label: '2nd Applicant', page: '4' },
      { field: 'thirdApplicant', top: '43%', left: '35%', label: '3rd Applicant', page: '4' },
      // Officer seals - Page 1, 2, 3
      { field: 'officerSeal1', top: '85%', left: '10%', label: 'Officer Seal 1', page: '1' },
      { field: 'officerSeal1', top: '85%', left: '10%', label: 'Officer Seal 1', page: '2' },
      { field: 'officerSeal1', top: '85%', left: '10%', label: 'Officer Seal 1', page: '3' },
      { field: 'officerSeal2', top: '85%', left: '35%', label: 'Officer Seal 2', page: '3' },
      { field: 'officerSeal3', top: '85%', left: '60%', label: 'Officer Seal 3', page: '3' },
    ],
    taqwa: [
      // Page 5 (same as conventional page 1)
      { field: 'combinedApplicants', top: '18.5%', left: '22%', label: 'Applicants', page: '5' },
      { field: 'combinedApplicantsBn', top: '11%', left: '35%', label: 'Applicants (BN)', page: '5' },
      { field: 'todayDate', top: '6%', left: '85%', label: 'Date', page: '5' },
      { field: 'branchName', top: '4%', left: '10%', label: 'Branch Name', page: '5' },
      { field: 'branchName', top: '6%', left: '10%', label: 'Branch Name 1', page: '5' },
      { field: 'accountNumber', top: '12%', left: '28%', label: 'Account No', page: '5' },
      { field: 'cifNumber', top: '10%', left: '48%', label: 'CIF', page: '5' },
      { field: 'interestAccountNumber', top: '14%', left: '60%', label: 'Interest Account No', page: '5' },
      { field: 'isrBank', top: '16%', left: '28%', label: 'ISR Bank', page: '5' },
      { field: 'isrCustomer', top: '18%', left: '28%', label: 'ISR Customer', page: '5' },
      { field: 'productName', top: '30%', left: '10%', label: 'Product Name', page: '5' },
      { field: 'staticOne', top: '22%', left: '70%', label: 'Static 1', page: '5' },
      { field: 'staticFour', top: '22%', left: '74%', label: 'Static 4', page: '5' },
      { field: 'orgNameEn', top: '6%', left: '10%', label: 'Organization Name (EN) - 1', page: '5' },
      { field: 'orgNameBn', top: '8%', left: '10%', label: 'Organization Name (BN) - 1', page: '5' },
      { field: 'orgNameEn2', top: '20%', left: '10%', label: 'Organization Name (EN) - 2', page: '5' },
      { field: 'orgNameBn2', top: '22%', left: '10%', label: 'Organization Name (BN) - 2', page: '5' },
      { field: 'tradeLicenceNo', top: '10%', left: '10%', label: 'Trade Licence No.', page: '5' },
      { field: 'tradeLicenceDate', top: '10%', left: '40%', label: 'Trade Licence Date', page: '5' },
      { field: 'tradeLicenceAuthority', top: '12%', left: '10%', label: 'Issuing Authority', page: '5' },
      { field: 'registrationNo', top: '14%', left: '10%', label: 'Registration No.', page: '5' },
      { field: 'registrationDate', top: '14%', left: '40%', label: 'Registration Date', page: '5' },
      { field: 'registrationAuthority', top: '16%', left: '10%', label: 'Registration Authority', page: '5' },
      { field: 'registeredAddress', top: '18%', left: '10%', label: 'Registered Address', page: '5' },
      { field: 'vatBin', top: '20%', left: '10%', label: 'VAT Registration No./BIN', page: '5' },
      { field: 'sameAsLinkedAccountPersonalNote', top: '46%', left: '35%', label: 'Same as Link Account', page: '5' },
      { field: 'eTin', top: '20%', left: '40%', label: 'E-TIN', page: '5' },
      { field: 'schemeName', top: '30%', left: '40%', label: 'Scheme Name', page: '5' },
      { field: 'dpsYears', top: '32%', left: '40%', label: 'Duration (Years)', page: '5' },
      { field: 'dpsMonths', top: '34%', left: '40%', label: 'Duration (Months)', page: '5' },
      { field: 'frequency', top: '34%', left: '25%', label: 'Frequency', page: '5' },
      { field: 'amountFDR', top: '34%', left: '10%', label: 'Amount (FDR)', page: '5' },
      { field: 'amountDPS', top: '36%', left: '10%', label: 'Amount (DPS)', page: '5' },
      { field: 'amountFDRInWords', top: '38%', left: '10%', label: 'Amount (FDR) in words', page: '5' },
      { field: 'amountDPSInWords', top: '40%', left: '10%', label: 'Amount (DPS) in words', page: '5' },
      { field: 'tenorYears', top: '46%', left: '10%', label: 'Tenure (Y)', page: '5' },
      { field: 'tenorMonths', top: '46%', left: '20%', label: 'Tenure (M)', page: '5' },
      { field: 'tenorDays', top: '46%', left: '30%', label: 'Tenure (D)', page: '5' },
      { field: 'tickRenewBoth', top: '50%', left: '62%', label: 'âœ“', page: '5' },
      { field: 'tickRenewPrincipal', top: '52%', left: '62%', label: 'âœ“', page: '5' },
      { field: 'tickModeSingle', top: '54%', left: '62%', label: '', page: '5' },
      { field: 'tickModeJoint', top: '56%', left: '62%', label: '', page: '5' },
      // Page 6 (same as conventional page 2)
      { field: 'tickOrg_Proprietorship', top: '10%', left: '60%', label: '', page: '6' },
      { field: 'tickOrg_Partnership', top: '12%', left: '60%', label: '', page: '6' },
      { field: 'tickOrg_JointVenture', top: '14%', left: '60%', label: '', page: '6' },
      { field: 'tickOrg_PrivateLtd', top: '16%', left: '60%', label: '', page: '6' },
      { field: 'tickOrg_PublicLtd', top: '18%', left: '60%', label: '', page: '6' },
      { field: 'tickOrg_Trust', top: '20%', left: '60%', label: '', page: '6' },
      { field: 'tickOrg_NGO', top: '22%', left: '60%', label: '', page: '6' },
      { field: 'tickOrg_Club', top: '24%', left: '60%', label: '', page: '6' },
      { field: 'tickOrg_Educational', top: '26%', left: '60%', label: '', page: '6' },
      { field: 'tickOrg_Religious', top: '28%', left: '60%', label: '', page: '6' },
      { field: 'tickOrg_Others', top: '30%', left: '60%', label: '', page: '6' },
      { field: 'orgTypeOther', top: '32%', left: '62%', label: 'Org Type (Other)', page: '6' },
      { field: 'tickBusiness_Trading', top: '10%', left: '66%', label: '', page: '6' },
      { field: 'tickBusiness_Service', top: '12%', left: '66%', label: '', page: '6' },
      { field: 'tickBusiness_Manufacturing', top: '14%', left: '66%', label: '', page: '6' },
      { field: 'tickBusiness_Others', top: '16%', left: '66%', label: '', page: '6' },
      { field: 'businessTypeOther', top: '18%', left: '68%', label: 'Business Type (Other)', page: '6' },
      { field: 'businessNature', top: '24%', left: '10%', label: 'Nature of Business', page: '6' },
      { field: 'annualTurnover', top: '26%', left: '10%', label: 'Annual Turnover', page: '6' },
      { field: 'businessAddress', top: '22%', left: '10%', label: 'Business/Office Address', page: '6' },
      { field: 'tickGender_Male', top: '28%', left: '60%', label: '', page: '6' },
      { field: 'tickGender_Female', top: '30%', left: '60%', label: '', page: '6' },
      { field: 'tickGender_Third', top: '32%', left: '60%', label: '', page: '6' },
      { field: 'tickOne', top: '34%', left: '56%', label: '', page: '6' },
      { field: 'staticTwo', top: '44%', left: '10%', label: '2', page: '6' },
      { field: 'staticFourPage2', top: '44%', left: '14%', label: '4', page: '6' },
      { field: 'accountNumber', top: '12%', left: '28%', label: 'Account No', page: '6' },
      { field: 'fullNameEn', top: '18.5%', left: '22%', label: 'Full Name (EN)', page: '6' },
      { field: 'fullNameBn', top: '11%', left: '35%', label: 'Full Name (BN)', page: '6' },
      { field: 'fatherName', top: '20%', left: '10%', label: "Father's Name", page: '6' },
      { field: 'motherName', top: '21.5%', left: '10%', label: "Mother's Name", page: '6' },
      { field: 'spouseName', top: '23%', left: '10%', label: "Spouse's Name", page: '6' },
      { field: 'dateOfBirth', top: '8%', left: '40%', label: 'Date of Birth', page: '6' },
      { field: 'nationality', top: '24.5%', left: '10%', label: 'Nationality', page: '6' },
      { field: 'profession', top: '28%', left: '10%', label: 'Profession', page: '6' },
      { field: 'probableMonthlyIncome', top: '29.5%', left: '10%', label: 'Probable Monthly Income', page: '6' },
      { field: 'sourceOfFund', top: '31%', left: '10%', label: 'Source of Fund', page: '6' },
      { field: 'eTinIndividual', top: '32.5%', left: '10%', label: 'E-TIN (Individual)', page: '6' },
      { field: 'identityDocumentNumber', top: '34%', left: '40%', label: 'ID Number', page: '6' },
      { field: 'tickId_NID', top: '34%', left: '55%', label: '', page: '6' },
      { field: 'tickId_Passport', top: '36%', left: '55%', label: '', page: '6' },
      { field: 'tickId_BirthCertificate', top: '38%', left: '55%', label: '', page: '6' },
      { field: 'tickId_Others', top: '40%', left: '55%', label: '', page: '6' },
      { field: 'mobileNumber', top: '35.5%', left: '10%', label: 'Mobile Number', page: '6' },
      { field: 'email', top: '35.5%', left: '40%', label: 'Email Address', page: '6' },
      { field: 'sameAsLinkedAccountPersonalNote', top: '46%', left: '35%', label: 'Same as Link Account', page: '6' },
      { field: 'presentHouse', top: '36.5%', left: '10%', label: 'House', page: '6' },
      { field: 'presentArea', top: '36.5%', left: '28%', label: 'Area', page: '6' },
      { field: 'presentPostOffice', top: '36.5%', left: '46%', label: 'Post Office', page: '6' },
      { field: 'presentPostCode', top: '36.5%', left: '64%', label: 'Post Code', page: '6' },
      { field: 'presentThana', top: '40%', left: '10%', label: 'Thana', page: '6' },
      { field: 'presentDistrict', top: '40%', left: '28%', label: 'District', page: '6' },
      { field: 'presentCountry', top: '40%', left: '46%', label: 'Country', page: '6' },
      { field: 'permanentHouse', top: '42.5%', left: '10%', label: 'House', page: '6' },
      { field: 'permanentArea', top: '42.5%', left: '28%', label: 'Area', page: '6' },
      { field: 'permanentPostOffice', top: '42.5%', left: '46%', label: 'Post Office', page: '6' },
      { field: 'permanentPostCode', top: '42.5%', left: '64%', label: 'Post Code', page: '6' },
      { field: 'permanentThana', top: '46%', left: '10%', label: 'Thana', page: '6' },
      { field: 'permanentDistrict', top: '46%', left: '28%', label: 'District', page: '6' },
      { field: 'permanentCountry', top: '46%', left: '46%', label: 'Country', page: '6' },
      // Page 7 (same as conventional page 3)
      { field: 'staticThreePage3', top: '44%', left: '10%', label: '3', page: '7' },
      { field: 'staticFourPage3', top: '44%', left: '14%', label: '4', page: '7' },
      { field: 'tickTextbox', top: '34%', left: '56%', label: '', page: '7' },
      { field: 'kycAmlTrackingNumber', top: '8%', left: '70%', label: 'AML Tracking No', page: '7' },
      { field: 'accountNumber', top: '12%', left: '28%', label: 'Account No', page: '7' },
      { field: 'accountNumber1', top: '12%', left: '28%', label: 'Account No 1', page: '7' },
      { field: 'sameAsLinkedAccountNomineeNote', top: '46%', left: '35%', label: 'Same as Link Account', page: '7' },
      { field: 'tickModeSingle', top: '54%', left: '62%', label: '', page: '7' },
      { field: 'tickModeJoint', top: '56%', left: '62%', label: '', page: '7' },
      { field: 'fullNameEn', top: '18.5%', left: '22%', label: 'Full Name (EN)', page: '7' },
      { field: 'rmCode', top: '38%', left: '35%', label: 'RM Code', page: '7' },
      { field: 'secondApplicant', top: '41%', left: '35%', label: '2nd Applicant', page: '7' },
      { field: 'thirdApplicant', top: '43%', left: '35%', label: '3rd Applicant', page: '7' },
      { field: 'nomineeName', top: '15%', left: '35%', label: 'Nominee Name', page: '7' },
      { field: 'nomineeRelation', top: '18%', left: '35%', label: 'Relationship with Applicant', page: '7' },
      { field: 'nomineeDob', top: '21%', left: '35%', label: 'Nominee DOB', page: '7' },
      { field: 'nomineeShare', top: '24%', left: '65%', label: 'Share %', page: '7' },
      { field: 'nomineeIdentityDocumentNumber', top: '27%', left: '55%', label: 'Nominee ID Number', page: '7' },
      { field: 'tickNominee_NID', top: '27%', left: '75%', label: '', page: '7' },
      { field: 'tickNominee_Passport', top: '29%', left: '75%', label: '', page: '7' },
      { field: 'tickNominee_BirthCertificate', top: '31%', left: '75%', label: '', page: '7' },
      { field: 'tickNominee_Others', top: '33%', left: '75%', label: '', page: '7' },
      { field: 'nomineeAddress', top: '30%', left: '35%', label: 'Nominee Address', page: '7' },
      { field: 'nomineePhone', top: '33.5%', left: '35%', label: 'Nominee Phone', page: '7' },
      { field: 'nomineeEmail', top: '33.5%', left: '55%', label: 'Nominee Email', page: '7' },
      // Page 8 (same as conventional page 4)
      { field: 'staticFourPage4', top: '44%', left: '10%', label: '4', page: '8' },
      { field: 'staticFourPage4Second', top: '44%', left: '14%', label: '4', page: '8' },
      { field: 'accountNumber', top: '12%', left: '28%', label: 'Account No', page: '8' },
      { field: 'fullNameEn', top: '18.5%', left: '22%', label: 'Full Name (EN)', page: '8' },
      { field: 'debitMyAccount', top: '39.5%', left: '35%', label: 'Debit My Account', page: '5' },
      { field: 'secondApplicant', top: '41%', left: '35%', label: '2nd Applicant', page: '8' },
      { field: 'thirdApplicant', top: '43%', left: '35%', label: '3rd Applicant', page: '8' },
      // Officer seals - Page 5, 6, 7
      { field: 'officerSeal1', top: '85%', left: '10%', label: 'Officer Seal 1', page: '5' },
      { field: 'officerSeal1', top: '85%', left: '10%', label: 'Officer Seal 1', page: '6' },
      { field: 'officerSeal1', top: '85%', left: '10%', label: 'Officer Seal 1', page: '7' },
      { field: 'officerSeal2', top: '85%', left: '35%', label: 'Officer Seal 2', page: '7' },
      { field: 'officerSeal3', top: '85%', left: '60%', label: 'Officer Seal 3', page: '7' }
    ],
    others: [
      // Page 9 (KYC Stand Alone FD Page 1)
      { field: 'branchName', top: '4%', left: '10%', label: 'Branch Name', page: '9' },
      { field: 'todayDate', top: '6%', left: '85%', label: 'Date', page: '9' },
      { field: 'accountNumber', top: '12%', left: '28%', label: 'Account No', page: '9' },
      { field: 'cifNumber', top: '10%', left: '48%', label: 'CIF', page: '9' },
      { field: 'accountType', top: '14%', left: '60%', label: 'Account Type', page: '9' },
      { field: 'savingsLabel', top: '16%', left: '60%', label: 'Savings', page: '9' },
      { field: 'profession', top: '28%', left: '10%', label: 'Profession', page: '9' },
      { field: 'probableMonthlyIncome', top: '29.5%', left: '10%', label: 'Probable Monthly Income', page: '9' },
      { field: 'sourceOfFund', top: '31%', left: '10%', label: 'Source of Fund', page: '9' },
      { field: 'eTinIndividual', top: '32.5%', left: '10%', label: 'E-TIN (Individual)', page: '9' },
      { field: 'tickETin1', top: '32.5%', left: '65%', label: 'âœ“', page: '9' },
      { field: 'tickETin2', top: '32.5%', left: '72%', label: 'âœ“', page: '9' },
      { field: 'combinedApplicants', top: '18.5%', left: '22%', label: 'Applicants', page: '9' },
      { field: 'orgNameEn', top: '6%', left: '10%', label: 'Organization Name (EN) - 1', page: '9' },
      { field: 'kycSourceOfFundDocument', top: '37%', left: '10%', label: 'Source of Fund document', page: '9' },
      { field: 'tickSourceOfFundDocument', top: '37%', left: '65%', label: '', page: '9' },
      { field: 'kycFaceToFaceConversation', top: '38.5%', left: '10%', label: 'Face to Face Conversation', page: '9' },
      { field: 'tickStaticPage9', top: '40%', left: '65%', label: 'âœ“', page: '9' },
      { field: 'nationalIdNumber', top: '42%', left: '10%', label: 'National ID Number', page: '9' },
      { field: 'tickNationalId1', top: '42%', left: '65%', label: '', page: '9' },
      { field: 'tickNationalId2', top: '42%', left: '72%', label: '', page: '9' },
      { field: 'passportNumber', top: '43.5%', left: '10%', label: 'Passport Number', page: '9' },
      { field: 'tickPassport1', top: '43.5%', left: '65%', label: '', page: '9' },
      { field: 'tickPassport2', top: '43.5%', left: '72%', label: '', page: '9' },
      { field: 'birthCertificateNumber', top: '45%', left: '10%', label: 'Birth Certificate Number', page: '9' },
      { field: 'tickBirthCert1', top: '45%', left: '65%', label: '', page: '9' },
      { field: 'tickBirthCert2', top: '45%', left: '72%', label: '', page: '9' },
      { field: 'registrationNo', top: '46.5%', left: '10%', label: 'Registration No.', page: '9' },
      { field: 'tickRegistration1', top: '46.5%', left: '65%', label: '', page: '9' },
      { field: 'tickRegistration2', top: '46.5%', left: '72%', label: '', page: '9' },
      { field: 'vatBin', top: '48%', left: '10%', label: 'VAT Registration No./BIN', page: '9' },
      { field: 'tickVatBin1', top: '48%', left: '65%', label: '', page: '9' },
      { field: 'tickVatBin2', top: '48%', left: '72%', label: '', page: '9' },
      // Page 10 (KYC Stand Alone FD Page 2)
      { field: 'tickPage10_1', top: '50%', left: '10%', label: 'âœ“', page: '10' },
      { field: 'tickPage10_2', top: '52%', left: '10%', label: 'âœ“', page: '10' },
      { field: 'tickPage10_3', top: '54%', left: '10%', label: 'âœ“', page: '10' },
      { field: 'naPage10_1', top: '56%', left: '10%', label: 'N/A', page: '10' },
      { field: 'naPage10_2', top: '58%', left: '10%', label: 'N/A', page: '10' },
      { field: 'kycClientBusiness_1', top: '60%', left: '10%', label: 'âœ“', page: '10' },
      { field: 'kycClientBusiness_2', top: '60%', left: '15%', label: 'âœ“', page: '10' },
      { field: 'kycClientBusiness_3', top: '60%', left: '20%', label: 'âœ“', page: '10' },
      { field: 'kycClientBusiness_4', top: '60%', left: '25%', label: 'âœ“', page: '10' },
      { field: 'kycClientBusiness_5', top: '60%', left: '30%', label: 'âœ“', page: '10' },
      { field: 'kycClientBusiness_6', top: '62%', left: '10%', label: 'âœ“', page: '10' },
      { field: 'kycClientBusiness_7', top: '62%', left: '15%', label: 'âœ“', page: '10' },
      { field: 'kycClientBusiness_8', top: '62%', left: '20%', label: 'âœ“', page: '10' },
      { field: 'kycClientBusiness_9', top: '62%', left: '25%', label: 'âœ“', page: '10' },
      { field: 'kycClientBusiness_10', top: '62%', left: '30%', label: 'âœ“', page: '10' },
      { field: 'kycClientBusiness_11', top: '64%', left: '10%', label: 'âœ“', page: '10' },
      { field: 'kycClientBusiness_12', top: '64%', left: '15%', label: 'âœ“', page: '10' },
      { field: 'kycClientBusiness_13', top: '64%', left: '20%', label: 'âœ“', page: '10' },
      { field: 'kycClientBusiness_14', top: '64%', left: '25%', label: 'âœ“', page: '10' },
      { field: 'kycClientBusiness_15', top: '64%', left: '30%', label: 'âœ“', page: '10' },
      { field: 'kycClientBusiness_16', top: '66%', left: '10%', label: 'âœ“', page: '10' },
      { field: 'kycClientBusiness_17', top: '66%', left: '15%', label: 'âœ“', page: '10' },
      { field: 'kycClientBusiness_18', top: '66%', left: '20%', label: 'âœ“', page: '10' },
      { field: 'kycClientBusiness_19', top: '66%', left: '25%', label: 'âœ“', page: '10' },
      { field: 'kycClientBusiness_20', top: '66%', left: '30%', label: 'âœ“', page: '10' },
      // Page 11 (KYC Stand Alone FD Page 3)
      { field: 'kycClientBusiness_21', top: '10%', left: '10%', label: 'âœ“', page: '11' },
      { field: 'kycClientBusiness_22', top: '10%', left: '15%', label: 'âœ“', page: '11' },
      { field: 'kycClientBusiness_23', top: '10%', left: '20%', label: 'âœ“', page: '11' },
      { field: 'kycClientBusiness_24', top: '10%', left: '25%', label: 'âœ“', page: '11' },
      { field: 'kycClientBusiness_25', top: '10%', left: '30%', label: 'âœ“', page: '11' },
      { field: 'kycClientBusiness_26', top: '12%', left: '10%', label: 'âœ“', page: '11' },
      { field: 'kycClientBusiness_27', top: '12%', left: '15%', label: 'âœ“', page: '11' },
      { field: 'kycClientBusiness_28', top: '12%', left: '20%', label: 'âœ“', page: '11' },
      { field: 'kycClientBusiness_29', top: '12%', left: '25%', label: 'âœ“', page: '11' },
      { field: 'kycClientBusiness_30', top: '12%', left: '30%', label: 'âœ“', page: '11' },
      { field: 'kycClientBusiness_31', top: '14%', left: '10%', label: 'âœ“', page: '11' },
      { field: 'kycClientBusiness_32', top: '14%', left: '15%', label: 'âœ“', page: '11' },
      { field: 'kycClientBusiness_33', top: '14%', left: '20%', label: 'âœ“', page: '11' },
      { field: 'kycClientBusiness_34', top: '14%', left: '25%', label: 'âœ“', page: '11' },
      { field: 'kycClientBusiness_35', top: '14%', left: '30%', label: 'âœ“', page: '11' },
      { field: 'kycClientBusiness_36', top: '16%', left: '10%', label: 'âœ“', page: '11' },
      { field: 'kycClientBusiness_37', top: '16%', left: '15%', label: 'âœ“', page: '11' },
      { field: 'kycClientBusiness_38', top: '16%', left: '20%', label: 'âœ“', page: '11' },
      { field: 'kycClientBusiness_39', top: '16%', left: '25%', label: 'âœ“', page: '11' },
      { field: 'kycClientBusiness_40', top: '16%', left: '30%', label: 'âœ“', page: '11' },
      { field: 'kycClientBusiness_41', top: '18%', left: '10%', label: 'âœ“', page: '11' },
      { field: 'kycClientBusiness_42', top: '18%', left: '15%', label: 'âœ“', page: '11' },
      { field: 'kycClientBusiness_43', top: '18%', left: '20%', label: 'âœ“', page: '11' },
      { field: 'kycClientBusiness_44', top: '18%', left: '25%', label: 'âœ“', page: '11' },
      { field: 'kycClientBusiness_45', top: '18%', left: '30%', label: 'âœ“', page: '11' },
      { field: 'kycClientBusiness_46', top: '20%', left: '10%', label: 'âœ“', page: '11' },
      { field: 'kycClientBusiness_47', top: '20%', left: '15%', label: 'âœ“', page: '11' },
      { field: 'kycClientBusiness_48', top: '20%', left: '20%', label: 'âœ“', page: '11' },
      { field: 'kycClientBusiness_49', top: '20%', left: '25%', label: 'âœ“', page: '11' },
      { field: 'kycClientBusiness_50', top: '20%', left: '30%', label: 'âœ“', page: '11' },
      { field: 'kycClientBusiness_51', top: '22%', left: '10%', label: 'âœ“', page: '11' },
      { field: 'kycClientBusiness_52', top: '22%', left: '15%', label: 'âœ“', page: '11' },
      { field: 'kycClientBusiness_53', top: '22%', left: '20%', label: 'âœ“', page: '11' },
      { field: 'kycClientProfession_1', top: '24%', left: '10%', label: 'âœ“', page: '11' },
      { field: 'kycClientProfession_2', top: '24%', left: '15%', label: 'âœ“', page: '11' },
      { field: 'kycClientProfession_3', top: '24%', left: '20%', label: 'âœ“', page: '11' },
      { field: 'kycClientProfession_4', top: '24%', left: '25%', label: 'âœ“', page: '11' },
      { field: 'kycClientProfession_5', top: '26%', left: '10%', label: 'âœ“', page: '11' },
      { field: 'kycClientProfession_6', top: '26%', left: '15%', label: 'âœ“', page: '11' },
      { field: 'kycClientProfession_7', top: '26%', left: '20%', label: 'âœ“', page: '11' },
      { field: 'kycClientProfession_8', top: '26%', left: '25%', label: 'âœ“', page: '11' },
      { field: 'kycClientProfession_9', top: '28%', left: '10%', label: 'âœ“', page: '11' },
      { field: 'kycClientProfession_10', top: '28%', left: '15%', label: 'âœ“', page: '11' },
      { field: 'kycClientProfession_11', top: '28%', left: '20%', label: 'âœ“', page: '11' },
      { field: 'kycClientProfession_12', top: '28%', left: '25%', label: 'âœ“', page: '11' },
      { field: 'kycClientProfession_13', top: '30%', left: '10%', label: 'âœ“', page: '11' },
      { field: 'kycClientProfession_14', top: '30%', left: '15%', label: 'âœ“', page: '11' },
      { field: 'kycClientProfession_15', top: '30%', left: '20%', label: 'âœ“', page: '11' },
      { field: 'kycClientProfession_16', top: '30%', left: '25%', label: 'âœ“', page: '11' },
      { field: 'kycClientProfession_17', top: '32%', left: '10%', label: 'âœ“', page: '11' },
      { field: 'kycClientProfession_18', top: '32%', left: '15%', label: 'âœ“', page: '11' },
      { field: 'kycClientProfession_19', top: '32%', left: '20%', label: 'âœ“', page: '11' },
      { field: 'kycTypeOfOnboarding_1', top: '34%', left: '10%', label: 'âœ“', page: '11' },
      { field: 'kycTypeOfOnboarding_2', top: '34%', left: '15%', label: 'âœ“', page: '11' },
      { field: 'kycTypeOfOnboarding_3', top: '34%', left: '20%', label: 'âœ“', page: '11' },
      { field: 'kycTypeOfOnboarding_4', top: '34%', left: '25%', label: 'âœ“', page: '11' },
      { field: 'kycPepIpCeo_1', top: '36%', left: '10%', label: 'âœ“', page: '11' },
      { field: 'kycPepIpCeo_2', top: '36%', left: '15%', label: 'âœ“', page: '11' },
      // Page 12 (KYC Stand Alone FD Page 4)
      { field: 'kycCloseAssociatePep_1', top: '10%', left: '10%', label: 'âœ“', page: '12' },
      { field: 'kycCloseAssociatePep_2', top: '10%', left: '15%', label: 'âœ“', page: '12' },
      { field: 'kycAvgYearlyTransaction_1', top: '14%', left: '10%', label: 'âœ“', page: '12' },
      { field: 'kycAvgYearlyTransaction_2', top: '14%', left: '15%', label: 'âœ“', page: '12' },
      { field: 'kycAvgYearlyTransaction_3', top: '14%', left: '20%', label: 'âœ“', page: '12' },
      { field: 'kycAvgYearlyTransaction_4', top: '14%', left: '25%', label: 'âœ“', page: '12' },
      { field: 'kycAvgYearlyTransaction_5', top: '16%', left: '10%', label: 'âœ“', page: '12' },
      { field: 'kycAvgYearlyTransaction_6', top: '16%', left: '15%', label: 'âœ“', page: '12' },
      { field: 'kycAvgYearlyTransaction_7', top: '16%', left: '20%', label: 'âœ“', page: '12' },
      { field: 'kycAvgYearlyTransaction_8', top: '16%', left: '25%', label: 'âœ“', page: '12' },
      { field: 'kycCredibleSourceOfFunds_1', top: '18%', left: '10%', label: 'âœ“', page: '12' },
      { field: 'kycCredibleSourceOfFunds_2', top: '18%', left: '15%', label: 'âœ“', page: '12' },
      { field: 'kycClientBusinessScore', top: '20%', left: '10%', label: '', page: '12' },
      { field: 'kycClientProfessionScore', top: '20%', left: '30%', label: '', page: '12' },
      { field: 'kycTotalScore', top: '22%', left: '10%', label: '', page: '13' },
      { field: 'kycTotalScore_1', top: '22%', left: '15%', label: 'âœ“', page: '13' },
      { field: 'kycTotalScore_2', top: '22%', left: '20%', label: 'âœ“', page: '13' },
      { field: 'kycRiskLevel', top: '24%', left: '10%', label: '', page: '13' },
      { field: 'officerSeal1', top: '85%', left: '10%', label: 'Officer Seal 1', page: '13' },
      { field: 'officerSeal2', top: '85%', left: '35%', label: 'Officer Seal 2', page: '13' },
      { field: 'officerSeal3', top: '85%', left: '60%', label: 'Officer Seal 3', page: '13' },
      { field: 'tickStaticPage12', top: '12%', left: '20%', label: 'âœ“', page: '12' },
      { field: 'tickStaticPage12_2', top: '12%', left: '25%', label: 'âœ“', page: '12' },
      // Page 15 (SBS Form)
      { field: 'accountNumber', top: '12%', left: '28%', label: 'Account No', page: '15' },
      { field: 'fullNameEn', top: '18.5%', left: '22%', label: 'Full Name (EN)', page: '15' },
      { field: 'fdrIfFullNameEn', top: '18.5%', left: '75%', label: 'FDR', page: '15' },
      { field: 'sectorCodeIfFullNameEn', top: '21%', left: '75%', label: 'Sector Code', page: '15' },
      { field: 'nineNineEightIfFullNameEn', top: '24%', left: '75%', label: '998', page: '15' },
      { field: 'orgNameEn', top: '6%', left: '10%', label: 'Organization Name (EN)', page: '15' },
      { field: 'fdrIfOrgNameEn', top: '6%', left: '75%', label: 'FDR', page: '15' },
      { field: 'sectorCodeIfOrgNameEn', top: '9%', left: '75%', label: 'Sector Code', page: '15' },
      { field: 'nineNineEightIfOrgNameEn', top: '12%', left: '75%', label: '998', page: '15' },
      { field: 'orgType', top: '24%', left: '10%', label: 'Type of Organization', page: '15' },
      { field: 'profession', top: '28%', left: '10%', label: 'Profession (In details)', page: '15' },
      { field: 'branchName', top: '4%', left: '10%', label: 'Branch Name', page: '15' }
    ]
  };

  // Seed default overlays from overlayConfig if there are no saved overlays for the type
  function seedDefaultOverlaysFromConfig(type) {
    try {
      const all = loadOverlayPositions();
      const existing = all[type] || [];
      const cfg = overlayConfig[type];
      if (!cfg || !cfg.length) return;
      
      // Always merge new configuration entries that don't exist in saved overlays
      const existingFields = new Set(existing.map(item => item.field + '_' + item.page));
      cfg.forEach(cfgEntry => {
        const key = cfgEntry.field + '_' + cfgEntry.page;
        if (!existingFields.has(key)) {
          existing.push({ 
            page: cfgEntry.page || '1', 
            field: cfgEntry.field, 
            leftPercent: parseFloat(cfgEntry.left) || 0, 
            topPercent: parseFloat(cfgEntry.top) || 0 
          });
        }
      });
      
      all[type] = existing;
      saveOverlayPositionsObject(all);
    } catch (e) {}
  }

  // Render overlays for the currently selected form type
  function renderOverlaysForCurrentType() {
    clearOverlays();
    const all = loadOverlayPositions();
    const type = getCurrentFormType();
    // Remove legacy single 'tenor' overlays from saved positions (migration)
    try {
      const list = all[type] || [];
      const filtered = list.filter(item => item.field !== 'tenor');
      if (filtered.length !== list.length) {
        all[type] = filtered;
        saveOverlayPositionsObject(all);
      }
    } catch (e) {}
    // if no saved overlays, seed defaults from overlayConfig
    seedDefaultOverlaysFromConfig(type);
    const list = (loadOverlayPositions())[type] || [];
    list.forEach(item => createOverlayElement(item));
    // Ensure account number and CIF overlays exist on page 1 (adds if missing)
    ensureAccountNumberAndCifOverlays(type);
    // Ensure organization information overlays exist on page 1 (adds if missing)
    ensureOrganizationOverlaysExist(type);
    // Ensure debitMyAccount overlay exists on page 4 (adds if missing)
    ensureDebitMyAccountOverlay(type);
    // Ensure second/third applicant overlays exist on pages 3 and 4
    ensureApplicantOverlays(type);
    // Ensure accountNumber1 overlay exists on page 7 (taqwa) for increased spacing
    ensureAccountNumber1OnPage7(type);
    // Ensure savingsLabel overlay exists on page 9 (others)
    ensureSavingsLabelOnPage9(type);
    // Ensure page 10 overlays exist (ticks and N/A for others)
    ensurePage10Overlays(type);
    // Ensure static tick on page 9 (others) always displays
    try {
      if (type === 'others') {
        setTickOverlay('tickStaticPage9', true);
        // Initialize page 10 ticks and N/A overlays
        setTickOverlay('tickPage10_1', true);
        setTickOverlay('tickPage10_2', true);
        setTickOverlay('tickPage10_3', true);
        setOverlayText('naPage10_1', 'N/A');
        setOverlayText('naPage10_2', 'N/A');
        // Initialize page 12 static ticks
        setTickOverlay('tickStaticPage12', true);
        setTickOverlay('tickStaticPage12_2', true);
      }
    } catch (e) {}
    // Update overlay text for second and third applicants from form values
    try {
      if (form.elements['secondApplicant']) setOverlayText('secondApplicant', form.elements['secondApplicant'].value || '');
      if (form.elements['thirdApplicant']) setOverlayText('thirdApplicant', form.elements['thirdApplicant'].value || '');
    } catch (e) {}
    // Initialize Customer's Avg Yearly Transaction ticks
    try {
      updateAvgYearlyTransactionTicks();
    } catch (e) {}
    // Initialize Credible Source of Funds ticks
    try {
      updateCredibleSourceOfFundsTicks();
    } catch (e) {}
    // Initialize KYC score fields
    try {
      updateKycScoreFields();
    } catch (e) {}
    // Initialize KYC total score
    try {
      updateKycTotalScore();
    } catch (e) {}
    // Initialize KYC total score ticks
    try {
      updateTotalScoreTicks();
    } catch (e) {}
    // Restore all tick overlays to their current state
    try { if (typeof updateMaturityTicks === 'function') updateMaturityTicks(); } catch (e) {}
    try { if (typeof updateModeTicks === 'function') updateModeTicks(); } catch (e) {}
    try { if (typeof updateGenderTicks === 'function') updateGenderTicks(); } catch (e) {}
    try { if (typeof updateOrgTypeTicks === 'function') updateOrgTypeTicks(); } catch (e) {}
    try { if (typeof updateBusinessTypeTicks === 'function') updateBusinessTypeTicks(); } catch (e) {}
    try { if (typeof updateNomineeIdTicks === 'function') updateNomineeIdTicks(); } catch (e) {}
    try { if (typeof updateIdentityIdTicks === 'function') updateIdentityIdTicks(); } catch (e) {}
    try { setTickOverlay('tickOne', true); } catch (e) {}
    try { setTickOverlay('tickTextbox', true); } catch (e) {}
    // Update todayDate overlays with page-specific formatting
    try {
      const now = new Date();
      const dd = String(now.getDate()).padStart(2, '0');
      const mm = String(now.getMonth() + 1).padStart(2, '0');
      const yyyy = now.getFullYear();
      const todayDateOverlays = document.querySelectorAll('.overlay[data-field="todayDate"]');
      todayDateOverlays.forEach(el => {
        const page = el.dataset.page;
        let displayDate;
        if (page === '9') {
          displayDate = dd + '-' + mm + '-' + yyyy;
        } else {
          displayDate = dd + '\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0' + mm + '\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0' + yyyy;
        }
        el.textContent = displayDate;
        el.style.display = '';
      });
    } catch (e) {}
  }
  
  // Ensure account number and CIF overlays on page 1
  function ensureAccountNumberAndCifOverlays(type) {
    const all = loadOverlayPositions();
    const list = all[type] || [];
    const hasAccountNo = list.some(item => item.page === '1' && item.field === 'accountNumber');
    const hasCif = list.some(item => item.page === '1' && item.field === 'cifNumber');

    let changed = false;
    if (!hasAccountNo) {
      const defaultOverlay = { page: '1', field: 'accountNumber', leftPercent: 10, topPercent: 10 };
      list.push(defaultOverlay);
      createOverlayElement(defaultOverlay);
      changed = true;
    }
    if (!hasCif) {
      const defaultCif = { page: '1', field: 'cifNumber', leftPercent: 10, topPercent: 20 };
      list.push(defaultCif);
      createOverlayElement(defaultCif);
      changed = true;
    }
    // branchName overlays are seeded from overlayConfig; no manual ensure needed to allow duplicates
    // ensure FDR product overlays (productName, interest rate, tenor)
    const hasProductName = list.some(item => item.page === '1' && item.field === 'productName');
    const hasProductInterest = list.some(item => item.page === '1' && item.field === 'productInterestRate');
    const hasTenorY = list.some(item => item.page === '1' && item.field === 'tenorYears');
    const hasTenorM = list.some(item => item.page === '1' && item.field === 'tenorMonths');
    const hasTenorD = list.some(item => item.page === '1' && item.field === 'tenorDays');
    if (!hasProductName) {
      const o = { page: '1', field: 'productName', leftPercent: 10, topPercent: 30 };
      list.push(o); createOverlayElement(o); changed = true;
    }
    if (!hasProductInterest) {
      const o = { page: '1', field: 'productInterestRate', leftPercent: 10, topPercent: 38 };
      list.push(o); createOverlayElement(o); changed = true;
    }
    if (!hasTenorY) {
      const o = { page: '1', field: 'tenorYears', leftPercent: 10, topPercent: 46 };
      list.push(o); createOverlayElement(o); changed = true;
    }
    if (!hasTenorM) {
      const o = { page: '1', field: 'tenorMonths', leftPercent: 20, topPercent: 46 };
      list.push(o); createOverlayElement(o); changed = true;
    }
    if (!hasTenorD) {
      const o = { page: '1', field: 'tenorDays', leftPercent: 30, topPercent: 46 };
      list.push(o); createOverlayElement(o); changed = true;
    }

    if (changed) {
      all[type] = list;
      saveOverlayPositionsObject(all);
    }
  }

  // Ensure debitMyAccount overlay exists on page 4
  function ensureDebitMyAccountOverlay(type) {
    try {
      const all = loadOverlayPositions();
      const list = all[type] || [];
      const hasDebit = list.some(item => item.page === '4' && item.field === 'debitMyAccount');
      if (!hasDebit) {
        const o = { page: '4', field: 'debitMyAccount', leftPercent: 35, topPercent: 39.5 };
        list.push(o);
        createOverlayElement(o);
        all[type] = list;
        saveOverlayPositionsObject(all);
      }
    } catch (e) {}
  }

  // Ensure secondApplicant and thirdApplicant overlays exist on pages 3 and 4
  function ensureApplicantOverlays(type) {
    try {
      const all = loadOverlayPositions();
      const list = all[type] || [];
      const needed = [
        { field: 'secondApplicant', page: '3', leftPercent: 35, topPercent: 41 },
        { field: 'thirdApplicant', page: '3', leftPercent: 35, topPercent: 43 },
        { field: 'secondApplicant', page: '4', leftPercent: 35, topPercent: 41 },
        { field: 'thirdApplicant', page: '4', leftPercent: 35, topPercent: 43 }
      ];
      let changed = false;
      needed.forEach(o => {
        const exists = list.some(item => String(item.page) === String(o.page) && item.field === o.field);
        if (!exists) {
          const newO = { page: String(o.page), field: o.field, leftPercent: o.leftPercent, topPercent: o.topPercent };
          list.push(newO);
          createOverlayElement(newO);
          changed = true;
        }
      });
      if (changed) {
        all[type] = list;
        saveOverlayPositionsObject(all);
      }
      // Initialize overlay text for applicants from form values
      try {
        if (form.elements['secondApplicant']) setOverlayText('secondApplicant', form.elements['secondApplicant'].value || '');
        if (form.elements['thirdApplicant']) setOverlayText('thirdApplicant', form.elements['thirdApplicant'].value || '');
      } catch (e) {}
    } catch (e) {}
  }

  // Ensure accountNumber1 overlay exists on page 7 (taqwa) with 1.90em spacing
  function ensureAccountNumber1OnPage7(type) {
    // Only for taqwa form (pages 5-8)
    if (type !== 'taqwa') return;
    try {
      const all = loadOverlayPositions();
      const list = all[type] || [];
      const hasAccountNumber1 = list.some(item => item.page === '7' && item.field === 'accountNumber1');
      if (!hasAccountNumber1) {
        const o = { page: '7', field: 'accountNumber1', leftPercent: 28, topPercent: 12 };
        list.push(o);
        createOverlayElement(o);
        all[type] = list;
        saveOverlayPositionsObject(all);
      }
    } catch (e) {}
  }

  // Ensure savingsLabel overlay exists on page 9 (others)
  function ensureSavingsLabelOnPage9(type) {
    // Only for others form (pages 9-13)
    if (type !== 'others') return;
    try {
      const all = loadOverlayPositions();
      const list = all[type] || [];
      const hasSavingsLabel = list.some(item => item.page === '9' && item.field === 'savingsLabel');
      if (!hasSavingsLabel) {
        const o = { page: '9', field: 'savingsLabel', leftPercent: 60, topPercent: 16, label: 'Savings' };
        list.push(o);
        createOverlayElement(o);
        all[type] = list;
        saveOverlayPositionsObject(all);
      } else {
        // Even if it exists, make sure the overlay element shows 'Savings'
        const overlay = document.querySelector(`.form-page[data-page="9"] .overlay[data-field="savingsLabel"]`);
        if (overlay) {
          overlay.textContent = 'Savings';
          overlay.style.display = '';
        }
      }
    } catch (e) {}
  }

  function ensurePage10Overlays(type) {
    // Only for others form (pages 9-13)
    if (type !== 'others') return;
    try {
      const all = loadOverlayPositions();
      const list = all[type] || [];
      const page10Fields = [
        { field: 'tickPage10_1', top: 50, left: 10, page: '10' },
        { field: 'tickPage10_2', top: 52, left: 10, page: '10' },
        { field: 'tickPage10_3', top: 54, left: 10, page: '10' },
        { field: 'naPage10_1', top: 56, left: 10, page: '10' },
        { field: 'naPage10_2', top: 58, left: 10, page: '10' },
        { field: 'kycClientBusiness_1', top: 60, left: 10, page: '10' },
        { field: 'kycClientBusiness_2', top: 60, left: 15, page: '10' },
        { field: 'kycClientBusiness_3', top: 60, left: 20, page: '10' },
        { field: 'kycClientBusiness_4', top: 60, left: 25, page: '10' },
        { field: 'kycClientBusiness_5', top: 60, left: 30, page: '10' },
        { field: 'kycClientBusiness_6', top: 62, left: 10, page: '10' },
        { field: 'kycClientBusiness_7', top: 62, left: 15, page: '10' },
        { field: 'kycClientBusiness_8', top: 62, left: 20, page: '10' },
        { field: 'kycClientBusiness_9', top: 62, left: 25, page: '10' },
        { field: 'kycClientBusiness_10', top: 62, left: 30, page: '10' },
        { field: 'kycClientBusiness_11', top: 64, left: 10, page: '10' },
        { field: 'kycClientBusiness_12', top: 64, left: 15, page: '10' },
        { field: 'kycClientBusiness_13', top: 64, left: 20, page: '10' },
        { field: 'kycClientBusiness_14', top: 64, left: 25, page: '10' },
        { field: 'kycClientBusiness_15', top: 64, left: 30, page: '10' },
        { field: 'kycClientBusiness_16', top: 66, left: 10, page: '10' },
        { field: 'kycClientBusiness_17', top: 66, left: 15, page: '10' },
        { field: 'kycClientBusiness_18', top: 66, left: 20, page: '10' },
        { field: 'kycClientBusiness_19', top: 66, left: 25, page: '10' },
        { field: 'kycClientBusiness_20', top: 66, left: 30, page: '10' },
        { field: 'kycClientBusiness_21', top: 10, left: 10, page: '11' },
        { field: 'kycClientBusiness_22', top: 10, left: 15, page: '11' },
        { field: 'kycClientBusiness_23', top: 10, left: 20, page: '11' },
        { field: 'kycClientBusiness_24', top: 10, left: 25, page: '11' },
        { field: 'kycClientBusiness_25', top: 10, left: 30, page: '11' },
        { field: 'kycClientBusiness_26', top: 12, left: 10, page: '11' },
        { field: 'kycClientBusiness_27', top: 12, left: 15, page: '11' },
        { field: 'kycClientBusiness_28', top: 12, left: 20, page: '11' },
        { field: 'kycClientBusiness_29', top: 12, left: 25, page: '11' },
        { field: 'kycClientBusiness_30', top: 12, left: 30, page: '11' },
        { field: 'kycClientBusiness_31', top: 14, left: 10, page: '11' },
        { field: 'kycClientBusiness_32', top: 14, left: 15, page: '11' },
        { field: 'kycClientBusiness_33', top: 14, left: 20, page: '11' },
        { field: 'kycClientBusiness_34', top: 14, left: 25, page: '11' },
        { field: 'kycClientBusiness_35', top: 14, left: 30, page: '11' },
        { field: 'kycClientBusiness_36', top: 16, left: 10, page: '11' },
        { field: 'kycClientBusiness_37', top: 16, left: 15, page: '11' },
        { field: 'kycClientBusiness_38', top: 16, left: 20, page: '11' },
        { field: 'kycClientBusiness_39', top: 16, left: 25, page: '11' },
        { field: 'kycClientBusiness_40', top: 16, left: 30, page: '11' },
        { field: 'kycClientBusiness_41', top: 18, left: 10, page: '11' },
        { field: 'kycClientBusiness_42', top: 18, left: 15, page: '11' },
        { field: 'kycClientBusiness_43', top: 18, left: 20, page: '11' },
        { field: 'kycClientBusiness_44', top: 18, left: 25, page: '11' },
        { field: 'kycClientBusiness_45', top: 18, left: 30, page: '11' },
        { field: 'kycClientBusiness_46', top: 20, left: 10, page: '11' },
        { field: 'kycClientBusiness_47', top: 20, left: 15, page: '11' },
        { field: 'kycClientBusiness_48', top: 20, left: 20, page: '11' },
        { field: 'kycClientBusiness_49', top: 20, left: 25, page: '11' },
        { field: 'kycClientBusiness_50', top: 20, left: 30, page: '11' },
        { field: 'kycClientBusiness_51', top: 22, left: 10, page: '11' },
        { field: 'kycClientBusiness_52', top: 22, left: 15, page: '11' },
        { field: 'kycClientBusiness_53', top: 22, left: 20, page: '11' },
        { field: 'kycClientProfession_1', top: 24, left: 10, page: '11' },
        { field: 'kycClientProfession_2', top: 24, left: 15, page: '11' },
        { field: 'kycClientProfession_3', top: 24, left: 20, page: '11' },
        { field: 'kycClientProfession_4', top: 24, left: 25, page: '11' },
        { field: 'kycClientProfession_5', top: 26, left: 10, page: '11' },
        { field: 'kycClientProfession_6', top: 26, left: 15, page: '11' },
        { field: 'kycClientProfession_7', top: 26, left: 20, page: '11' },
        { field: 'kycClientProfession_8', top: 26, left: 25, page: '11' },
        { field: 'kycClientProfession_9', top: 28, left: 10, page: '11' },
        { field: 'kycClientProfession_10', top: 28, left: 15, page: '11' },
        { field: 'kycClientProfession_11', top: 28, left: 20, page: '11' },
        { field: 'kycClientProfession_12', top: 28, left: 25, page: '11' },
        { field: 'kycClientProfession_13', top: 30, left: 10, page: '11' },
        { field: 'kycClientProfession_14', top: 30, left: 15, page: '11' },
        { field: 'kycClientProfession_15', top: 30, left: 20, page: '11' },
        { field: 'kycClientProfession_16', top: 30, left: 25, page: '11' },
        { field: 'kycClientProfession_17', top: 32, left: 10, page: '11' },
        { field: 'kycClientProfession_18', top: 32, left: 15, page: '11' },
        { field: 'kycClientProfession_19', top: 32, left: 20, page: '11' },
        { field: 'kycTypeOfOnboarding_1', top: 34, left: 10, page: '11' },
        { field: 'kycTypeOfOnboarding_2', top: 34, left: 15, page: '11' },
        { field: 'kycTypeOfOnboarding_3', top: 34, left: 20, page: '11' },
        { field: 'kycTypeOfOnboarding_4', top: 34, left: 25, page: '11' },
        { field: 'kycPepIpCeo_1', top: 36, left: 10, page: '11' },
        { field: 'kycPepIpCeo_2', top: 36, left: 15, page: '11' },
        { field: 'kycCloseAssociatePep_1', top: 10, left: 10, page: '12' },
        { field: 'kycCloseAssociatePep_2', top: 10, left: 15, page: '12' },
        { field: 'kycAvgYearlyTransaction_1', top: 14, left: 10, page: '12' },
        { field: 'kycAvgYearlyTransaction_2', top: 14, left: 15, page: '12' },
        { field: 'kycAvgYearlyTransaction_3', top: 14, left: 20, page: '12' },
        { field: 'kycAvgYearlyTransaction_4', top: 14, left: 25, page: '12' },
        { field: 'kycAvgYearlyTransaction_5', top: 16, left: 10, page: '12' },
        { field: 'kycAvgYearlyTransaction_6', top: 16, left: 15, page: '12' },
        { field: 'kycAvgYearlyTransaction_7', top: 16, left: 20, page: '12' },
        { field: 'kycAvgYearlyTransaction_8', top: 16, left: 25, page: '12' },
        { field: 'kycCredibleSourceOfFunds_1', top: 18, left: 10, page: '12' },
        { field: 'kycCredibleSourceOfFunds_2', top: 18, left: 15, page: '12' },
        { field: 'kycClientBusinessScore', top: 20, left: 10, page: '12' },
        { field: 'kycClientProfessionScore', top: 20, left: 30, page: '12' },
        { field: 'kycTotalScore', top: 22, left: 10, page: '13' },
        { field: 'kycTotalScore_1', top: 22, left: 15, page: '13' },
        { field: 'kycTotalScore_2', top: 22, left: 20, page: '13' },
        { field: 'kycRiskLevel', top: 24, left: 10, page: '13' },
        { field: 'officerSeal1', top: 85, left: 10, page: '13' },
        { field: 'officerSeal2', top: 85, left: 35, page: '13' },
        { field: 'officerSeal3', top: 85, left: 60, page: '13' },
        { field: 'tickStaticPage12', top: 12, left: 20, page: '12' },
        { field: 'tickStaticPage12_2', top: 12, left: 25, page: '12' }
      ];
      
      let changed = false;
      page10Fields.forEach(def => {
        const hasField = list.some(item => item.page === def.page && item.field === def.field);
        if (!hasField) {
          const o = { page: def.page, field: def.field, leftPercent: def.left, topPercent: def.top };
          list.push(o);
          createOverlayElement(o);
          changed = true;
        }
      });
      
      if (changed) {
        all[type] = list;
        saveOverlayPositionsObject(all);
      }
    } catch (e) {}
  }

  // Ensure organization information overlays appear on page 1
  function ensureOrganizationOverlaysExist(type) {
    const all = loadOverlayPositions();
    const list = all[type] || [];
    
    // Define organization fields for conventional (page 1) and taqwa (page 5)
    const basePage = (type === 'taqwa') ? '5' : '1';
    
    const orgFields = [
      { field: 'orgNameEn', top: 6, left: 10, page: basePage },
      { field: 'orgNameBn', top: 8, left: 10, page: basePage },
      { field: 'orgNameEn2', top: 20, left: 10, page: basePage },
      { field: 'orgNameBn2', top: 22, left: 10, page: basePage },
      { field: 'tradeLicenceNo', top: 10, left: 10, page: basePage },
      { field: 'tradeLicenceDate', top: 10, left: 40, page: basePage },
      { field: 'tradeLicenceAuthority', top: 12, left: 10, page: basePage },
      { field: 'registrationNo', top: 14, left: 10, page: basePage },
      { field: 'registrationDate', top: 14, left: 40, page: basePage },
      { field: 'registrationAuthority', top: 16, left: 10, page: basePage },
      { field: 'registeredAddress', top: 18, left: 10, page: basePage },
      { field: 'vatBin', top: 20, left: 10, page: basePage },
      { field: 'businessAddress', top: 22, left: 10, page: type === 'taqwa' ? '6' : '2' },
      { field: 'businessNature', top: 24, left: 10, page: type === 'taqwa' ? '6' : '2' },
      { field: 'annualTurnover', top: 26, left: 10, page: type === 'taqwa' ? '6' : '2' },
      { field: 'orgTypeOther', top: 32, left: 62, page: type === 'taqwa' ? '6' : '2' },
      { field: 'businessTypeOther', top: 18, left: 68, page: type === 'taqwa' ? '6' : '2' }
    ];
    
    let changed = false;
    orgFields.forEach(def => {
      const targetPage = String(def.page);
      const exists = list.some(item => String(item.page) === targetPage && item.field === def.field);
      if (!exists) {
        const overlay = { page: targetPage, field: def.field, leftPercent: def.left, topPercent: def.top };
        list.push(overlay);
        createOverlayElement(overlay);
        changed = true;
      }
    });
    
    if (changed) {
      all[type] = list;
      saveOverlayPositionsObject(all);
    }
  }
  function savePositionsForCurrentType() {
    const type = getCurrentFormType();
    const obj = loadOverlayPositions();
    obj[type] = [];
    document.querySelectorAll('.form-page').forEach(pageEl => {
      const page = pageEl.getAttribute('data-page');
      pageEl.querySelectorAll('.overlay').forEach(ov => {
        const field = ov.getAttribute('data-field') || ov.textContent;
        obj[type].push({
          page: page,
          field: field,
          leftPercent: parseFloat(ov.style.left) || 0,
          topPercent: parseFloat(ov.style.top) || 0
        });
      });
    });
    saveOverlayPositionsObject(obj);
    showToast('Positions saved for "' + type + '"!');
  }

  savePositionsBtn.addEventListener('click', function() {
    savePositionsForCurrentType();
  });

  // Force rebuild overlay positions to ensure duplicate branchName entries exist
  // Clear saved positions for both form types to force re-seed from config
  // Ensure storage version; clears persisted editor data if version mismatch
  try { ensureStorageVersion(); } catch (e) {}
  // Clear form data on app open/refresh - start fresh each time, but preserve branchName
  try {
    const savedData = JSON.parse(localStorage.getItem(FORM_KEY) || '{}');
    const preservedBranchName = savedData.branchName || '';
    localStorage.removeItem(FORM_KEY);
    // Restore branchName if it was saved
    if (preservedBranchName) {
      localStorage.setItem(FORM_KEY, JSON.stringify({ branchName: preservedBranchName }));
    }
  } catch (e) {
    try { localStorage.removeItem(FORM_KEY); } catch (e2) {}
  }
  try {
    const all = loadOverlayPositions();
    ['conventional', 'taqwa'].forEach(type => {
      const cfg = overlayConfig[type];
      if (cfg && cfg.length) {
        const branchEntriesInConfig = cfg.filter(item => item.field === 'branchName').length;
        const branchEntriesInSaved = (all[type] || []).filter(item => item.field === 'branchName').length;
        // if config has more branch entries than saved, rebuild from config
        if (branchEntriesInConfig > branchEntriesInSaved) {
          delete all[type];
        }
      }
    });
    localStorage.setItem(OVERLAY_KEY, JSON.stringify(all));
  } catch (e) {}

  // Initialize overlays on load
  renderOverlaysForCurrentType();
  // Load preserved branchName from localStorage
  try { loadFormData(); } catch (e) {}
  // Refresh overlays with loaded form data
  try { updateOverlays(); } catch (e) {}
  try { updateOrgTypeTicks(); } catch (e) {}
  try { updateBusinessTypeTicks(); } catch (e) {}
  try { updateGenderTicks(); } catch (e) {}
  try { setTickOverlay('tickOne', true); } catch (e) {}
  try { setTickOverlay('tickSameAsLinkedAccountPersonal', (form.elements['sameAsLinkedAccountPersonal'] && form.elements['sameAsLinkedAccountPersonal'].checked)); } catch (e) {}
  try { setTickOverlay('tickSameAsLinkedAccountNominee', (form.elements['sameAsLinkedAccountNominee'] && form.elements['sameAsLinkedAccountNominee'].checked)); } catch (e) {}
  try {
    if (form.elements['sameAsLinkedAccountPersonal'] && form.elements['sameAsLinkedAccountPersonal'].checked) {
      const debitVal = (form.elements['debitMyAccount'] && form.elements['debitMyAccount'].value) ? form.elements['debitMyAccount'].value : '';
      setOverlayText('sameAsLinkedAccountPersonalNote', 'Same as Link Account: ' + debitVal);
    }
    // apply initial hide/show for sections based on checkbox state on load
    try { toggleSectionsForSameAsPersonal(form.elements['sameAsLinkedAccountPersonal'] && form.elements['sameAsLinkedAccountPersonal'].checked); } catch (e) {}
    try { toggleNomineeSection(form.elements['sameAsLinkedAccountNominee'] && form.elements['sameAsLinkedAccountNominee'].checked); } catch (e) {}
  } catch (e) {}
  try {
    if (form.elements['sameAsLinkedAccountNominee'] && form.elements['sameAsLinkedAccountNominee'].checked) {
      const debitVal = (form.elements['debitMyAccount'] && form.elements['debitMyAccount'].value) ? form.elements['debitMyAccount'].value : '';
      setOverlayText('sameAsLinkedAccountNomineeNote', 'Same as Link Account: ' + debitVal);
    }
  } catch (e) {}

  // Update tick overlays based on the selected maturity instruction
  function updateMaturityTicks() {
    try {
      const sel = form.elements['maturityInstruction'];
      const val = sel ? sel.value : '';
      setTickOverlay('tickRenewBoth', val === 'RenewBoth');
      setTickOverlay('tickRenewPrincipal', val === 'RenewPrincipal');
      // show credit interest field only when 'RenewPrincipal' is selected
      try {
        const creditWrap = document.getElementById('creditInterestField');
        if (creditWrap) creditWrap.style.display = (val === 'RenewPrincipal') ? 'block' : 'none';
      } catch (e) {}
    } catch (e) {}
  }

  // Update tick overlays for Mode of Operation (Single/Joint)
  function updateModeTicks() {
    try {
      const sel = form.elements['modeOfOperation'];
      const val = sel ? sel.value : '';
      setTickOverlay('tickModeSingle', val === 'Single');
      setTickOverlay('tickModeJoint', val === 'Joint');
    } catch (e) {}
  }

  // Update tick overlays for Gender selection
  function updateGenderTicks() {
    try {
      const sel = form.elements['gender'];
      const val = sel ? sel.value : '';
      setTickOverlay('tickGender_Male', val === 'Male');
      setTickOverlay('tickGender_Female', val === 'Female');
      setTickOverlay('tickGender_Third', val === 'Third');
    } catch (e) {}
  }

  // Wire change listener to maturity instruction select
  const maturitySelect = form.elements['maturityInstruction'];
  if (maturitySelect) {
    maturitySelect.addEventListener('change', function() {
      updateMaturityTicks();
      saveFormData();
    });
    // set initial state from loaded form data
    updateMaturityTicks();
  }

  // Wire change listener to Mode of Operation select
  const modeSelect = form.elements['modeOfOperation'];
  if (modeSelect) {
    function updateModeApplicantFields() {
      try {
        const val = modeSelect.value || '';
        const sField = document.getElementById('secondApplicantField');
        const tField = document.getElementById('thirdApplicantField');
        const jHeader = document.getElementById('jointAccountHeader');
        if (sField && tField) {
          if (val === 'Joint') {
            sField.style.display = 'block';
            tField.style.display = 'block';
            if (jHeader) jHeader.style.display = 'flex';
          } else {
            sField.style.display = 'none';
            tField.style.display = 'none';
            if (jHeader) jHeader.style.display = 'none';
            // clear any values when hidden
            try { if (form.elements['secondApplicant']) { form.elements['secondApplicant'].value = ''; setOverlayText('secondApplicant',''); } } catch (e) {}
            try { if (form.elements['thirdApplicant']) { form.elements['thirdApplicant'].value = ''; setOverlayText('thirdApplicant',''); } } catch (e) {}
          }
        }
      } catch (e) {}
    }
    modeSelect.addEventListener('change', function() {
      updateModeTicks();
      updateModeApplicantFields();
      saveFormData();
    });
    // set initial state from loaded form data
    updateModeTicks();
    updateModeApplicantFields();
  }

  // Keep account number overlays in sync with the information input
  const accountNumberInput = form.elements['accountNumber'];
  if (accountNumberInput) {
    accountNumberInput.addEventListener('input', function() {
      const val = accountNumberInput.value || '';
      setOverlayText('accountNumber', val);
      
      // Toggle visibility based on 4th digit
      const fourthDigit = val.length > 3 ? val[3] : '';
      const orgSection = document.getElementById('organization-info');
      const indSection = document.getElementById('depositor-info');
      
      // Get fullNameEn and fullNameBn fields
      const fullNameEnField = form.elements['fullNameEn'];
      const fullNameBnField = form.elements['fullNameBn'];
      
      if (fourthDigit === '3') {
        // Show Individual Information, hide Organization Information
        if (orgSection) orgSection.style.display = 'none';
        if (indSection) indSection.style.display = 'block';
        // Show fullNameEn and fullNameBn
        if (fullNameEnField && fullNameEnField.parentElement) fullNameEnField.parentElement.style.display = 'block';
        if (fullNameBnField && fullNameBnField.parentElement) fullNameBnField.parentElement.style.display = 'block';
      } else if (fourthDigit === '2' || fourthDigit === '1') {
        // Show Organization Information, hide Individual Information
        if (orgSection) orgSection.style.display = 'block';
        if (indSection) indSection.style.display = 'none';
        // Hide fullNameEn and fullNameBn
        if (fullNameEnField && fullNameEnField.parentElement) fullNameEnField.parentElement.style.display = 'none';
        if (fullNameBnField && fullNameBnField.parentElement) fullNameBnField.parentElement.style.display = 'none';
      } else {
        // Default: show both
        if (orgSection) orgSection.style.display = 'block';
        if (indSection) indSection.style.display = 'block';
        // Show fullNameEn and fullNameBn
        if (fullNameEnField && fullNameEnField.parentElement) fullNameEnField.parentElement.style.display = 'block';
        if (fullNameBnField && fullNameBnField.parentElement) fullNameBnField.parentElement.style.display = 'block';
      }
      
      // Show/hide 'Same as Link Account' overlay based on 4th digit and checkbox state
      const isChecked = (sameAsLinkedAccountPersonal && sameAsLinkedAccountPersonal.checked);
      const debitVal = (form.elements['debitMyAccount'] && form.elements['debitMyAccount'].value) ? form.elements['debitMyAccount'].value : '';
      const overlayText = isChecked && val ? 'Same as Link Account: ' + debitVal : '';
      
      if (!val) {
        // Hide on both pages if account number is blank
        document.querySelectorAll('.overlay[data-field="sameAsLinkedAccountPersonalNote"]').forEach(ov => {
          ov.style.display = 'none';
          ov.textContent = '';
        });
      } else if (fourthDigit === '3') {
        // Show only on page 2
        document.querySelectorAll('.overlay[data-field="sameAsLinkedAccountPersonalNote"]').forEach(ov => {
          const page = ov.parentElement.getAttribute('data-page');
          if (page === '2') {
            ov.style.display = isChecked ? 'block' : 'none';
            ov.textContent = overlayText;
          } else {
            ov.style.display = 'none';
            ov.textContent = '';
          }
        });
      } else if (fourthDigit === '1' || fourthDigit === '2') {
        // Show only on page 1
        document.querySelectorAll('.overlay[data-field="sameAsLinkedAccountPersonalNote"]').forEach(ov => {
          const page = ov.parentElement.getAttribute('data-page');
          if (page === '1') {
            ov.style.display = isChecked ? 'block' : 'none';
            ov.textContent = overlayText;
          } else {
            ov.style.display = 'none';
            ov.textContent = '';
          }
        });
      } else {
        // Hide on both pages for any other 4th digit
        document.querySelectorAll('.overlay[data-field="sameAsLinkedAccountPersonalNote"]').forEach(ov => {
          ov.style.display = 'none';
          ov.textContent = '';
        });
      }
    });
  }
  // Keep interest account number overlays in sync with the interestAccountNumber input
  const interestAccountInput = form.elements['interestAccountNumber'];
  if (interestAccountInput) {
    interestAccountInput.addEventListener('input', function() {
      const val = interestAccountInput.value || '';
      setOverlayText('interestAccountNumber', val);
    });
  }
  // Keep DPS scheme & duration overlays in sync with popup inputs
  const dpsSchemeInput = document.getElementById('dpsSchemeName');
  const dpsYearsInput = document.getElementById('dpsYears');
  if (dpsSchemeInput) {
    dpsSchemeInput.addEventListener('input', function() {
      const v = dpsSchemeInput.value || '';
      setHiddenInput('schemeName', v);
      saveFormData();
      try { renderOverlaysForCurrentType(); } catch (e) {}
    });
  }
  if (dpsYearsInput) {
    dpsYearsInput.addEventListener('input', function() {
      const v = dpsYearsInput.value || '';
      setHiddenInput('dpsYears', v);
      saveFormData();
      try { renderOverlaysForCurrentType(); } catch (e) {}
    });
  }
  // Keep branch name overlays in sync with the branch name input
  // Branch name input removed from slide menu; branch overlays intentionally ignored
  // Keep CIF overlays in sync with the CIF input
  const cifInput = form.elements['cifNumber'];
  if (cifInput) {
    cifInput.addEventListener('input', function() {
      const val = cifInput.value || '';
      setOverlayText('cifNumber', val);
    });
  }
  // Sync depositAmount into amountFDR/amountDPS hidden fields depending on selected account type
  const depositAmountInput = form.elements['depositAmount'];
  if (depositAmountInput) {
    depositAmountInput.addEventListener('input', function() {
      const val = depositAmountInput.value || '';
      const acct = mainAccountType ? mainAccountType.value : (form.elements['accountType'] ? form.elements['accountType'].value : '');
      if (acct === 'FDR') {
        setHiddenInput('amountFDR', val);
        setOverlayText('amountFDR', val);
        // update in-words
        try {
          const words = numberToWords(val);
          setHiddenInput('amountFDRInWords', words);
          setOverlayText('amountFDRInWords', words);
        } catch (e) {}
      } else if (acct === 'DPS') {
        setHiddenInput('amountDPS', val);
        setOverlayText('amountDPS', val);
        // update in-words
        try {
          const words = numberToWords(val);
          setHiddenInput('amountDPSInWords', words);
          setOverlayText('amountDPSInWords', words);
        } catch (e) {}
      }
      saveFormData();
    });
  }
  // Keep FDR overlays in sync with hidden inputs
  function updateFdrOverlayValues() {
    const pn = form.elements['productName'] ? form.elements['productName'].value : '';
    const ir = form.elements['productInterestRate'] ? form.elements['productInterestRate'].value : '';
    const y = form.elements['tenorYears'] ? form.elements['tenorYears'].value : '';
    const m = form.elements['tenorMonths'] ? form.elements['tenorMonths'].value : '';
    const d = form.elements['tenorDays'] ? form.elements['tenorDays'].value : '';
    const yText = y || '';
    const mText = m || '';
    const dText = d || '';
    const irText = ir ? (ir + '%') : '';

    // Get current account type
    const acct = mainAccountType ? mainAccountType.value : (form.elements['accountType'] ? form.elements['accountType'].value : '');

    // Product name, interest rate, and tenor fields are only for FDR - hide if DPS is selected
    if (acct === 'DPS') {
      setOverlayText('productName', '');
      setOverlayText('productInterestRate', '');
      setOverlayText('tenorYears', '');
      setOverlayText('tenorMonths', '');
      setOverlayText('tenorDays', '');
    } else {
      setOverlayText('productName', pn);
      setOverlayText('productInterestRate', irText);
      setOverlayText('tenorYears', yText);
      setOverlayText('tenorMonths', mText);
      setOverlayText('tenorDays', dText);
    }
  }

  // update FDR overlays on hidden field changes when those exist
  ['productName','productInterestRate','tenorYears','tenorMonths','tenorDays'].forEach(name => {
    const el = form.elements[name];
    if (el) el.addEventListener('input', updateFdrOverlayValues);
  });

  // Aggregate Present Address into hidden `presentAddress` and update overlay
  function aggregatePresentAddress() {
    try {
      // Format: House/Holding No., Area/Village, Post Office- Post Code, District
      const house = (form.elements['presentHouse'] && form.elements['presentHouse'].value) ? form.elements['presentHouse'].value.trim() : '';
      const area = (form.elements['presentArea'] && form.elements['presentArea'].value) ? form.elements['presentArea'].value.trim() : '';
      const postOffice = (form.elements['presentPostOffice'] && form.elements['presentPostOffice'].value) ? form.elements['presentPostOffice'].value.trim() : '';
      const postCode = (form.elements['presentPostCode'] && form.elements['presentPostCode'].value) ? form.elements['presentPostCode'].value.trim() : '';
      const district = (form.elements['presentDistrict'] && form.elements['presentDistrict'].value) ? form.elements['presentDistrict'].value.trim() : '';

      const parts = [];
      if (house) parts.push(house);
      if (area) parts.push(area);
      if (postOffice) {
        const po = postCode ? (postOffice + ' - ' + postCode) : postOffice;
        parts.push(po);
      } else if (postCode) {
        parts.push(postCode);
      }
      if (district) parts.push(district);

      const agg = parts.join(', ');
      // Save present address without country
      setHiddenInput('presentAddress', agg);
      setOverlayText('presentAddress', agg);
    } catch (e) {}
  }

  // Aggregate Permanent Address into hidden `permanentAddress` and update overlay
  function aggregatePermanentAddress() {
    try {
      const parts = [];
      const keys = ['permanentHouse','permanentArea','permanentPostOffice','permanentPostCode','permanentThana','permanentDistrict','permanentCountry'];
      keys.forEach(k => {
        const el = form.elements[k];
        if (el && el.value && el.value.trim()) parts.push(el.value.trim());
      });
      const agg = parts.join(', ');
      setHiddenInput('permanentAddress', agg);
      setOverlayText('permanentAddress', agg);
    } catch (e) {}
  }

  // Wire present address subfields
  ['presentHouse','presentArea','presentPostOffice','presentPostCode','presentThana','presentDistrict','presentCountry'].forEach(name => {
    const el = form.elements[name];
    if (el) el.addEventListener('input', aggregatePresentAddress);
  });

  // Wire permanent address subfields
  ['permanentHouse','permanentArea','permanentPostOffice','permanentPostCode','permanentThana','permanentDistrict','permanentCountry'].forEach(name => {
    const el = form.elements[name];
    if (el) el.addEventListener('input', aggregatePermanentAddress);
  });

  // Wire nominee-related inputs so overlays update live
  (function wireNomineeFields() {
    const nomineeNames = ['nomineeName','nomineeRelation','nomineeDob','nomineeShare','nomineeIdentityDocumentNumber','nomineeAddress','nomineePhone','nomineeEmail','rmCode','debitMyAccount','secondApplicant','thirdApplicant'];
    nomineeNames.forEach(name => {
      try {
        const el = form.elements[name];
        if (!el) return;
        el.addEventListener('input', function() {
          setOverlayText(name, el.value || '');
          saveFormData();
        });
        // initialize overlay from current value
        setOverlayText(name, (el.value || ''));
      } catch (e) { /* ignore missing fields */ }
    });

    // nominee ID type select should update its overlay and the tick overlays
    try {
      const sel = form.elements['nomineeIdentityDocumentType'];
      if (sel) {
        sel.addEventListener('change', function() {
          // set overlay to the selected value (use value code)
          setOverlayText('nomineeIdentityDocumentType', sel.value || '');
          try { updateNomineeIdTicks(); } catch (e) {}
          saveFormData();
        });
        // initialize
        setOverlayText('nomineeIdentityDocumentType', sel.value || '');
      }
    } catch (e) {}
  })();

  // Same as Present Address checkbox behavior
  const sameAsPresentCheckbox = document.getElementById('sameAsPresent');
  if (sameAsPresentCheckbox) {
    sameAsPresentCheckbox.addEventListener('change', function() {
      const checked = sameAsPresentCheckbox.checked;
      const permFields = ['permanentHouse','permanentArea','permanentPostOffice','permanentPostCode','permanentThana','permanentDistrict','permanentCountry'];
      if (checked) {
        // copy values and disable
        permFields.forEach(k => {
          const p = form.elements[k];
          const q = form.elements[k.replace('permanent','present')];
          if (p && q) { p.value = q.value || ''; p.setAttribute('disabled','disabled'); setOverlayText(k, p.value || ''); }
        });
        aggregatePermanentAddress();
      } else {
        // enable and clear
        permFields.forEach(k => {
          const p = form.elements[k];
          if (p) { p.removeAttribute('disabled'); }
        });
        aggregatePermanentAddress();
      }
    });
    // initialize if checked on load
    if (sameAsPresentCheckbox.checked) sameAsPresentCheckbox.dispatchEvent(new Event('change'));
  }

  // Update organization and address field overlays on input
  ['fullNameEn','fullNameBn','fatherName','motherName','spouseName','dateOfBirth','nationality','gender','profession','probableMonthlyIncome','sourceOfFund','eTinIndividual','identityDocumentType','identityDocumentNumber',
   'presentAddress','permanentAddress',
   'presentHouse','presentArea','presentPostOffice','presentPostCode','presentThana','presentDistrict','presentCountry',
   'permanentHouse','permanentArea','permanentPostOffice','permanentPostCode','permanentThana','permanentDistrict','permanentCountry',
   'orgNameEn', 'orgNameBn', 'tradeLicenceNo', 'tradeLicenceDate', 'tradeLicenceAuthority',
   'registrationNo', 'registrationDate', 'registrationAuthority', 'registeredAddress',
   'vatBin', 'businessAddress', 'businessNature', 'annualTurnover', 'eTin', 'orgTypeOther', 'businessTypeOther'].forEach(name => {
    const el = form.elements[name];
    if (el) {
      el.addEventListener('input', function() {
        const val = el.value || '';
        setOverlayText(name, val);
      });
    }
  });

  // Left Slide Menu Toggle Logic
  const slideMenuToggle = document.getElementById('slideMenuToggle');
  const slideMenu = document.getElementById('slideMenu');
  const slideMenuBackdrop = document.getElementById('slideMenuBackdrop');
  const slideMenuClose = document.getElementById('slideMenuClose');

  function openSlideMenu() {
    if (!slideMenu) return;
    slideMenu.classList.add('open');
    if (slideMenuBackdrop) slideMenuBackdrop.classList.add('show');
  }
  function closeSlideMenu() {
    if (!slideMenu) return;
    slideMenu.classList.remove('open');
    if (slideMenuBackdrop) slideMenuBackdrop.classList.remove('show');
  }

  if (slideMenuToggle) slideMenuToggle.addEventListener('click', openSlideMenu);
  if (slideMenuClose) slideMenuClose.addEventListener('click', closeSlideMenu);
  // Backdrop click disabled - menu won't close when clicking outside

  // Account Type popup wiring
  const slideMenuAccountType = document.getElementById('slideMenuAccountType');
  const accountTypeBackdrop = document.getElementById('accountTypeBackdrop');
  const accountTypeClose = document.getElementById('accountTypeClose');
  const accountTypeSaveBtn = document.getElementById('accountTypeSaveBtn');
  const accountTypeCancelBtn = document.getElementById('accountTypeCancelBtn');
  const accountTypeSelectPopup = document.getElementById('accountTypeSelectPopup');
  const fdrFields = document.getElementById('fdrFields');
  const fdrProductName = document.getElementById('fdrProductName');
  const fdrInterestRate = document.getElementById('fdrInterestRate');
  const fdrTenorYears = document.getElementById('fdrTenorYears');
  const fdrTenorMonths = document.getElementById('fdrTenorMonths');
  const fdrTenorDays = document.getElementById('fdrTenorDays');
  const dpsFields = document.getElementById('dpsFields');
  const dpsSchemeName = document.getElementById('dpsSchemeName');
  const dpsYears = document.getElementById('dpsYears');
  // installment input removed per request

  function openAccountTypePopup() {
    if (!accountTypeBackdrop) return;
    accountTypeBackdrop.classList.add('show');
    // set current value
    const mainSelect = form.elements['accountType'];
    if (mainSelect && accountTypeSelectPopup) accountTypeSelectPopup.value = mainSelect.value || '';
    // show/hide FDR/DPS fields based on current value
    if (accountTypeSelectPopup) {
      if (fdrFields) fdrFields.style.display = (accountTypeSelectPopup.value === 'FDR') ? 'block' : 'none';
      if (dpsFields) dpsFields.style.display = (accountTypeSelectPopup.value === 'DPS') ? 'block' : 'none';
      // prefill DPS/FDR extras from existing hidden inputs if present
      if (accountTypeSelectPopup.value === 'FDR') {
        if (fdrProductName && form.elements['productName']) fdrProductName.value = form.elements['productName'].value || '';
        // productAmount removed; no prefill for amount
        if (fdrInterestRate && form.elements['productInterestRate']) fdrInterestRate.value = form.elements['productInterestRate'].value || '';
        if (fdrTenorYears && form.elements['tenorYears']) fdrTenorYears.value = form.elements['tenorYears'].value || '';
        if (fdrTenorMonths && form.elements['tenorMonths']) fdrTenorMonths.value = form.elements['tenorMonths'].value || '';
        if (fdrTenorDays && form.elements['tenorDays']) fdrTenorDays.value = form.elements['tenorDays'].value || '';
      } else if (accountTypeSelectPopup.value === 'DPS') {
        if (dpsSchemeName && form.elements['schemeName']) dpsSchemeName.value = form.elements['schemeName'].value || '';
        if (dpsYears && form.elements['dpsYears']) dpsYears.value = form.elements['dpsYears'].value || '';
        // installmentAmount removed; no prefill
      }
    }
    // Render presets list on the right side
    renderPresets();
  }
  function closeAccountTypePopup() {
    if (!accountTypeBackdrop) return;
    accountTypeBackdrop.classList.remove('show');
  }

  if (slideMenuAccountType) slideMenuAccountType.addEventListener('click', function(e){ e.preventDefault(); openAccountTypePopup(); closeSlideMenu(); });
  if (accountTypeClose) accountTypeClose.addEventListener('click', closeAccountTypePopup);
  if (accountTypeCancelBtn) accountTypeCancelBtn.addEventListener('click', closeAccountTypePopup);
  // Backdrop click disabled - popup won't close when clicking outside
  // Show FDR fields when selected
  if (accountTypeSelectPopup) {
    accountTypeSelectPopup.addEventListener('change', function() {
      if (fdrFields) fdrFields.style.display = (this.value === 'FDR') ? 'block' : 'none';
      if (dpsFields) dpsFields.style.display = (this.value === 'DPS') ? 'block' : 'none';
    });
  }

  // helper to set hidden input on main form
  function setHiddenInput(name, value) {
    let el = form.elements[name];
    if (!el) {
      el = document.createElement('input');
      el.type = 'hidden';
      el.name = name;
      form.appendChild(el);
    }
    el.value = value;
  }

  // Format date string into DDMMYYYY (no separators) for overlay display
  function formatDateForOverlay(s) {
    if (!s) return s;
    s = String(s).trim();
    let m;
    // ISO YYYY-MM-DD
    m = s.match(/^(\d{4})-(\d{2})-(\d{2})$/);
    if (m) return m[3] + m[2] + m[1];
    // DD-MM-YYYY
    m = s.match(/^(\d{2})-(\d{2})-(\d{4})$/);
    if (m) return m[1] + m[2] + m[3];
    // YYYY/MM/DD
    m = s.match(/^(\d{4})\/(\d{2})\/(\d{2})$/);
    if (m) return m[3] + m[2] + m[1];
    // DD/MM/YYYY
    m = s.match(/^(\d{2})\/(\d{2})\/(\d{4})$/);
    if (m) return m[1] + m[2] + m[3];
    // Try Date parse
    const d = new Date(s);
    if (!isNaN(d.getTime())) {
      const dd = String(d.getDate()).padStart(2, '0');
      const mm = String(d.getMonth() + 1).padStart(2, '0');
      const yyyy = d.getFullYear();
      return dd + mm + yyyy;
    }
    // Fallback: remove non-digits
    const digits = s.replace(/\D/g, '');
    return digits;
  }

  // Convert number string to words using lac/crore style and append currency 'Taka' (supports paise)
  function numberToWords(input) {
    if (input == null) return '';
    let s = String(input).trim();
    if (!s) return '';
    // remove commas and non-numeric except dot and minus
    s = s.replace(/[,\s]/g, '');
    // handle negative
    let negative = false;
    if (s.startsWith('-')) { negative = true; s = s.slice(1); }
    if (!s) return '';

    const parts = s.split('.');
    const intPart = parts[0] || '0';
    const fracPart = parts[1] || '';
    if (!/^[0-9]+$/.test(intPart)) return input;

    const n = parseInt(intPart, 10);
    if (isNaN(n)) return input;
    if (n === 0 && (!fracPart || Number(fracPart) === 0)) return 'Zero Taka';

    const ones = ['','One','Two','Three','Four','Five','Six','Seven','Eight','Nine'];
    const teens = ['Ten','Eleven','Twelve','Thirteen','Fourteen','Fifteen','Sixteen','Seventeen','Eighteen','Nineteen'];
    const tens = ['','','Twenty','Thirty','Forty','Fifty','Sixty','Seventy','Eighty','Ninety'];

    function twoDigitsToWords(num) {
      if (num < 10) return ones[num];
      if (num < 20) return teens[num - 10];
      const t = Math.floor(num / 10);
      const o = num % 10;
      return tens[t] + (o ? ' ' + ones[o] : '');
    }

    function threeDigitsToWords(num) {
      let str = '';
      const h = Math.floor(num / 100);
      const rem = num % 100;
      if (h) str += ones[h] + ' Hundred';
      if (rem) {
        if (str) str += ' ';
        str += twoDigitsToWords(rem);
      }
      return str;
    }

    // Indian numbering groups: crore (10^7), lakh (10^5), thousand (10^3), hundred
    const crore = Math.floor(n / 10000000);
    const lakh = Math.floor((n % 10000000) / 100000);
    const thousand = Math.floor((n % 100000) / 1000);
    const hundredRest = n % 1000;

    const partsWords = [];
    if (crore) partsWords.push(threeDigitsToWords(crore) + ' Crore');
    if (lakh) partsWords.push(threeDigitsToWords(lakh) + ' Lac');
    if (thousand) partsWords.push(threeDigitsToWords(thousand) + ' Thousand');
    if (hundredRest) partsWords.push(threeDigitsToWords(hundredRest));

    let result = partsWords.join(' ').replace(/\s+/g,' ').trim();
    if (!result) result = 'Zero';
    result = result + ' Taka';

    // handle paise (two decimal digits)
    if (fracPart) {
      const paiseNum = Math.round((parseFloat('0.' + fracPart) * 100));
      if (!isNaN(paiseNum) && paiseNum > 0) {
        const paiseWords = paiseNum < 100 ? twoDigitsToWords(paiseNum) : threeDigitsToWords(paiseNum);
        result += ' and ' + paiseWords + ' Paisa';
      }
    }

    if (negative) result = 'Minus ' + result;
    // append 'only' to match currency wording
    return result + ' only';
  }

  // Branch name quick input (slide menu) - keep form in sync and update overlays
  const slideBranchInput = document.getElementById('slideBranchInput');
  if (slideBranchInput) {
    // Initialize from BRANCH_KEY on load
    try {
      const savedBranch = localStorage.getItem(BRANCH_KEY);
      if (savedBranch && (!slideBranchInput.value || slideBranchInput.value.trim() === '')) {
        slideBranchInput.value = savedBranch;
        setHiddenInput('branchName', savedBranch);
        try { setOverlayText('branchName', savedBranch); } catch (e) {}
      }
    } catch (e) {}

    slideBranchInput.addEventListener('input', function() {
      const val = slideBranchInput.value || '';
      // ensure value exists in the main form as hidden input
      setHiddenInput('branchName', val);
      // persist branch name separately so it survives form clears
      try { localStorage.setItem(BRANCH_KEY, val); } catch (e) {}
      // persist form data
      saveFormData();
      // update any overlays (if present)
      try { setOverlayText('branchName', val); } catch (e) {}
    });
  }

  if (accountTypeSaveBtn) accountTypeSaveBtn.addEventListener('click', function(){
    const val = accountTypeSelectPopup ? accountTypeSelectPopup.value : '';
    if (form && form.elements['accountType']) {
      form.elements['accountType'].value = val;
      if (mainAccountType) mainAccountType.value = val;
      // if FDR, copy extra fields into hidden inputs
      if (val === 'FDR') {
        setHiddenInput('productName', fdrProductName ? fdrProductName.value : '');
        // productAmount removed; do not save
        setHiddenInput('productInterestRate', fdrInterestRate ? fdrInterestRate.value : '');
        setHiddenInput('tenorYears', fdrTenorYears ? fdrTenorYears.value : '');
        setHiddenInput('tenorMonths', fdrTenorMonths ? fdrTenorMonths.value : '');
        setHiddenInput('tenorDays', fdrTenorDays ? fdrTenorDays.value : '');
        // clear DPS hidden fields
        ['schemeName','dpsYears'].forEach(n => { if (form.elements[n]) form.elements[n].value = ''; });
      } else if (val === 'DPS') {
        // Save DPS extra fields
        setHiddenInput('schemeName', dpsSchemeName ? dpsSchemeName.value : '');
        setHiddenInput('dpsYears', dpsYears ? dpsYears.value : '');
        // installmentAmount removed; do not save
        // clear FDR hidden fields
        ['productName','productInterestRate','tenorYears','tenorMonths','tenorDays'].forEach(n => { if (form.elements[n]) form.elements[n].value = ''; });
      } else {
        // clear both sets if none selected
        ['productName','productInterestRate','tenorYears','tenorMonths','tenorDays','schemeName','dpsYears'].forEach(n => { if (form.elements[n]) form.elements[n].value = ''; });
      }
      saveFormData();
      // update deposit label to reflect selected account type
      try { updateDepositAmountLabel(); } catch (e) {}
      }
    // Save preset entry and open presets list
    try {
      const preset = { type: val };
      if (val === 'FDR') {
        preset.product = fdrProductName ? fdrProductName.value : '';
        preset.interestRate = fdrInterestRate ? fdrInterestRate.value : '';
        preset.tenorYears = fdrTenorYears ? fdrTenorYears.value : '';
        preset.tenorMonths = fdrTenorMonths ? fdrTenorMonths.value : '';
        preset.tenorDays = fdrTenorDays ? fdrTenorDays.value : '';
      } else if (val === 'DPS') {
        preset.schemeName = dpsSchemeName ? dpsSchemeName.value : '';
        preset.years = dpsYears ? dpsYears.value : '';
      }
      if (editingPresetIndex !== null) {
        // update existing preset
        const all = loadPresets();
        all[editingPresetIndex] = preset;
        localStorage.setItem(PRESETS_KEY, JSON.stringify(all));
        editingPresetIndex = null;
      } else {
        savePresetEntry(preset);
      }
      renderPresets();
      // update overlays so newly saved product fields appear
      updateFdrOverlayValues();
      // refresh product dropdown options
      try { updateProductDropdown(); } catch (e) {}
      // update all overlays including DPS fields on pages 1/5
      try { renderOverlaysForCurrentType(); } catch (e) {}
    } catch (e) {}
  });

  // Presets logic
  const PRESETS_KEY = 'deposit_account_type_presets_v1';
  const presetsList = document.getElementById('presetsList');
  const presetsEmpty = document.getElementById('presetsEmpty');
  let editingPresetIndex = null;

  function loadPresets() {
    try { const raw = localStorage.getItem(PRESETS_KEY); return raw ? JSON.parse(raw) : []; } catch (e) { return []; }
  }

  // Migration: convert old presets that used `productName` into new `product` key
  function migratePresets() {
    try {
      const list = loadPresets();
      let changed = false;
      for (let i = 0; i < list.length; i++) {
        const p = list[i];
        if (p && p.type === 'FDR' && p.productName && !p.product) {
          p.product = p.productName;
          changed = true;
        }
      }
      if (changed) localStorage.setItem(PRESETS_KEY, JSON.stringify(list));
    } catch (e) {}
  }
  function savePresetEntry(obj) {
    const all = loadPresets();
    // simple dedupe: push new at front
    all.unshift(obj);
    localStorage.setItem(PRESETS_KEY, JSON.stringify(all));
  }
  function renderPresets() {
    const list = loadPresets();
    presetsList.innerHTML = '';
    if (!list || list.length === 0) {
      presetsEmpty.style.display = 'block';
      return;
    }
    presetsEmpty.style.display = 'none';
    list.forEach((p, idx) => {
      const li = document.createElement('li');
      li.className = 'presets-item';
      const left = document.createElement('div');
      left.className = 'meta';
      if (p.type === 'FDR') {
        const productName = p.product || p.productName || '';
        const tenor = `${p.tenorYears||0}y ${p.tenorMonths||0}m ${p.tenorDays||0}d`;
        const rate = p.interestRate ? ` @ ${p.interestRate}%` : '';
        const amt = p.amount ? ` â€” à§³${p.amount}` : '';
        left.textContent = `FDR â€” ${productName} (${tenor})${rate}${amt}`;
      }
      else if (p.type === 'DPS') {
        const scheme = p.schemeName || '';
        const years = p.years || 0;
        const rate = p.interestRate ? ` @ ${p.interestRate}%` : '';
        const amt = p.amount ? ` â€” à§³${p.amount}` : '';
        left.textContent = `DPS â€” ${scheme} (${years}y)${rate}${amt}`;
      }
      else left.textContent = p.type || 'Preset';
      const right = document.createElement('div');
      right.innerHTML = `<button class="btn btn-info" data-edit="${idx}">Edit</button> <button class="btn" data-del="${idx}">Delete</button>`;
      li.appendChild(left);
      li.appendChild(right);
      presetsList.appendChild(li);
    });
    // wire buttons
    // Edit button: populate popup fields for editing the preset
    presetsList.querySelectorAll('button[data-edit]').forEach(btn => {
      btn.addEventListener('click', function(){
        const idx = parseInt(this.getAttribute('data-edit'),10);
        const list = loadPresets();
        const p = list[idx];
        if (!p) return;
        // ensure popup is open
        openAccountTypePopup();
        // mark editing index
        editingPresetIndex = idx;
        // populate popup inputs for editing
        if (accountTypeSelectPopup) accountTypeSelectPopup.value = p.type || '';
        if (p.type === 'FDR') {
          if (fdrFields) fdrFields.style.display = 'block';
          if (dpsFields) dpsFields.style.display = 'none';
          if (fdrProductName) fdrProductName.value = p.product || p.productName || '';
          if (fdrInterestRate) fdrInterestRate.value = p.interestRate || '';
          if (fdrTenorYears) fdrTenorYears.value = p.tenorYears || '';
          if (fdrTenorMonths) fdrTenorMonths.value = p.tenorMonths || '';
          if (fdrTenorDays) fdrTenorDays.value = p.tenorDays || '';
        } else if (p.type === 'DPS') {
          if (dpsFields) dpsFields.style.display = 'block';
          if (fdrFields) fdrFields.style.display = 'none';
          if (dpsSchemeName) dpsSchemeName.value = p.schemeName || '';
          if (dpsYears) dpsYears.value = p.years || '';
        }
      });
    });
    presetsList.querySelectorAll('button[data-del]').forEach(btn => {
      btn.addEventListener('click', function(){
        const idx = parseInt(this.getAttribute('data-del'),10);
        const list = loadPresets();
        list.splice(idx,1);
        localStorage.setItem(PRESETS_KEY, JSON.stringify(list));
        renderPresets();
      });
    });
  }
  function openPresetsPanel(){ renderPresets(); }
  // Presets are shown inline in the account type popup; no backdrop panel to close.
  // wire slide menu presets button if present - now opens Saved Presets panel (full form data)
  const slideMenuPresetsBtn = document.getElementById('slideMenuPresets');
  if (slideMenuPresetsBtn) slideMenuPresetsBtn.addEventListener('click', function(e){ e.preventDefault(); openSavedPresetsPanel(); closeSlideMenu(); });
  
  // wire slide menu save preset button
  const slideMenuSavePresetBtn = document.getElementById('slideMenuSavePreset');
  if (slideMenuSavePresetBtn) slideMenuSavePresetBtn.addEventListener('click', function(e){ e.preventDefault(); saveFullFormPreset(); closeSlideMenu(); });

  // Officer Seal Popup
  const officerSealBackdrop = document.getElementById('officerSealBackdrop');
  const officerSealClose = document.getElementById('officerSealClose');
  const slideMenuOfficerSeal = document.getElementById('slideMenuOfficerSeal');
  const officer1Input = document.getElementById('officer1Name');
  const officer2Input = document.getElementById('officer2Name');
  const officer3Input = document.getElementById('officer3Name');
  const sealPreview1 = document.getElementById('sealPreview1');
  const sealPreview2 = document.getElementById('sealPreview2');
  const sealPreview3 = document.getElementById('sealPreview3');
  const saveOfficerSealBtn = document.getElementById('saveOfficerSealBtn');
  const officerSealSizeInput = document.getElementById('officerSealSize');
  const officerSealSizeValue = document.getElementById('officerSealSizeValue');
  const OFFICER_SEALS_KEY = 'deposit_officer_seals_v1';

  function openOfficerSealPopup() {
    // Load saved seals
    const savedSeals = JSON.parse(localStorage.getItem(OFFICER_SEALS_KEY) || '{}');
    if (officer1Input) officer1Input.value = savedSeals.officer1 || '';
    if (officer2Input) officer2Input.value = savedSeals.officer2 || '';
    if (officer3Input) officer3Input.value = savedSeals.officer3 || '';
    // Load saved size (fallback to 140)
    const savedSize = parseInt(savedSeals.size || 140, 10) || 140;
    if (officerSealSizeInput) officerSealSizeInput.value = savedSize;
    if (officerSealSizeValue) officerSealSizeValue.textContent = savedSize + 'px';
    updateSealPreviews();
    officerSealBackdrop.classList.add('show');
  }
  function closeOfficerSealPopup() {
    officerSealBackdrop.classList.remove('show');
  }
  function updateSealPreviews() {
    const text1 = officer1Input ? officer1Input.value || 'Officer 1' : 'Officer 1';
    const text2 = officer2Input ? officer2Input.value || 'Officer 2' : 'Officer 2';
    const text3 = officer3Input ? officer3Input.value || 'Officer 3' : 'Officer 3';
    const sizeVal = officerSealSizeInput ? parseInt(officerSealSizeInput.value || 140, 10) : 140;
    // Render seals wider than tall: width = size * 1.6 (rectangular stamp)
    const widthVal = Math.round(sizeVal * 1.6);
    const fontSizeRem = 0.65 * (sizeVal / 140);
    if (sealPreview1) {
      const preview1 = sealPreview1.querySelector('.seal-item-text');
      if (preview1) preview1.textContent = text1;
      sealPreview1.style.width = widthVal + 'px';
      sealPreview1.style.height = sizeVal + 'px';
      sealPreview1.style.fontSize = fontSizeRem + 'rem';
      sealPreview1.style.padding = Math.max(8, Math.round(sizeVal * 0.06)) + 'px';
    }
    if (sealPreview2) {
      const preview2 = sealPreview2.querySelector('.seal-item-text');
      if (preview2) preview2.textContent = text2;
      sealPreview2.style.width = widthVal + 'px';
      sealPreview2.style.height = sizeVal + 'px';
      sealPreview2.style.fontSize = fontSizeRem + 'rem';
      sealPreview2.style.padding = Math.max(8, Math.round(sizeVal * 0.06)) + 'px';
    }
    if (sealPreview3) {
      const preview3 = sealPreview3.querySelector('.seal-item-text');
      if (preview3) preview3.textContent = text3;
      sealPreview3.style.width = widthVal + 'px';
      sealPreview3.style.height = sizeVal + 'px';
      sealPreview3.style.fontSize = fontSizeRem + 'rem';
      sealPreview3.style.padding = Math.max(8, Math.round(sizeVal * 0.06)) + 'px';
    }
    if (officerSealSizeValue) officerSealSizeValue.textContent = sizeVal + 'px';
  }
  function saveOfficerSeals() {
    const seals = {
      officer1: officer1Input ? officer1Input.value : '',
      officer2: officer2Input ? officer2Input.value : '',
      officer3: officer3Input ? officer3Input.value : '',
      size: officerSealSizeInput ? parseInt(officerSealSizeInput.value || 140, 10) : 140
    };
    localStorage.setItem(OFFICER_SEALS_KEY, JSON.stringify(seals));
    showToast('Officer seals saved!');
    closeOfficerSealPopup();
  }

  if (slideMenuOfficerSeal) {
    slideMenuOfficerSeal.addEventListener('click', (e) => {
      e.preventDefault();
      closeSlideMenu();
      openOfficerSealPopup();
    });
  }
  if (officerSealClose) officerSealClose.addEventListener('click', closeOfficerSealPopup);
  // Backdrop click disabled - popup won't close when clicking outside
  if (officer1Input) officer1Input.addEventListener('input', updateSealPreviews);
  if (officer2Input) officer2Input.addEventListener('input', updateSealPreviews);
  if (officer3Input) officer3Input.addEventListener('input', updateSealPreviews);
  if (officerSealSizeInput) officerSealSizeInput.addEventListener('input', updateSealPreviews);
  if (saveOfficerSealBtn) saveOfficerSealBtn.addEventListener('click', saveOfficerSeals);

  // Product dropdown logic
  const mainAccountType = document.getElementById('mainAccountType');
  const productSelect = document.getElementById('productSelect');
  const productDisplay = document.getElementById('productDisplay');

  function updateProductDropdown() {
    const accountType = mainAccountType ? mainAccountType.value : '';
    productSelect.innerHTML = '<option value="">Select Product</option>';
    
    if (!accountType) return;
    
    const presets = loadPresets();
    const products = new Set();
    
    presets.forEach(p => {
      if (p.type === accountType) {
        if (accountType === 'FDR' && p.product) {
          products.add(p.product);
        } else if (accountType === 'DPS' && p.schemeName) {
          products.add(p.schemeName);
        }
      }
    });
    
    products.forEach(product => {
      const option = document.createElement('option');
      option.value = product;
      option.textContent = product;
      productSelect.appendChild(option);
    });
  }

  // Product details tooltip (shows preset details on hover)
  const productTooltip = document.createElement('div');
  productTooltip.style.position = 'absolute';
  productTooltip.style.zIndex = 2200;
  productTooltip.style.background = 'var(--card-bg)';
  productTooltip.style.border = '1px solid var(--border-color)';
  productTooltip.style.padding = '8px 10px';
  productTooltip.style.borderRadius = '6px';
  productTooltip.style.boxShadow = 'var(--shadow-lg)';
  productTooltip.style.fontSize = '13px';
  productTooltip.style.color = 'var(--text-primary)';
  productTooltip.style.display = 'none';
  document.body.appendChild(productTooltip);

  function renderProductTooltip(name) {
    if (!name) return '';
    const accountType = mainAccountType ? mainAccountType.value : (form.elements['accountType'] ? form.elements['accountType'].value : '');
    const all = loadPresets();
    let p = null;
    if (accountType === 'FDR') p = all.find(x => (x.product === name) || (x.productName === name));
    else if (accountType === 'DPS') p = all.find(x => (x.schemeName === name));
    if (!p) return '';
    if (p.type === 'FDR') {
      return `<strong>${p.product||p.productName||''}</strong><br>Interest: ${p.interestRate||''}%<br>Tenure: ${p.tenorYears||0}y ${p.tenorMonths||0}m ${p.tenorDays||0}d`;
    } else if (p.type === 'DPS') {
      return `<strong>${p.schemeName||''}</strong><br>Duration: ${p.years||0} years`;
    }
    return '';
  }

  function positionTooltipNear(el) {
    try {
      const r = el.getBoundingClientRect();
      // place tooltip below the element and center it horizontally
      const pageLeft = window.scrollX || window.pageXOffset;
      const pageTop = window.scrollY || window.pageYOffset;
      // measure tooltip after it's been made visible by caller
      const tRect = productTooltip.getBoundingClientRect();
      let left = pageLeft + r.left + (r.width - tRect.width) / 2;
      // clamp within viewport with small margin
      const margin = 8;
      const maxLeft = pageLeft + (document.documentElement.clientWidth || window.innerWidth) - tRect.width - margin;
      if (left < pageLeft + margin) left = pageLeft + margin;
      if (left > maxLeft) left = maxLeft;
      productTooltip.style.left = left + 'px';
      productTooltip.style.top = (pageTop + r.bottom + 8) + 'px';
    } catch (e) {}
  }

  function showProductTooltipForCurrent() {
    if (!productSelect) return;
    const name = productSelect.value || '';
    const html = renderProductTooltip(name);
    if (!html) { productTooltip.style.display = 'none'; return; }
    productTooltip.innerHTML = html;
    // make temporarily visible to measure size, then reposition centered below
    productTooltip.style.display = 'block';
    positionTooltipNear(productSelect);
  }

  function hideProductTooltip() {
    productTooltip.style.display = 'none';
  }

  if (productSelect) {
    productSelect.addEventListener('mouseenter', showProductTooltipForCurrent);
    productSelect.addEventListener('focus', showProductTooltipForCurrent);
    productSelect.addEventListener('change', function() { showProductTooltipForCurrent(); });
    productSelect.addEventListener('mouseleave', hideProductTooltip);
    productSelect.addEventListener('blur', hideProductTooltip);
  }

  if (mainAccountType) {
    mainAccountType.addEventListener('change', function() {
      updateProductDropdown();
      updateDepositAmountLabel();
    });
    updateProductDropdown();
    updateDepositAmountLabel();
  }

  function updateProductDisplay() {
    if (!productDisplay) return;
    const acctType = mainAccountType ? mainAccountType.value : (form.elements['accountType'] ? form.elements['accountType'].value : '');
    if (acctType === 'FDR') {
      productDisplay.value = (form.elements['productName'] && form.elements['productName'].value) || productSelect.value || '';
    } else if (acctType === 'DPS') {
      productDisplay.value = (form.elements['schemeName'] && form.elements['schemeName'].value) || productSelect.value || '';
    } else {
      productDisplay.value = '';
    }
  }

  // Update Amount label to show selected Account Type (FDR / DPS)
  function updateDepositAmountLabel() {
    const acct = mainAccountType ? mainAccountType.value : (form.elements['accountType'] ? form.elements['accountType'].value : '');
    const depositLabel = document.querySelector('label[for="depositAmountLabel"]') || document.querySelector('#depositAmountLabel');
    // We prefer using an element with id; create it if missing
    let labelEl = document.getElementById('depositAmountLabel');
    if (!labelEl) {
      // find the Deposit Amount label in the DOM and give it an id
      const labels = Array.from(document.querySelectorAll('.form-group label'));
      const deposit = labels.find(l => l.textContent.trim().startsWith('Amount'));
      if (deposit) {
        deposit.id = 'depositAmountLabel';
        labelEl = deposit;
      }
    }
    if (!labelEl) return;
    if (acct === 'FDR' || acct === 'DPS') {
      labelEl.textContent = 'Amount (' + acct + ')';
    } else {
      labelEl.textContent = 'Amount';
    }
  }

  if (productSelect) {
    productSelect.addEventListener('change', function() {
      const val = this.value || '';
      if (!val) return;
      const accountType = mainAccountType ? mainAccountType.value : (form.elements['accountType'] ? form.elements['accountType'].value : '');
      const list = loadPresets();
      let preset = null;
      if (accountType === 'FDR') {
        preset = list.find(p => (p.product === val) || (p.productName === val));
      } else if (accountType === 'DPS') {
        preset = list.find(p => p.schemeName === val);
      }
      if (!preset) return;
      // apply preset values to form (hidden inputs + visible fields)
      if (accountType === 'FDR') {
        setHiddenInput('productName', preset.product || preset.productName || '');
        setHiddenInput('productInterestRate', preset.interestRate || '');
        setHiddenInput('tenorYears', preset.tenorYears || '');
        setHiddenInput('tenorMonths', preset.tenorMonths || '');
        setHiddenInput('tenorDays', preset.tenorDays || '');
        if (form.elements['interestRate']) form.elements['interestRate'].value = preset.interestRate || '';
        // compute duration in months from tenor
        const y = Number(preset.tenorYears) || 0;
        const m = Number(preset.tenorMonths) || 0;
        const d = Number(preset.tenorDays) || 0;
        const months = y * 12 + m + Math.floor(d / 30);
        if (form.elements['duration']) form.elements['duration'].value = months || '';
      } else if (accountType === 'DPS') {
        setHiddenInput('schemeName', preset.schemeName || '');
        setHiddenInput('dpsYears', preset.years || '');
        // Also update the popup input fields so updateOverlays uses the new values
        const dpsSchemePopup = document.getElementById('dpsSchemeName');
        const dpsYearsPopup = document.getElementById('dpsYears');
        if (dpsSchemePopup) dpsSchemePopup.value = preset.schemeName || '';
        if (dpsYearsPopup) dpsYearsPopup.value = preset.years || '';
        const dpsMonths = (Number(preset.years) || 0) * 12;
        if (form.elements['duration']) form.elements['duration'].value = dpsMonths || '';
        if (form.elements['interestRate']) form.elements['interestRate'].value = '';
      }
      saveFormData();
      // update overlays and visible overlay texts
      updateFdrOverlayValues();
      setOverlayText('productName', form.elements['productName'] ? form.elements['productName'].value : '');
      const irVal = form.elements['productInterestRate'] ? form.elements['productInterestRate'].value : '';
      setOverlayText('productInterestRate', irVal ? (irVal + '%') : '');
      // update visible product display
      try { updateProductDisplay(); } catch (e) {}
      // ensure accountType matches
      if (form.elements['accountType']) form.elements['accountType'].value = accountType;
      if (mainAccountType) mainAccountType.value = accountType;
      updateDepositAmountLabel();
      // fully refresh overlays for DPS/FDR fields on pages 1/5
      try { renderOverlaysForCurrentType(); } catch (e) {}
    });
  }

  // Handle organization/business type "Others" field visibility
  const orgTypeSelect = form.elements['orgType'];
  const orgTypeOtherInput = form.elements['orgTypeOther'];
  const businessTypeSelect = form.elements['businessType'];
  const businessTypeOtherInput = form.elements['businessTypeOther'];
  
  if (orgTypeSelect && orgTypeOtherInput) {
    orgTypeSelect.addEventListener('change', function() {
      orgTypeOtherInput.style.display = this.value === 'Others' ? 'block' : 'none';
      if (this.value !== 'Others') {
        orgTypeOtherInput.value = '';
        setOverlayText('orgTypeOther', '');
      } else {
        // if Others selected, populate overlay from current textbox value (may be empty)
        setOverlayText('orgTypeOther', orgTypeOtherInput.value || '');
      }
      // update org type ticks on change
      try { updateOrgTypeTicks(); } catch (e) {}
    });
    // initialize on load
    orgTypeOtherInput.style.display = orgTypeSelect.value === 'Others' ? 'block' : 'none';
  }
  
  if (businessTypeSelect && businessTypeOtherInput) {
    businessTypeSelect.addEventListener('change', function() {
      businessTypeOtherInput.style.display = this.value === 'Others' ? 'block' : 'none';
      if (this.value !== 'Others') {
        businessTypeOtherInput.value = '';
        setOverlayText('businessTypeOther', '');
      } else {
        setOverlayText('businessTypeOther', businessTypeOtherInput.value || '');
      }
      try { updateBusinessTypeTicks(); } catch (e) {}
    });
    // initialize on load
    businessTypeOtherInput.style.display = businessTypeSelect.value === 'Others' ? 'block' : 'none';
  }

  // Initialize - form data cleared on app open, start fresh
  // Update applicant overlay text
  try {
    if (form.elements['secondApplicant']) setOverlayText('secondApplicant', form.elements['secondApplicant'].value || '');
    if (form.elements['thirdApplicant']) setOverlayText('thirdApplicant', form.elements['thirdApplicant'].value || '');
  } catch (e) {}
  // Update combined applicants on load
  try { updateCombinedApplicants(); } catch (e) {}
  // Ensure todayDate hidden input has current date and overlay shows it
  try {
    const now = new Date();
    const dd = String(now.getDate()).padStart(2, '0');
    const mm = String(now.getMonth() + 1).padStart(2, '0');
    const yyyy = now.getFullYear();
    const dateStr = dd + '\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0' + mm + '\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0' + yyyy;
    if (!(form.elements['todayDate'] && form.elements['todayDate'].value)) {
      setHiddenInput('todayDate', dateStr);
    }
    // Update each todayDate overlay with page-specific formatting
    const todayDateOverlays = document.querySelectorAll('.overlay[data-field="todayDate"]');
    todayDateOverlays.forEach(el => {
      const page = el.dataset.page;
      let displayDate;
      if (page === '9') {
        displayDate = dd + '-' + mm + '-' + yyyy;
      } else {
        displayDate = dateStr;
      }
      el.textContent = displayDate;
      el.style.display = '';
    });
    saveFormData();
  } catch (e) {}
  // Update org type tick overlays based on selected orgType
  function updateOrgTypeTicks() {
    const sel = form.elements['orgType'];
    const val = sel ? sel.value : '';
    const types = {
      'Proprietorship': 'tickOrg_Proprietorship',
      'Partnership': 'tickOrg_Partnership',
      'JointVenture': 'tickOrg_JointVenture',
      'PrivateLtd': 'tickOrg_PrivateLtd',
      'PublicLtd': 'tickOrg_PublicLtd',
      'Trust': 'tickOrg_Trust',
      'NGO': 'tickOrg_NGO',
      'Club': 'tickOrg_Club',
      'Educational': 'tickOrg_Educational',
      'Religious': 'tickOrg_Religious',
      'Others': 'tickOrg_Others'
    };
    Object.values(types).forEach(f => setTickOverlay(f, false));
    if (types[val]) setTickOverlay(types[val], true);
  }

  try { updateOrgTypeTicks(); } catch (e) {}
  // Update business type tick overlays based on selected businessType
  function updateBusinessTypeTicks() {
    const sel = form.elements['businessType'];
    const val = sel ? sel.value : '';
    const types = {
      'Trading': 'tickBusiness_Trading',
      'Service': 'tickBusiness_Service',
      'Manufacturing': 'tickBusiness_Manufacturing',
      'Others': 'tickBusiness_Others'
    };
    Object.values(types).forEach(f => setTickOverlay(f, false));
    if (types[val]) setTickOverlay(types[val], true);
  }

  try { updateBusinessTypeTicks(); } catch (e) {}
  // Update nominee identity document ticks on page 3
  function updateNomineeIdTicks() {
    const sel = form.elements['nomineeIdentityDocumentType'];
    const val = sel ? sel.value : '';
    const types = {
      'NID': 'tickNominee_NID',
      'Passport': 'tickNominee_Passport',
      'BirthCertificate': 'tickNominee_BirthCertificate',
      'Others': 'tickNominee_Others'
    };
    Object.values(types).forEach(f => setTickOverlay(f, false));
    if (types[val]) setTickOverlay(types[val], true);
  }

  // wire change listener for nominee ID type select (if present)
  try {
    const nomineeIdSelect = form.elements['nomineeIdentityDocumentType'];
    if (nomineeIdSelect) {
      nomineeIdSelect.addEventListener('change', function() {
        try { updateNomineeIdTicks(); } catch (e) {}
      });
    }
  } catch (e) {}

  try { updateNomineeIdTicks(); } catch (e) {}
  // Update main identity document ticks on page 2 (conventional) and page 6 (taqwa)
  function updateIdentityIdTicks() {
    const sel = form.elements['identityDocumentType'];
    const val = sel ? sel.value : '';
    const types = {
      'NID': 'tickId_NID',
      'Passport': 'tickId_Passport',
      'BirthCertificate': 'tickId_BirthCertificate',
      'Others': 'tickId_Others'
    };
    Object.values(types).forEach(f => setTickOverlay(f, false));
    if (types[val]) setTickOverlay(types[val], true);
  }

  function updateRegistrationAndVatTicks() {
    const registrationField = form.elements['registrationNo'];
    const vatField = form.elements['vatBin'];
    const registrationVal = registrationField ? registrationField.value.trim() : '';
    const vatVal = vatField ? vatField.value.trim() : '';
    
    try {
      setOverlayText('registrationNo', registrationVal);
      setOverlayText('vatBin', vatVal);
      setTickOverlay('tickRegistration1', registrationVal.length > 0);
      setTickOverlay('tickRegistration2', registrationVal.length > 0);
      setTickOverlay('tickVatBin1', vatVal.length > 0);
      setTickOverlay('tickVatBin2', vatVal.length > 0);
    } catch (e) {}
  }

  function updateClientBusinessTicks() {
    const businessField = form.elements['kycClientBusiness'];
    const businessVal = businessField ? businessField.value : '';
    
    // Clear all ticks first
    for (let i = 1; i <= 53; i++) {
      try {
        setTickOverlay('kycClientBusiness_' + i, false);
      } catch (e) {}
    }
    
    // If a business is selected, show the corresponding tick based on option index
    if (businessVal && businessField) {
      const selectedIndex = businessField.selectedIndex;
      // selectedIndex starts at 0 for first option (which is "Select Client's Business")
      // So option 1-53 have selectedIndex 1-53
      if (selectedIndex >= 1 && selectedIndex <= 53) {
        try {
          setTickOverlay('kycClientBusiness_' + selectedIndex, true);
        } catch (e) {}
      }
    }
  }

  function updateClientProfessionTicks() {
    const professionField = form.elements['kycClientProfession'];
    const professionVal = professionField ? professionField.value : '';
    
    // Clear all ticks first
    for (let i = 1; i <= 19; i++) {
      try {
        setTickOverlay('kycClientProfession_' + i, false);
      } catch (e) {}
    }
    
    // If a profession is selected, show the corresponding tick based on option index
    if (professionVal && professionField) {
      const selectedIndex = professionField.selectedIndex;
      // selectedIndex starts at 0 for first option (which is "Select Client's Profession")
      // So option 1-19 have selectedIndex 1-19
      if (selectedIndex >= 1 && selectedIndex <= 19) {
        try {
          setTickOverlay('kycClientProfession_' + selectedIndex, true);
        } catch (e) {}
      }
    }
  }

  function updateTypeOfOnboardingTicks() {
    const onboardingField = form.elements['kycTypeOfOnboarding'];
    const onboardingVal = onboardingField ? onboardingField.value : '';
    
    // Clear all ticks first
    for (let i = 1; i <= 4; i++) {
      try {
        setTickOverlay('kycTypeOfOnboarding_' + i, false);
      } catch (e) {}
    }
    
    // If an onboarding type is selected, show the corresponding tick based on option index
    if (onboardingVal && onboardingField) {
      const selectedIndex = onboardingField.selectedIndex;
      // selectedIndex starts at 0 for first option (which is "Select Type of On-boarding")
      // So option 1-4 have selectedIndex 1-4
      if (selectedIndex >= 1 && selectedIndex <= 4) {
        try {
          setTickOverlay('kycTypeOfOnboarding_' + selectedIndex, true);
        } catch (e) {}
      }
    }
  }

  function updatePepIpCeoTicks() {
    const pepField = form.elements['kycPepIpCeo'];
    const pepVal = pepField ? pepField.value : '';
    
    // Clear all ticks first
    for (let i = 1; i <= 2; i++) {
      try {
        setTickOverlay('kycPepIpCeo_' + i, false);
      } catch (e) {}
    }
    
    // If a PEP/IP/CEO option is selected, show the corresponding tick based on option index
    if (pepVal && pepField) {
      const selectedIndex = pepField.selectedIndex;
      // selectedIndex starts at 0 for first option (which is "Select PEP/IP/CEO")
      // So option 1-2 have selectedIndex 1-2
      if (selectedIndex >= 1 && selectedIndex <= 2) {
        try {
          setTickOverlay('kycPepIpCeo_' + selectedIndex, true);
        } catch (e) {}
      }
    }
  }

  function updateCloseAssociatePepTicks() {
    const assocField = form.elements['kycCloseAssociatePep'];
    const assocVal = assocField ? assocField.value : '';
    
    // Clear all ticks first
    for (let i = 1; i <= 2; i++) {
      try {
        setTickOverlay('kycCloseAssociatePep_' + i, false);
      } catch (e) {}
    }
    
    // If a Close Associate option is selected, show the corresponding tick based on option index
    if (assocVal && assocField) {
      const selectedIndex = assocField.selectedIndex;
      // selectedIndex starts at 0 for first option (which is "Select Close Associate")
      // So option 1-2 have selectedIndex 1-2
      if (selectedIndex >= 1 && selectedIndex <= 2) {
        try {
          setTickOverlay('kycCloseAssociatePep_' + selectedIndex, true);
        } catch (e) {}
      }
    }
  }

  function updateAvgYearlyTransactionTicks() {
    const transactionField = form.elements['kycAvgYearlyTransaction'];
    const transactionVal = transactionField ? transactionField.value : '';
    
    // Clear all ticks first
    for (let i = 1; i <= 8; i++) {
      try {
        setTickOverlay('kycAvgYearlyTransaction_' + i, false);
      } catch (e) {}
    }
    
    // If an Avg Yearly Transaction option is selected, show the corresponding tick based on option index
    if (transactionVal && transactionField) {
      const selectedIndex = transactionField.selectedIndex;
      // selectedIndex starts at 0 for first option (which is "Select Average Yearly Transaction")
      // So option 1-8 have selectedIndex 1-8
      if (selectedIndex >= 1 && selectedIndex <= 8) {
        try {
          setTickOverlay('kycAvgYearlyTransaction_' + selectedIndex, true);
        } catch (e) {}
      }
    }
  }

  function updateCredibleSourceOfFundsTicks() {
    const credibleField = form.elements['kycCredibleSourceOfFunds'];
    const credibleVal = credibleField ? credibleField.value : '';
    
    // Clear all ticks first
    for (let i = 1; i <= 2; i++) {
      try {
        setTickOverlay('kycCredibleSourceOfFunds_' + i, false);
      } catch (e) {}
    }
    
    // If a Credible Source option is selected, show the corresponding tick based on option index
    if (credibleVal && credibleField) {
      const selectedIndex = credibleField.selectedIndex;
      // selectedIndex starts at 0 for first option (which is "Select Credible Source")
      // So option 1-2 have selectedIndex 1-2
      if (selectedIndex >= 1 && selectedIndex <= 2) {
        try {
          setTickOverlay('kycCredibleSourceOfFunds_' + selectedIndex, true);
        } catch (e) {}
      }
    }
  }

  function updateKycScoreFields() {
    // Extract and display Client's Business score
    const businessField = form.elements['kycClientBusiness'];
    const businessVal = businessField ? businessField.value : '';
    let businessScore = '';
    if (businessVal && businessVal.includes('|')) {
      businessScore = businessVal.split('|')[1];
    }
    const businessScoreOverlay = overlays.find(o => o.dataset.field === 'kycClientBusinessScore');
    if (businessScoreOverlay) {
      businessScoreOverlay.textContent = businessScore;
    }

    // Extract and display Client's Profession score
    const professionField = form.elements['kycClientProfession'];
    const professionVal = professionField ? professionField.value : '';
    let professionScore = '';
    if (professionVal && professionVal.includes('|')) {
      professionScore = professionVal.split('|')[1];
    }
    const professionScoreOverlay = overlays.find(o => o.dataset.field === 'kycClientProfessionScore');
    if (professionScoreOverlay) {
      professionScoreOverlay.textContent = professionScore;
    }
  }

  function updateKycTotalScore() {
    // Extract scores from all KYC fields
    let totalScore = 0;

    // Client's Business score
    const businessField = form.elements['kycClientBusiness'];
    const businessVal = businessField ? businessField.value : '';
    if (businessVal && businessVal.includes('|')) {
      const score = businessVal.split('|')[1];
      // Handle range scores like "01-05"
      if (score.includes('-')) {
        totalScore += parseInt(score.split('-')[1], 10) || 0;
      } else {
        totalScore += parseInt(score, 10) || 0;
      }
    }

    // Client's Profession score
    const professionField = form.elements['kycClientProfession'];
    const professionVal = professionField ? professionField.value : '';
    if (professionVal && professionVal.includes('|')) {
      const score = professionVal.split('|')[1];
      if (score.includes('-')) {
        totalScore += parseInt(score.split('-')[1], 10) || 0;
      } else {
        totalScore += parseInt(score, 10) || 0;
      }
    }

    // Type of On-boarding score
    const onboardingField = form.elements['kycTypeOfOnboarding'];
    const onboardingVal = onboardingField ? onboardingField.value : '';
    if (onboardingVal && onboardingVal.includes('|')) {
      totalScore += parseInt(onboardingVal.split('|')[1], 10) || 0;
    }

    // PEP/IP/CEO score
    const pepField = form.elements['kycPepIpCeo'];
    const pepVal = pepField ? pepField.value : '';
    if (pepVal && pepVal.includes('|')) {
      totalScore += parseInt(pepVal.split('|')[1], 10) || 0;
    }

    // Close Associate of PEP/IP/CEO score
    const closeAssociateField = form.elements['kycCloseAssociatePep'];
    const closeAssociateVal = closeAssociateField ? closeAssociateField.value : '';
    if (closeAssociateVal && closeAssociateVal.includes('|')) {
      totalScore += parseInt(closeAssociateVal.split('|')[1], 10) || 0;
    }

    // Customer's Avg Yearly Transaction score
    const transactionField = form.elements['kycAvgYearlyTransaction'];
    const transactionVal = transactionField ? transactionField.value : '';
    if (transactionVal && transactionVal.includes('|')) {
      totalScore += parseInt(transactionVal.split('|')[1], 10) || 0;
    }

    // Credible Source of Funds score
    const credibleField = form.elements['kycCredibleSourceOfFunds'];
    const credibleVal = credibleField ? credibleField.value : '';
    if (credibleVal && credibleVal.includes('|')) {
      totalScore += parseInt(credibleVal.split('|')[1], 10) || 0;
    }

    // Add 4 to total
    totalScore += 4;

    // Display total score
    const totalScoreOverlay = overlays.find(o => o.dataset.field === 'kycTotalScore');
    if (totalScoreOverlay) {
      totalScoreOverlay.textContent = totalScore;
      totalScoreOverlay.style.display = '';
    }
    
    // Update ticks based on total score
    try { updateTotalScoreTicks(); } catch (e) {}
  }

  function updateSourceOfFundDocumentTick() {
    const field = form.elements['kycSourceOfFundDocument'];
    const val = field ? field.value.trim() : '';
    setTickOverlay('tickSourceOfFundDocument', val.length > 0);
  }

  function updateETinIndividualTicks() {
    const field = form.elements['eTinIndividual'];
    const val = field ? field.value.trim() : '';
    const hasValue = val.length > 0;
    setTickOverlay('tickETin1', hasValue);
    setTickOverlay('tickETin2', hasValue);
  }

  function updateTotalScoreTicks() {
    // Calculate total score
    let totalScore = 0;

    // Client's Business score
    const businessField = form.elements['kycClientBusiness'];
    const businessVal = businessField ? businessField.value : '';
    if (businessVal && businessVal.includes('|')) {
      const score = businessVal.split('|')[1];
      if (score.includes('-')) {
        totalScore += parseInt(score.split('-')[1], 10) || 0;
      } else {
        totalScore += parseInt(score, 10) || 0;
      }
    }

    // Client's Profession score
    const professionField = form.elements['kycClientProfession'];
    const professionVal = professionField ? professionField.value : '';
    if (professionVal && professionVal.includes('|')) {
      const score = professionVal.split('|')[1];
      if (score.includes('-')) {
        totalScore += parseInt(score.split('-')[1], 10) || 0;
      } else {
        totalScore += parseInt(score, 10) || 0;
      }
    }

    // Type of On-boarding score
    const onboardingField = form.elements['kycTypeOfOnboarding'];
    const onboardingVal = onboardingField ? onboardingField.value : '';
    if (onboardingVal && onboardingVal.includes('|')) {
      totalScore += parseInt(onboardingVal.split('|')[1], 10) || 0;
    }

    // PEP/IP/CEO score
    const pepField = form.elements['kycPepIpCeo'];
    const pepVal = pepField ? pepField.value : '';
    if (pepVal && pepVal.includes('|')) {
      totalScore += parseInt(pepVal.split('|')[1], 10) || 0;
    }

    // Close Associate of PEP/IP/CEO score
    const closeAssociateField = form.elements['kycCloseAssociatePep'];
    const closeAssociateVal = closeAssociateField ? closeAssociateField.value : '';
    if (closeAssociateVal && closeAssociateVal.includes('|')) {
      totalScore += parseInt(closeAssociateVal.split('|')[1], 10) || 0;
    }

    // Customer's Avg Yearly Transaction score
    const transactionField = form.elements['kycAvgYearlyTransaction'];
    const transactionVal = transactionField ? transactionField.value : '';
    if (transactionVal && transactionVal.includes('|')) {
      totalScore += parseInt(transactionVal.split('|')[1], 10) || 0;
    }

    // Credible Source of Funds score
    const credibleField = form.elements['kycCredibleSourceOfFunds'];
    const credibleVal = credibleField ? credibleField.value : '';
    if (credibleVal && credibleVal.includes('|')) {
      totalScore += parseInt(credibleVal.split('|')[1], 10) || 0;
    }

    // Add 4 to total
    totalScore += 4;

    // Show tick 1 if score > 14, tick 2 if score <= 14
    // Find overlays using querySelectorAll since they might not be in the overlays array yet
    const allOverlays = document.querySelectorAll('.overlay');
    let tick1 = null;
    let tick2 = null;
    let riskLevelOverlay = null;
    
    allOverlays.forEach(o => {
      if (o.dataset.field === 'kycTotalScore_1') tick1 = o;
      if (o.dataset.field === 'kycTotalScore_2') tick2 = o;
      if (o.dataset.field === 'kycRiskLevel') riskLevelOverlay = o;
    });
    
    if (tick1) {
      tick1.style.display = totalScore > 14 ? '' : 'none';
      tick1.textContent = totalScore > 14 ? 'âœ“' : '';
    }
    
    if (tick2) {
      tick2.style.display = totalScore <= 14 ? '' : 'none';
      tick2.textContent = totalScore <= 14 ? 'âœ“' : '';
    }
    
    // Set risk level text
    if (riskLevelOverlay) {
      riskLevelOverlay.textContent = totalScore > 14 ? 'risk is high' : 'risk is low';
      riskLevelOverlay.style.display = '';
    }
  }

  function updateIdentityDocumentNumbers() {
    const idSelect = form.elements['identityDocumentType'];
    const idValue = idSelect ? idSelect.value : '';
    const idNumber = form.elements['identityDocumentNumber'];
    const idNumberVal = idNumber ? idNumber.value : '';
    
    // Set the appropriate hidden field based on document type and update overlays
    if (form.elements['nationalIdNumber']) form.elements['nationalIdNumber'].value = (idValue === 'NID') ? idNumberVal : '';
    if (form.elements['passportNumber']) form.elements['passportNumber'].value = (idValue === 'Passport') ? idNumberVal : '';
    if (form.elements['birthCertificateNumber']) form.elements['birthCertificateNumber'].value = (idValue === 'BirthCertificate') ? idNumberVal : '';
    
    // Update overlays to display only the relevant document number
    try {
      setOverlayText('nationalIdNumber', (idValue === 'NID') ? idNumberVal : '');
      setOverlayText('passportNumber', (idValue === 'Passport') ? idNumberVal : '');
      setOverlayText('birthCertificateNumber', (idValue === 'BirthCertificate') ? idNumberVal : '');
    } catch (e) {}
    
    // Update ticks: show 2 ticks for the selected document type if it has a value
    const hasNationalId = idValue === 'NID' && idNumberVal.length > 0;
    const hasPassport = idValue === 'Passport' && idNumberVal.length > 0;
    const hasBirthCert = idValue === 'BirthCertificate' && idNumberVal.length > 0;
    
    try {
      setTickOverlay('tickNationalId1', hasNationalId);
      setTickOverlay('tickNationalId2', hasNationalId);
      setTickOverlay('tickPassport1', hasPassport);
      setTickOverlay('tickPassport2', hasPassport);
      setTickOverlay('tickBirthCert1', hasBirthCert);
      setTickOverlay('tickBirthCert2', hasBirthCert);
    } catch (e) {}
  }

  // wire change listener for main identity document select (if present)
  try {
    const idSelect = form.elements['identityDocumentType'];
    if (idSelect) {
      idSelect.addEventListener('change', function() {
        try { setOverlayText('identityDocumentType', idSelect.value || ''); } catch (e) {}
        try { updateIdentityIdTicks(); } catch (e) {}
        try { updateIdentityDocumentNumbers(); } catch (e) {}
        try { saveFormData(); } catch (e) {}
      });
    }
  } catch (e) {}

  // Also update on identity document number input change
  try {
    const idNumberInput = form.elements['identityDocumentNumber'];
    if (idNumberInput) {
      idNumberInput.addEventListener('input', function() {
        try { updateIdentityDocumentNumbers(); } catch (e) {}
      });
      idNumberInput.addEventListener('change', function() {
        try { updateIdentityDocumentNumbers(); } catch (e) {}
        try { saveFormData(); } catch (e) {}
      });
    }
  } catch (e) {}

  try {
    const fundDocField = form.elements['kycSourceOfFundDocument'];
    if (fundDocField) {
      fundDocField.addEventListener('change', function() {
        try { updateSourceOfFundDocumentTick(); } catch (e) {}
        try { saveFormData(); } catch (e) {}
      });
      fundDocField.addEventListener('input', function() {
        try { updateSourceOfFundDocumentTick(); } catch (e) {}
      });
    }
  } catch (e) {}

  try {
    const eTinIndividualField = form.elements['eTinIndividual'];
    if (eTinIndividualField) {
      eTinIndividualField.addEventListener('change', function() {
        try { updateETinIndividualTicks(); } catch (e) {}
        try { saveFormData(); } catch (e) {}
      });
      eTinIndividualField.addEventListener('input', function() {
        try { updateETinIndividualTicks(); } catch (e) {}
      });
    }
  } catch (e) {}

  // Wire event listeners for registration and VAT fields
  try {
    const regField = form.elements['registrationNo'];
    if (regField) {
      regField.addEventListener('input', function() {
        try { updateRegistrationAndVatTicks(); } catch (e) {}
      });
      regField.addEventListener('change', function() {
        try { updateRegistrationAndVatTicks(); } catch (e) {}
        try { saveFormData(); } catch (e) {}
      });
    }
  } catch (e) {}

  try {
    const vatField = form.elements['vatBin'];
    if (vatField) {
      vatField.addEventListener('input', function() {
        try { updateRegistrationAndVatTicks(); } catch (e) {}
      });
      vatField.addEventListener('change', function() {
        try { updateRegistrationAndVatTicks(); } catch (e) {}
        try { saveFormData(); } catch (e) {}
      });
    }
  } catch (e) {}

  // Wire event listener for Client's Business dropdown
  try {
    const businessField = form.elements['kycClientBusiness'];
    if (businessField) {
      businessField.addEventListener('change', function() {
        // Reset Client's Profession dropdown when Client's Business changes
        const professionField = form.elements['kycClientProfession'];
        if (professionField) {
          professionField.selectedIndex = 0;
        }
        try { updateClientBusinessTicks(); } catch (e) {}
        try { updateClientProfessionTicks(); } catch (e) {}
        try { saveFormData(); } catch (e) {}
      });
    }
  } catch (e) {}

  // Wire event listener for Client's Profession dropdown
  try {
    const professionField = form.elements['kycClientProfession'];
    if (professionField) {
      professionField.addEventListener('change', function() {
        // Reset Client's Business dropdown when Client's Profession changes
        const businessField = form.elements['kycClientBusiness'];
        if (businessField) {
          businessField.selectedIndex = 0;
        }
        try { updateClientBusinessTicks(); } catch (e) {}
        try { updateClientProfessionTicks(); } catch (e) {}
        try { saveFormData(); } catch (e) {}
      });
    }
  } catch (e) {}

  // Wire event listener for Type of On-boarding Score dropdown
  try {
    const onboardingField = form.elements['kycTypeOfOnboarding'];
    if (onboardingField) {
      onboardingField.addEventListener('change', function() {
        try { updateTypeOfOnboardingTicks(); } catch (e) {}
        try { saveFormData(); } catch (e) {}
      });
    }
  } catch (e) {}

  // Wire event listener for PEP/IP/CEO dropdown
  try {
    const pepField = form.elements['kycPepIpCeo'];
    if (pepField) {
      pepField.addEventListener('change', function() {
        try { updatePepIpCeoTicks(); } catch (e) {}
        try { saveFormData(); } catch (e) {}
      });
    }
  } catch (e) {}

  // Wire event listener for Close Associate of PEP/IP/CEO dropdown
  try {
    const assocField = form.elements['kycCloseAssociatePep'];
    if (assocField) {
      assocField.addEventListener('change', function() {
        try { updateCloseAssociatePepTicks(); } catch (e) {}
        try { saveFormData(); } catch (e) {}
      });
    }
  } catch (e) {}

  // Wire event listener for Customer's Avg Yearly Transaction dropdown
  try {
    const transactionField = form.elements['kycAvgYearlyTransaction'];
    if (transactionField) {
      transactionField.addEventListener('change', function() {
        try { updateAvgYearlyTransactionTicks(); } catch (e) {}
        try { saveFormData(); } catch (e) {}
      });
    }
  } catch (e) {}

  // Wire event listener for Credible Source of Funds dropdown
  try {
    const credibleField = form.elements['kycCredibleSourceOfFunds'];
    if (credibleField) {
      credibleField.addEventListener('change', function() {
        try { updateCredibleSourceOfFundsTicks(); } catch (e) {}
        try { saveFormData(); } catch (e) {}
      });
    }
  } catch (e) {}

  // Wire event listeners for Client's Business and Profession dropdowns to update score fields
  try {
    const businessField = form.elements['kycClientBusiness'];
    if (businessField) {
      businessField.addEventListener('change', function() {
        try { updateKycScoreFields(); } catch (e) {}
        try { updateKycTotalScore(); } catch (e) {}
        try { saveFormData(); } catch (e) {}
      });
    }
  } catch (e) {}

  try {
    const professionField = form.elements['kycClientProfession'];
    if (professionField) {
      professionField.addEventListener('change', function() {
        try { updateKycScoreFields(); } catch (e) {}
        try { updateKycTotalScore(); } catch (e) {}
        try { saveFormData(); } catch (e) {}
      });
    }
  } catch (e) {}

  // Wire event listeners for other KYC dropdowns to update total score
  try {
    const onboardingField = form.elements['kycTypeOfOnboarding'];
    if (onboardingField) {
      onboardingField.addEventListener('change', function() {
        try { updateKycTotalScore(); } catch (e) {}
        try { saveFormData(); } catch (e) {}
      });
    }
  } catch (e) {}

  try {
    const pepField = form.elements['kycPepIpCeo'];
    if (pepField) {
      pepField.addEventListener('change', function() {
        try { updatePepIpCeoTicks(); } catch (e) {}
        try { updateKycTotalScore(); } catch (e) {}
        try { saveFormData(); } catch (e) {}
      });
    }
  } catch (e) {}

  try {
    const closeAssociateField = form.elements['kycCloseAssociatePep'];
    if (closeAssociateField) {
      closeAssociateField.addEventListener('change', function() {
        try { updateCloseAssociatePepTicks(); } catch (e) {}
        try { updateKycTotalScore(); } catch (e) {}
        try { saveFormData(); } catch (e) {}
      });
    }
  } catch (e) {}

  try {
    const transactionField = form.elements['kycAvgYearlyTransaction'];
    if (transactionField) {
      transactionField.addEventListener('change', function() {
        try { updateAvgYearlyTransactionTicks(); } catch (e) {}
        try { updateKycTotalScore(); } catch (e) {}
        try { saveFormData(); } catch (e) {}
      });
    }
  } catch (e) {}

  try {
    const credibleField = form.elements['kycCredibleSourceOfFunds'];
    if (credibleField) {
      credibleField.addEventListener('change', function() {
        try { updateCredibleSourceOfFundsTicks(); } catch (e) {}
        try { updateKycTotalScore(); } catch (e) {}
        try { saveFormData(); } catch (e) {}
      });
    }
  } catch (e) {}

  try { updateIdentityIdTicks(); } catch (e) {}
  try { updateIdentityDocumentNumbers(); } catch (e) {}
  try { updateSourceOfFundDocumentTick(); } catch (e) {}
  try { updateETinIndividualTicks(); } catch (e) {}
  try { updateRegistrationAndVatTicks(); } catch (e) {}
  try { updateClientBusinessTicks(); } catch (e) {}
  try { updateClientProfessionTicks(); } catch (e) {}
  try { updateTypeOfOnboardingTicks(); } catch (e) {}
  try { updatePepIpCeoTicks(); } catch (e) {}
  try { updateCloseAssociatePepTicks(); } catch (e) {}
  // Initialize static numeric overlays
  try {
    if (!(form.elements['staticOne'] && form.elements['staticOne'].value)) {
      setHiddenInput('staticOne', '1');
    }
    if (!(form.elements['staticFour'] && form.elements['staticFour'].value)) {
      setHiddenInput('staticFour', '4');
    }
    // initialize page 3 static numbers and tick
    if (!(form.elements['staticThreePage3'] && form.elements['staticThreePage3'].value)) {
      setHiddenInput('staticThreePage3', '3');
    }
    if (!(form.elements['staticFourPage3'] && form.elements['staticFourPage3'].value)) {
      setHiddenInput('staticFourPage3', '4');
    }
    setOverlayText('staticOne', '1');
    setOverlayText('staticFour', '4');
    setOverlayText('staticThreePage3', '3');
    setOverlayText('staticFourPage3', '4');
    // Initialize static tick on page 9 (always visible using tick overlay styling)
    try { setTickOverlay('tickStaticPage9', true); } catch (e) {}
    // Initialize 3 ticks on page 10
    try {
      setTickOverlay('tickPage10_1', true);
      setTickOverlay('tickPage10_2', true);
      setTickOverlay('tickPage10_3', true);
    } catch (e) {}
    // Initialize N/A overlays on page 10
    try {
      setOverlayText('naPage10_1', 'N/A');
      setOverlayText('naPage10_2', 'N/A');
    } catch (e) {}
    // show tick inside textbox on page 3 by default
    setTickOverlay('tickTextbox', true);
    // Initialize second and third applicant overlays from form values
    if (form.elements['secondApplicant']) setOverlayText('secondApplicant', form.elements['secondApplicant'].value || '');
    if (form.elements['thirdApplicant']) setOverlayText('thirdApplicant', form.elements['thirdApplicant'].value || '');
    saveFormData();
  } catch (e) {}
  // initialize dpsMonths overlay from loaded value
  try {
    const yv = (form.elements['dpsYears'] && form.elements['dpsYears'].value) || '';
    const monthsInit = yv ? String(Number(yv) * 12) : '';
    if (monthsInit) setOverlayText('dpsMonths', monthsInit);
  } catch (e) {}
  // Ensure a default hidden frequency value for page 1 preview (do not add visible field)
  try {
    if (!(form.elements['frequency'] && form.elements['frequency'].value)) {
      setHiddenInput('frequency', 'Monthly');
      setOverlayText('frequency', 'Monthly');
      saveFormData();
    }
  } catch (e) {}
  // Initialize all tick overlays from loaded form data
  try { if (typeof updateMaturityTicks === 'function') updateMaturityTicks(); } catch (e) {}
  try { if (typeof updateModeTicks === 'function') updateModeTicks(); } catch (e) {}
  try { if (typeof updateGenderTicks === 'function') updateGenderTicks(); } catch (e) {}
  try { if (typeof updateOrgTypeTicks === 'function') updateOrgTypeTicks(); } catch (e) {}
  try { if (typeof updateBusinessTypeTicks === 'function') updateBusinessTypeTicks(); } catch (e) {}
  try { if (typeof updateAvgYearlyTransactionTicks === 'function') updateAvgYearlyTransactionTicks(); } catch (e) {}
  try { if (typeof updateCredibleSourceOfFundsTicks === 'function') updateCredibleSourceOfFundsTicks(); } catch (e) {}
  try { if (typeof updateNomineeIdTicks === 'function') updateNomineeIdTicks(); } catch (e) {}
  try { setTickOverlay('tickOne', true); } catch (e) {}
  try { setTickOverlay('tickTextbox', true); } catch (e) {}
  // migrate older presets if needed (productName -> product)
  try { migratePresets(); } catch (e) { /* ignore */ }
  updateProductDropdown();
  try { updateProductDisplay(); } catch (e) {}
  // Refresh overlays with loaded values
  try {
    updateFdrOverlayValues();
    if (form && form.elements['accountNumber']) {
      setOverlayText('accountNumber', form.elements['accountNumber'].value || '');
    }
    if (form && form.elements['cifNumber']) {
      setOverlayText('cifNumber', form.elements['cifNumber'].value || '');
    }
  } catch (e) {}

  // === Export/Import Functionality ===
  function exportData() {
    try {
      const formData = new FormData(form);
      const data = {};
      for (let [key, value] of formData.entries()) data[key] = value;

      const overlayPositions = loadOverlayPositions();
      const presets = loadPresets();

      const payload = {
        exportedAt: new Date().toISOString(),
        form: data,
        overlayPositions: overlayPositions,
        presets: presets
      };

      const blob = new Blob([JSON.stringify(payload, null, 2)], { type: 'application/json' });
      const ts = new Date().toISOString().replace(/[:.]/g, '-');
      const filename = `deposit_form_export_${ts}.json`;

      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
      showToast('Data exported: ' + filename);
    } catch (e) {
      console.error('Export failed', e);
      showToast('Export failed');
    }
  }

  function importDataFromFile(file) {
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(e) {
      try {
        const obj = JSON.parse(e.target.result);
        const imported = obj && obj.form ? obj.form : obj;

        // Apply form values
        Object.keys(imported).forEach(key => {
          const el = form.elements[key];
          if (!el) return;
          if (el.type === 'checkbox') {
            el.checked = !!imported[key];
          } else {
            el.value = imported[key] == null ? '' : imported[key];
          }
        });

        // If overlay positions present, store them
        if (obj && obj.overlayPositions) {
          try { localStorage.setItem(OVERLAY_KEY, JSON.stringify(obj.overlayPositions)); } catch (e) {}
        }

        // If presets present, store them
        if (obj && obj.presets) {
          try { localStorage.setItem(PRESETS_KEY, JSON.stringify(obj.presets)); } catch (e) {}
        }

        saveFormData();
        renderOverlaysForCurrentType();
        renderPresets();
        updateProductDropdown();
        updateProductDisplay();
        updateFdrOverlayValues();
        try { if (typeof updateMaturityTicks === 'function') updateMaturityTicks(); } catch (e) {}

        showToast('Data imported successfully');
      } catch (err) {
        console.error('Import error', err);
        showToast('Import failed: invalid file');
      }
    };
    reader.readAsText(file);
  }

  // Wire up import/export buttons
  const slideMenuExportBtn = document.getElementById('slideMenuExport');
  const slideMenuImportBtn = document.getElementById('slideMenuImport');
  
  if (slideMenuExportBtn) {
    slideMenuExportBtn.addEventListener('click', function(e) {
      e.preventDefault();
      exportData();
      closeSlideMenu();
    });
  }

  if (slideMenuImportBtn) {
    slideMenuImportBtn.addEventListener('click', function(e) {
      e.preventDefault();
      // Create hidden file input for import
      const fileInput = document.createElement('input');
      fileInput.type = 'file';
      fileInput.accept = '.json,application/json';
      fileInput.addEventListener('change', function(ev) {
        const file = ev.target.files[0];
        if (file) importDataFromFile(file);
      });
      fileInput.click();
      closeSlideMenu();
    });
  }

  // Manual Reset Editor Data button removed

  // Section collapse/expand toggle
  document.querySelectorAll('.form-section .section-header').forEach(header => {
    header.addEventListener('click', () => {
      const section = header.closest('.form-section');
      section.classList.toggle('collapsed');
    });
  });

  // Initialize all sections as collapsed on app load, except Account Information
  document.querySelectorAll('.form-section').forEach(section => {
    if (section.id !== 'account-info') {
      section.classList.add('collapsed');
    }
  });
})();
  </script>
</body>
</html>
